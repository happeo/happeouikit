{"version":3,"file":"image.js","sources":["../../../src/js/plugins/image.js"],"sourcesContent":["import FE from '../index.js'\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'image.insert': '[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]',\n  'image.edit': '[_BUTTONS_]',\n  'image.alt': '[_BUTTONS_][_ALT_LAYER_]',\n  'image.size': '[_BUTTONS_][_SIZE_LAYER_]'\n})\n\nObject.assign(FE.DEFAULTS, {\n  imageInsertButtons: ['imageBack', '|', 'imageUpload', 'imageByURL'],\n  imageEditButtons: ['imageReplace', 'imageAlign', 'imageCaption', 'imageRemove', 'imageLink', 'linkOpen', 'linkEdit', 'linkRemove', '-', 'imageDisplay', 'imageStyle', 'imageAlt', 'imageSize'],\n  imageAltButtons: ['imageBack', '|'],\n  imageSizeButtons: ['imageBack', '|'],\n  imageUpload: true,\n  imageUploadURL: null,\n  imageCORSProxy: 'https://cors-anywhere.froala.com',\n  imageUploadRemoteUrls: true,\n  imageUploadParam: 'file',\n  imageUploadParams: {},\n  imageUploadToS3: false,\n  imageUploadMethod: 'POST',\n  imageMaxSize: 10 * 1024 * 1024,\n  imageAllowedTypes: ['jpeg', 'jpg', 'png', 'gif', 'webp'],\n  imageResize: true,\n  imageResizeWithPercent: false,\n  imageRoundPercent: false,\n  imageDefaultWidth: 300,\n  imageDefaultAlign: 'center',\n  imageDefaultDisplay: 'block',\n  imageSplitHTML: false,\n  imageStyles: {\n    'fr-rounded': 'Rounded',\n    'fr-bordered': 'Bordered',\n    'fr-shadow': 'Shadow'\n  },\n  imageMove: true,\n  imageMultipleStyles: true,\n  imageTextNear: true,\n  imagePaste: true,\n  imagePasteProcess: false,\n  imageMinWidth: 16,\n  imageOutputSize: false,\n  imageDefaultMargin: 5,\n  imageAddNewLine: false\n})\n\nFE.PLUGINS.image = function (editor) {\n  const $ = editor.$\n  const DEFAULT_IMAGE_UPLOAD_URL = 'https://i.froala.com/upload'\n\n  let $current_image\n  let $image_resizer\n  let $handler\n  let $overlay\n  let mousedown = false\n\n  const BAD_LINK = 1\n  const MISSING_LINK = 2\n  const ERROR_DURING_UPLOAD = 3\n  const BAD_RESPONSE = 4\n  const MAX_SIZE_EXCEEDED = 5\n  const BAD_FILE_TYPE = 6\n  const NO_CORS_IE = 7\n  const CORRUPTED_IMAGE = 8\n\n  const error_messages = {}\n  error_messages[BAD_LINK] = 'Image cannot be loaded from the passed link.',\n  error_messages[MISSING_LINK] = 'No link in upload response.',\n  error_messages[ERROR_DURING_UPLOAD] = 'Error during file upload.',\n  error_messages[BAD_RESPONSE] = 'Parsing response failed.',\n  error_messages[MAX_SIZE_EXCEEDED] = 'File is too large.',\n  error_messages[BAD_FILE_TYPE] = 'Image file type is invalid.',\n  error_messages[NO_CORS_IE] = 'Files can be uploaded only to same domain in IE 8 and IE 9.'\n  error_messages[CORRUPTED_IMAGE] = 'Image file is corrupted.'\n\n  /**\n   * Refresh the image insert popup.\n   */\n\n  function _refreshInsertPopup() {\n    const $popup = editor.popups.get('image.insert')\n\n    const $url_input = $popup.find('.fr-image-by-url-layer input')\n    $url_input.val('')\n\n    if ($current_image) {\n      $url_input.val($current_image.attr('src'))\n    }\n\n    $url_input.trigger('change')\n  }\n\n  /**\n   * Show the image upload popup.\n   */\n\n  function showInsertPopup() {\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"insertImage\"]')\n    let $popup = editor.popups.get('image.insert')\n    if (!$popup) $popup = _initInsertPopup()\n    hideProgressBar()\n    if (!$popup.hasClass('fr-active')) {\n      editor.popups.refresh('image.insert')\n      editor.popups.setContainer('image.insert', editor.$tb)\n\n      if ($btn.isVisible()) {\n        const { left, top } = editor.button.getPosition($btn)\n        editor.popups.show('image.insert', left, top, $btn.outerHeight())\n      }\n      else {\n        editor.position.forSelection($popup)\n        editor.popups.show('image.insert')\n      }\n    }\n  }\n\n  /**\n   * Show the image edit popup.\n   */\n\n  function _showEditPopup() {\n    let $popup = editor.popups.get('image.edit')\n\n    if (!$popup) $popup = _initEditPopup()\n\n    if ($popup) {\n      let $el = getEl()\n\n      if (hasCaption()) {\n        $el = $el.find('.fr-img-wrap')\n      }\n\n      editor.popups.setContainer('image.edit', editor.$sc)\n      editor.popups.refresh('image.edit')\n      let left = $el.offset().left + $el.outerWidth() / 2\n      const top = $el.offset().top + $el.outerHeight()\n\n      // Enhancement 2950\n      if ($current_image.hasClass('fr-uploading')) {\n        showProgressBar()\n      }\n      else {\n        editor.popups.show('image.edit', left, top, $el.outerHeight(), true)\n      }\n    }\n  }\n\n  /**\n   * Hide image upload popup.\n   */\n\n  function _hideInsertPopup() {\n    hideProgressBar()\n  }\n\n  /**\n   * Convert style to classes.\n   */\n  function _convertStyleToClasses($img) {\n    if ($img.parents('.fr-img-caption').length > 0) {\n      $img = $img.parents('.fr-img-caption').first()\n    }\n\n    if (!$img.hasClass('fr-dii') && !$img.hasClass('fr-dib')) {\n      $img.addClass('fr-fi' + getAlign($img)[0])\n      $img.addClass('fr-di' + getDisplay($img)[0])\n\n      // Reset inline style.\n      $img.css('margin', '')\n      $img.css('float', '')\n      $img.css('display', '')\n      $img.css('z-index', '')\n      $img.css('position', '')\n      $img.css('overflow', '')\n      $img.css('vertical-align', '')\n    }\n  }\n\n  /**\n   * Convert classes to style.\n   */\n  function _convertClassesToStyle($img) {\n    if ($img.parents('.fr-img-caption').length > 0) {\n      $img = $img.parents('.fr-img-caption').first()\n    }\n\n    const d = $img.hasClass('fr-dib') ? 'block' : $img.hasClass('fr-dii') ? 'inline' : null\n    const a = $img.hasClass('fr-fil') ? 'left' : $img.hasClass('fr-fir') ? 'right' : getAlign($img)\n\n    _setStyle($img, d, a)\n\n    $img.removeClass('fr-dib fr-dii fr-fir fr-fil')\n  }\n\n  /**\n   * Refresh the image list.\n   */\n  function _refreshImageList() {\n    const images = editor.el.tagName == 'IMG' ? [editor.el] : editor.el.querySelectorAll('img')\n\n    for (let i = 0; i < images.length; i++) {\n      const $img = $(images[i])\n\n      if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n        if (editor.opts.imageDefaultAlign || editor.opts.imageDefaultDisplay) {\n          _convertStyleToClasses($img)\n        }\n\n        // Do not allow text near image.\n        if (!editor.opts.imageTextNear) {\n          if ($img.parents('.fr-img-caption').length > 0) {\n            $img.parents('.fr-img-caption').first().removeClass('fr-dii').addClass('fr-dib')\n          }\n          else {\n            $img.removeClass('fr-dii').addClass('fr-dib')\n          }\n        }\n      }\n      else if (!editor.opts.htmlUntouched && !editor.opts.useClasses) {\n        if (editor.opts.imageDefaultAlign || editor.opts.imageDefaultDisplay) {\n          _convertClassesToStyle($img)\n        }\n      }\n\n      if (editor.opts.iframe) {\n        $img.on('load', editor.size.syncIframe)\n      }\n    }\n  }\n\n  /**\n   * Keep images in sync when content changed.\n   */\n  let images\n\n  function _syncImages(loaded) {\n\n    if (typeof loaded === 'undefined') loaded = true\n\n    // Get current images.\n    const c_images = Array.prototype.slice.call(editor.el.querySelectorAll('img'))\n\n    // Current images src.\n    const image_srcs = []\n    let i\n\n    for (i = 0; i < c_images.length; i++) {\n      image_srcs.push(c_images[i].getAttribute('src'))\n\n      $(c_images[i]).toggleClass('fr-draggable', editor.opts.imageMove)\n\n      if (c_images[i].getAttribute('class') === '') c_images[i].removeAttribute('class')\n\n      if (c_images[i].getAttribute('style') === '') c_images[i].removeAttribute('style')\n\n      if (c_images[i].parentNode && c_images[i].parentNode.parentNode && editor.node.hasClass(c_images[i].parentNode.parentNode, 'fr-img-caption')) {\n        const p_node = c_images[i].parentNode.parentNode\n\n        if (!editor.browser.mozilla) {\n          p_node.setAttribute('contenteditable', false)\n        }\n\n        p_node.setAttribute('draggable', false)\n        p_node.classList.add('fr-draggable')\n\n        const n_node = c_images[i].nextSibling\n\n        if (n_node && !editor.browser.mozilla) {\n          n_node.setAttribute('contenteditable', true)\n        }\n      }\n    }\n\n    // Loop previous images and check their src.\n    if (images) {\n      for (i = 0; i < images.length; i++) {\n        if (image_srcs.indexOf(images[i].getAttribute('src')) < 0) {\n          editor.events.trigger('image.removed', [$(images[i])])\n        }\n      }\n    }\n\n    // Loop new images and see which were not int the old ones.\n    if (images && loaded) {\n      const old_images_srcs = []\n\n      for (i = 0; i < images.length; i++) {\n        old_images_srcs.push(images[i].getAttribute('src'))\n      }\n\n      for (i = 0; i < c_images.length; i++) {\n        if (old_images_srcs.indexOf(c_images[i].getAttribute('src')) < 0) {\n          editor.events.trigger('image.loaded', [$(c_images[i])])\n        }\n      }\n    }\n\n    // Current images are the old ones.\n    images = c_images\n  }\n\n  /**\n   * Reposition resizer.\n   */\n\n  function _repositionResizer() {\n    if (!$image_resizer) _initImageResizer()\n\n    if (!$current_image) return false\n\n    const $container = editor.$wp || editor.$sc\n\n    $container.append($image_resizer)\n    $image_resizer.data('instance', editor)\n\n    let wrap_correction_top = $container.scrollTop() - (($container.css('position') != 'static' ? $container.offset().top : 0))\n    let wrap_correction_left = $container.scrollLeft() - (($container.css('position') != 'static' ? $container.offset().left : 0))\n\n    wrap_correction_left -= editor.helpers.getPX($container.css('border-left-width'))\n    wrap_correction_top -= editor.helpers.getPX($container.css('border-top-width'))\n\n    if (editor.$el.is('img') && editor.$sc.is('body')) {\n      wrap_correction_top = 0\n      wrap_correction_left = 0\n    }\n\n    let $el = getEl()\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap')\n    }\n\n    let iframePaddingTop = 0\n    let iframePaddingLeft = 0\n    if (editor.opts.iframe) {\n      iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\n      iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\n    }\n\n    $image_resizer\n      .css('top', (editor.opts.iframe ? $el.offset().top + iframePaddingTop : $el.offset().top + wrap_correction_top) - 1)\n      .css('left', (editor.opts.iframe ? $el.offset().left + iframePaddingLeft : $el.offset().left + wrap_correction_left) - 1)\n      .css('width', $el.get(0).getBoundingClientRect().width)\n      .css('height', $el.get(0).getBoundingClientRect().height)\n      .addClass('fr-active')\n  }\n\n  /**\n   * Create resize handler.\n   */\n\n  function _getHandler(pos) {\n\n    return '<div class=\"fr-handler fr-h' + pos + '\"></div>'\n  }\n\n  /**\n   * Set the image with\n   */\n  function _setWidth(width) {\n    if (hasCaption()) {\n      $current_image.parents('.fr-img-caption').css('width', width)\n    }\n    else {\n      $current_image.css('width', width)\n    }\n  }\n\n  /**\n   * Mouse down to start resize.\n   */\n  function _handlerMousedown(e) {\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($image_resizer)) return true\n\n    e.preventDefault()\n    e.stopPropagation()\n\n    if (editor.$el.find('img.fr-error').left) return false\n\n    if (!editor.undo.canDo()) editor.undo.saveStep()\n\n    // Get offset.\n    let start_x = e.pageX || e.originalEvent.touches[0].pageX\n\n    // Only on mousedown. This function could be called from keydown on accessibility.\n    if (e.type == 'mousedown') {\n      // See if the entire editor is inside iframe to adjust starting offset.\n      const oel = editor.$oel.get(0)\n      const doc = oel.ownerDocument\n      const win = doc.defaultView || doc.parentWindow\n      let editor_inside_iframe = false\n\n      try {\n        editor_inside_iframe = (win.location != win.parent.location && !(win.$ && win.$.FE))\n      } catch (ex) { }\n\n      if (editor_inside_iframe && win.frameElement) {\n        start_x += editor.helpers.getPX($(win.frameElement).offset().left) + win.frameElement.clientLeft\n      }\n    }\n\n    $handler = $(this)\n    $handler.data('start-x', start_x)\n    $handler.data('start-width', $current_image.width())\n    $handler.data('start-height', $current_image.height())\n\n    // Set current width.\n    let width = $current_image.width()\n\n    // Update width value if resizing with percent.\n    if (editor.opts.imageResizeWithPercent) {\n      const p_node = $current_image.parentsUntil(editor.$el, editor.html.blockTagsQuery()).get(0) || editor.el\n      width = (width / $(p_node).outerWidth() * 100).toFixed(2) + '%'\n    }\n\n    // Set the image width.\n    _setWidth(width)\n\n    $overlay.show()\n\n    editor.popups.hideAll()\n\n    _unmarkExit()\n  }\n\n  /**\n   * Do resize.\n   */\n  function _handlerMousemove(e) {\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($image_resizer)) return true\n    let real_image_size\n\n    if ($handler && $current_image) {\n      e.preventDefault()\n\n      if (editor.$el.find('img.fr-error').left) return false\n\n      const c_x = e.pageX || (e.originalEvent.touches ? e.originalEvent.touches[0].pageX : null)\n\n      if (!c_x) return false\n\n      const s_x = $handler.data('start-x')\n      let diff_x = c_x - s_x\n      let width = $handler.data('start-width')\n\n      if ($handler.hasClass('fr-hnw') || $handler.hasClass('fr-hsw')) {\n        diff_x = 0 - diff_x\n      }\n\n      if (editor.opts.imageResizeWithPercent) {\n        const p_node = $current_image.parentsUntil(editor.$el, editor.html.blockTagsQuery()).get(0) || editor.el\n        width = ((width + diff_x) / $(p_node).outerWidth() * 100).toFixed(2)\n\n        if (editor.opts.imageRoundPercent) width = Math.round(width)\n\n        // Set the image width.\n        _setWidth(width + '%')\n\n        // Get the real image width after resize.\n        if (hasCaption()) {\n          real_image_size = (editor.helpers.getPX($current_image.parents('.fr-img-caption').css('width')) / $(p_node).outerWidth() * 100).toFixed(2)\n        }\n        else {\n          real_image_size = (editor.helpers.getPX($current_image.css('width')) / $(p_node).outerWidth() * 100).toFixed(2)\n        }\n\n        // If the width is not contained within editor use the real image size.\n        if (real_image_size !== width && !editor.opts.imageRoundPercent) {\n          _setWidth(real_image_size + '%')\n        }\n\n        $current_image.css('height', '').removeAttr('height')\n      }\n      else {\n        if (width + diff_x >= editor.opts.imageMinWidth) {\n          // Set width for image parent node as well.\n          _setWidth(width + diff_x)\n\n          // Get the real image width after resize.\n          if (hasCaption()) {\n            real_image_size = editor.helpers.getPX($current_image.parents('.fr-img-caption').css('width'))\n          }\n          else {\n            real_image_size = editor.helpers.getPX($current_image.css('width'))\n          }\n        }\n\n        // If the width is not contained within editor use the real image size.\n        if (real_image_size !== width + diff_x) {\n          _setWidth(real_image_size)\n        }\n\n        // https://github.com/froala/wysiwyg-editor/issues/1963.\n        if (($current_image.attr('style') || '').match(/(^height:)|(; *height:)/) || $current_image.attr('height')) {\n          $current_image.css('height', $handler.data('start-height') * $current_image.width() / $handler.data('start-width'))\n          $current_image.removeAttr('height')\n        }\n      }\n\n      _repositionResizer()\n\n      editor.events.trigger('image.resize', [get()])\n    }\n  }\n\n  /**\n   * Stop resize.\n   */\n\n  function _handlerMouseup(e) {\n\n    // Check if resizer belongs to current instance.\n    if (!editor.core.sameInstance($image_resizer)) return true\n\n    if ($handler && $current_image) {\n      if (e) e.stopPropagation()\n\n      if (editor.$el.find('img.fr-error').left) return false\n\n      $handler = null\n      $overlay.hide()\n      _repositionResizer()\n      _showEditPopup()\n\n      editor.undo.saveStep()\n\n      editor.events.trigger('image.resizeEnd', [get()])\n    }\n  }\n\n  /**\n   * Throw an image error.\n   */\n\n  function _throwError(code, response, $img) {\n    editor.edit.on()\n\n    if ($current_image) $current_image.addClass('fr-error')\n    _showErrorMessage(editor.language.translate('Something went wrong. Please try again.'))\n\n    // Remove image if it exists.\n    if (!$current_image && $img) remove($img)\n\n    editor.events.trigger('image.error', [{\n      code: code,\n      message: error_messages[code]\n    },\n    response,\n    $img\n    ])\n  }\n\n  /**\n   * Init the image edit popup.\n   */\n\n  function _initEditPopup(delayed) {\n    if (delayed) {\n      if (editor.$wp) {\n        editor.events.$on(editor.$wp, 'scroll.image-edit', function () {\n          if ($current_image && editor.popups.isVisible('image.edit')) {\n            editor.events.disableBlur()\n            _showEditPopup()\n          }\n        })\n      }\n\n      return true\n    }\n\n    // Image buttons.\n    let image_buttons = ''\n\n    if (editor.opts.imageEditButtons.length > 0) {\n\n      image_buttons += `<div class=\"fr-buttons\"> \n        ${editor.button.buildList(editor.opts.imageEditButtons)}\n        </div>`\n\n      const template = {\n        buttons: image_buttons\n      }\n\n      const $popup = editor.popups.create('image.edit', template)\n\n      return $popup\n    }\n\n    return false\n  }\n\n  /**\n   * Show progress bar.\n   */\n\n  function showProgressBar(no_message) {\n    let $popup = editor.popups.get('image.insert')\n\n    if (!$popup) $popup = _initInsertPopup()\n\n    $popup.find('.fr-layer.fr-active').removeClass('fr-active').addClass('fr-pactive')\n    $popup.find('.fr-image-progress-bar-layer').addClass('fr-active')\n    $popup.find('.fr-buttons').hide()\n\n    if ($current_image) {\n      const $el = getEl()\n\n      editor.popups.setContainer('image.insert', editor.$sc)\n      const left = $el.offset().left\n      const top = $el.offset().top + $el.height()\n\n      editor.popups.show('image.insert', left, top, $el.outerHeight())\n    }\n\n    if (typeof no_message == 'undefined') {\n      _setProgressMessage(editor.language.translate('Uploading'), 0)\n    }\n  }\n\n  /**\n   * Hide progress bar.\n   */\n  function hideProgressBar(dismiss) {\n    const $popup = editor.popups.get('image.insert')\n\n    if ($popup) {\n      $popup.find('.fr-layer.fr-pactive').addClass('fr-active').removeClass('fr-pactive')\n      $popup.find('.fr-image-progress-bar-layer').removeClass('fr-active')\n      $popup.find('.fr-buttons').show()\n\n      // Dismiss error message.\n      if (dismiss || editor.$el.find('img.fr-error').length) {\n        editor.events.focus()\n\n        if (editor.$el.find('img.fr-error').length) {\n          editor.$el.find('img.fr-error').remove()\n          editor.undo.saveStep()\n          editor.undo.run()\n          editor.undo.dropRedo()\n        }\n\n        if (!editor.$wp && $current_image) {\n          const $img = $current_image\n          _exitEdit(true)\n          editor.selection.setAfter($img.get(0))\n          editor.selection.restore()\n        }\n        editor.popups.hide('image.insert')\n      }\n    }\n  }\n\n  /**\n   * Set a progress message.\n   */\n\n  function _setProgressMessage(message, progress) {\n    const $popup = editor.popups.get('image.insert')\n\n    if ($popup) {\n      const $layer = $popup.find('.fr-image-progress-bar-layer')\n      $layer.find('h3').text(message + (progress ? ' ' + progress + '%' : ''))\n\n      $layer.removeClass('fr-error')\n\n      if (progress) {\n        $layer.find('div').removeClass('fr-indeterminate')\n        $layer.find('div > span').css('width', progress + '%')\n      }\n      else {\n        $layer.find('div').addClass('fr-indeterminate')\n      }\n    }\n  }\n\n  /**\n   * Show error message to the user.\n   */\n\n  function _showErrorMessage(message) {\n    showProgressBar()\n    const $popup = editor.popups.get('image.insert')\n    const $layer = $popup.find('.fr-image-progress-bar-layer')\n    $layer.addClass('fr-error')\n    const $message_header = $layer.find('h3')\n    $message_header.text(message)\n    editor.events.disableBlur()\n    $message_header.focus()\n  }\n\n  /**\n   * Insert image using URL callback.\n   */\n\n  function insertByURL() {\n    const $popup = editor.popups.get('image.insert')\n    const $input = $popup.find('.fr-image-by-url-layer input')\n\n    if ($input.val().length > 0) {\n      showProgressBar()\n      _setProgressMessage(editor.language.translate('Loading image'))\n\n      const img_url = $input.val().trim()\n\n      // Upload images if we should upload them.\n      if (editor.opts.imageUploadRemoteUrls && editor.opts.imageCORSProxy && editor.opts.imageUpload) {\n        const xhr = new XMLHttpRequest()\n        xhr.onload = function () {\n\n          if (this.status == 200) {\n\n            upload([new Blob([this.response], {\n              type: this.response.type || 'image/png'\n            })], $current_image)\n          }\n          else {\n            _throwError(BAD_LINK)\n          }\n        }\n\n        // If image couldn't be uploaded, insert as it is.\n        xhr.onerror = function () {\n          insert(img_url, true, [], $current_image)\n        }\n\n        xhr.open('GET', editor.opts.imageCORSProxy + '/' + img_url, true)\n        xhr.responseType = 'blob'\n\n        xhr.send()\n      }\n      else {\n        insert(img_url, true, [], $current_image)\n      }\n\n      $input.val('')\n      $input.blur()\n    }\n  }\n\n  function _editImg($img) {\n    _edit.call($img.get(0))\n  }\n\n  function _loadedCallback() {\n    const $img = $(this)\n\n    editor.popups.hide('image.insert')\n\n    $img.removeClass('fr-uploading')\n\n    // Select the image.\n    if ($img.next().is('br')) {\n      $img.next().remove()\n    }\n\n    _editImg($img)\n\n    editor.events.trigger('image.loaded', [$img])\n  }\n\n  /**\n   * Insert image into the editor.\n   */\n\n  function insert(link, sanitize, data, $existing_img, response) {\n    editor.edit.off()\n    _setProgressMessage(editor.language.translate('Loading image'))\n\n    if (sanitize) link = editor.helpers.sanitizeURL(link)\n\n    const image = new Image()\n\n    image.onload = function () {\n      let $img\n      let attr\n\n      if ($existing_img) {\n        if (!editor.undo.canDo() && !$existing_img.hasClass('fr-uploading')) editor.undo.saveStep()\n\n        let old_src = $existing_img.data('fr-old-src')\n\n        if ($existing_img.data('fr-image-pasted')) {\n          old_src = null\n        }\n\n        if (editor.$wp) {\n\n          // Clone existing image.\n          $img = $existing_img.clone()\n            .removeData('fr-old-src')\n            .removeClass('fr-uploading')\n            .removeAttr('data-fr-image-pasted')\n\n          // Remove load event.\n          $img.off('load')\n\n          // Set new SRC.\n          if (old_src) $existing_img.attr('src', old_src)\n\n          // Replace existing image with its clone.\n          $existing_img.replaceWith($img)\n\n        }\n        else {\n          $img = $existing_img\n        }\n\n        // Remove old data.\n        const atts = $img.get(0).attributes\n\n        for (let i = 0; i < atts.length; i++) {\n          const att = atts[i]\n\n          if (att.nodeName.indexOf('data-') === 0) {\n            $img.removeAttr(att.nodeName)\n          }\n        }\n\n        // Set new data.\n        if (typeof data != 'undefined') {\n          for (attr in data) {\n            if (data.hasOwnProperty(attr)) {\n              if (attr != 'link') {\n                $img.attr('data-' + attr, data[attr])\n              }\n            }\n          }\n        }\n\n        $img.on('load', _loadedCallback)\n        $img.attr('src', link)\n        editor.edit.on()\n        _syncImages(false)\n        editor.undo.saveStep()\n\n        // Cursor will not appear if we don't make blur.\n        editor.events.disableBlur()\n        editor.$el.blur()\n        editor.events.trigger(old_src ? 'image.replaced' : 'image.inserted', [$img, response])\n      }\n      else {\n        $img = _addImage(link, data, _loadedCallback)\n        _syncImages(false)\n        editor.undo.saveStep()\n\n        // Cursor will not appear if we don't make blur.\n        editor.events.disableBlur()\n        editor.$el.blur()\n        editor.events.trigger('image.inserted', [$img, response])\n      }\n    }\n\n    image.onerror = function () {\n      _throwError(BAD_LINK)\n    }\n\n    showProgressBar(editor.language.translate('Loading image'))\n\n    image.src = link\n  }\n\n  /**\n   * Parse image response.\n   */\n\n  function _parseResponse(response) {\n    try {\n      if (editor.events.trigger('image.uploaded', [response], true) === false) {\n        editor.edit.on()\n\n        return false\n      }\n      const resp = JSON.parse(response)\n\n      if (resp.link) {\n\n        return resp\n      }\n      else {\n\n        // No link in upload request.\n        _throwError(MISSING_LINK, response)\n\n        return false\n      }\n    } catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response)\n\n      return false\n    }\n  }\n\n  /**\n   * Parse image response.\n   */\n\n  function _parseXMLResponse(response) {\n    try {\n      const link = $(response).find('Location').text()\n      const key = $(response).find('Key').text()\n\n      if (editor.events.trigger('image.uploadedToS3', [link, key, response], true) === false) {\n        editor.edit.on()\n\n        return false\n      }\n\n      return link\n    } catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response)\n\n      return false\n    }\n  }\n\n  /**\n   * Image was uploaded to the server and we have a response.\n   */\n\n  function _imageUploaded($img) {\n    _setProgressMessage(editor.language.translate('Loading image'))\n    const status = this.status\n    const response = this.response\n    const responseXML = this.responseXML\n    const responseText = this.responseText\n\n    try {\n      if (editor.opts.imageUploadToS3) {\n        if (status == 201) {\n          const link = _parseXMLResponse(responseXML)\n\n          if (link) {\n            insert(link, false, [], $img, response || responseXML)\n          }\n        }\n        else {\n          _throwError(BAD_RESPONSE, response || responseXML, $img)\n        }\n      }\n      else {\n        if (status >= 200 && status < 300) {\n          const resp = _parseResponse(responseText)\n\n          if (resp) {\n            insert(resp.link, false, resp, $img, response || responseText)\n          }\n        }\n        else {\n          _throwError(ERROR_DURING_UPLOAD, response || responseText, $img)\n        }\n      }\n    } catch (ex) {\n\n      // Bad response.\n      _throwError(BAD_RESPONSE, response || responseText, $img)\n    }\n  }\n\n  /**\n   * Image upload error.\n   */\n\n  function _imageUploadError() {\n    _throwError(BAD_RESPONSE, this.response || this.responseText || this.responseXML)\n  }\n\n  /**\n   * Image upload progress.\n   */\n\n  function _imageUploadProgress(e) {\n    if (e.lengthComputable) {\n      const complete = (e.loaded / e.total * 100 | 0)\n      _setProgressMessage(editor.language.translate('Uploading'), complete)\n    }\n  }\n\n  function _addImage(link, data, loadCallback) {\n\n    // Build image data string.\n    let data_str = ''\n    let attr\n    const $img = $(document.createElement('img')).attr('src', link)\n\n    if (data && typeof data != 'undefined') {\n      for (attr in data) {\n        if (data.hasOwnProperty(attr)) {\n          if (attr != 'link') {\n            data_str += ' data-' + attr + '=\"' + data[attr] + '\"'\n            $img.attr('data-str' + attr, data[attr])\n          }\n        }\n      }\n    }\n\n    let width = editor.opts.imageDefaultWidth\n\n    if (width && width != 'auto') {\n      width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px')\n    }\n\n    // Create image object and set the load event.\n    $img.attr('style', (width ? 'width: ' + width + ';' : ''))\n    _setStyle($img, editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign)\n\n    $img.on('load', loadCallback)\n\n    // Image might be corrupted. Continue upload flow.\n    $img.on('error', loadCallback)\n\n    // Make sure we have focus.\n    // Call the event.\n    editor.edit.on()\n    editor.events.focus(true)\n    editor.selection.restore()\n    editor.undo.saveStep()\n\n    // Insert marker and then replace it with the image.\n    if (editor.opts.imageSplitHTML) {\n      editor.markers.split()\n    }\n    else {\n      editor.markers.insert()\n    }\n\n    editor.html.wrap()\n    const $marker = editor.$el.find('.fr-marker')\n\n    if ($marker.length) {\n\n      // Do not insert image in HR.\n      if ($marker.parent().is('hr')) {\n        $marker.parent().after($marker)\n      }\n\n      // Do not insert image inside emoticon.\n      if (editor.node.isLastSibling($marker) && $marker.parent().hasClass('fr-deletable')) {\n\n        $marker.insertAfter($marker.parent())\n      }\n\n      $marker.replaceWith($img)\n    }\n    else {\n      editor.$el.append($img)\n    }\n\n    editor.selection.clear()\n\n    return $img\n  }\n\n  /**\n   * Image upload aborted.\n   */\n  function _imageUploadAborted() {\n    editor.edit.on()\n    hideProgressBar(true)\n  }\n\n  /**\n   * Start the uploading process.\n   */\n  function _startUpload(xhr, form_data, image, $image_placeholder) {\n    function _sendRequest() {\n      const $img = $(this)\n      $img.off('load')\n      $img.addClass('fr-uploading')\n\n      if ($img.next().is('br')) {\n        $img.next().remove()\n      }\n\n      editor.placeholder.refresh()\n\n      // Select the image.\n      _editImg($img)\n      _repositionResizer()\n      showProgressBar()\n      editor.edit.off()\n\n      // Set upload events.\n      xhr.onload = function () {\n        _imageUploaded.call(xhr, $img)\n      }\n      xhr.onerror = _imageUploadError\n      xhr.upload.onprogress = _imageUploadProgress\n      xhr.onabort = _imageUploadAborted\n\n      // Set abort event.\n      $($img.off('abortUpload')).on('abortUpload', function () {\n        if (xhr.readyState != 4) {\n          xhr.abort()\n        }\n      })\n\n      // Send data.\n      xhr.send(form_data)\n    }\n\n    const reader = new FileReader()\n\n    reader.onload = function () {\n      let link = reader.result\n\n      if (reader.result.indexOf('svg+xml') < 0) {\n\n        // Convert image to local blob.\n        const binary = atob(reader.result.split(',')[1])\n        const array = []\n\n        for (let i = 0; i < binary.length; i++) {\n          array.push(binary.charCodeAt(i))\n        }\n\n        // Get local image link.\n        link = window.URL.createObjectURL(new Blob([new Uint8Array(array)], {\n          type: 'image/jpeg'\n        }))\n      }\n\n      // No image.\n      if (!$image_placeholder) {\n        _addImage(link, null, _sendRequest)\n      }\n      else {\n        $image_placeholder.on('load', _sendRequest)\n\n        // Image might be corrupted.\n        $image_placeholder.on('error', function () {\n          _sendRequest()\n          $(this).off('error')\n        })\n\n        editor.edit.on()\n        editor.undo.saveStep()\n        $image_placeholder.data('fr-old-src', $image_placeholder.attr('src'))\n        $image_placeholder.attr('src', link)\n      }\n    }\n\n    reader.readAsDataURL(image)\n  }\n\n  function _browserUpload(image, $image_placeholder) {\n    const reader = new FileReader()\n\n    reader.onload = function () {\n      let link = reader.result\n\n      if (reader.result.indexOf('svg+xml') < 0) {\n\n        // Convert image to local blob.\n        const binary = atob(reader.result.split(',')[1])\n        const array = []\n\n        for (let i = 0; i < binary.length; i++) {\n          array.push(binary.charCodeAt(i))\n        }\n\n        // Get local image link.\n        link = window.URL.createObjectURL(new Blob([new Uint8Array(array)], {\n          type: image.type\n        }))\n\n        editor.image.insert(link, false, null, $image_placeholder)\n      }\n    }\n\n    showProgressBar()\n\n    reader.readAsDataURL(image)\n  }\n\n  /**\n   * Do image upload.\n   */\n\n  function upload(images, $image_placeholder) {\n\n    // Make sure we have what to upload.\n    if (typeof images != 'undefined' && images.length > 0) {\n\n      // Check if we should cancel the image upload.\n      if (editor.events.trigger('image.beforeUpload', [images, $image_placeholder]) === false) {\n\n        return false\n      }\n      const image = images[0]\n\n      // Upload as blob for testing purposes.\n      if ((editor.opts.imageUploadURL === null || editor.opts.imageUploadURL == DEFAULT_IMAGE_UPLOAD_URL) && !editor.opts.imageUploadToS3) {\n        _browserUpload(image, $image_placeholder || $current_image)\n\n        return false\n      }\n\n      // Check if there is image name set.\n      if (!image.name) {\n        image.name = (new Date()).getTime() + '.' + (image.type || 'image/jpeg').replace(/image\\//g, '')\n      }\n\n      // Check image max size.\n      if (image.size > editor.opts.imageMaxSize) {\n        _throwError(MAX_SIZE_EXCEEDED)\n\n        return false\n      }\n\n      // Check image types.\n      if (editor.opts.imageAllowedTypes.indexOf(image.type.replace(/image\\//g, '')) < 0) {\n        _throwError(BAD_FILE_TYPE)\n\n        return false\n      }\n\n      // Create form Data.\n      let form_data\n\n      if (editor.drag_support.formdata) {\n        form_data = editor.drag_support.formdata ? new FormData() : null\n      }\n\n      // Prepare form data for request.\n      if (form_data) {\n        let key\n\n        // Upload to S3.\n        if (editor.opts.imageUploadToS3 !== false) {\n          form_data.append('key', editor.opts.imageUploadToS3.keyStart + (new Date()).getTime() + '-' + (image.name || 'untitled'))\n          form_data.append('success_action_status', '201')\n          form_data.append('X-Requested-With', 'xhr')\n          form_data.append('Content-Type', image.type)\n\n          for (key in editor.opts.imageUploadToS3.params) {\n            if (editor.opts.imageUploadToS3.params.hasOwnProperty(key)) {\n              form_data.append(key, editor.opts.imageUploadToS3.params[key])\n            }\n          }\n        }\n\n        // Add upload params.\n        for (key in editor.opts.imageUploadParams) {\n          if (editor.opts.imageUploadParams.hasOwnProperty(key)) {\n            form_data.append(key, editor.opts.imageUploadParams[key])\n          }\n        }\n\n        // Set the image in the request.\n        form_data.append(editor.opts.imageUploadParam, image, image.name)\n\n        // Create XHR request.\n        let url = editor.opts.imageUploadURL\n\n        if (editor.opts.imageUploadToS3) {\n          if (editor.opts.imageUploadToS3.uploadURL) {\n            url = editor.opts.imageUploadToS3.uploadURL\n          }\n          else {\n            url = 'https://' + editor.opts.imageUploadToS3.region + '.amazonaws.com/' + editor.opts.imageUploadToS3.bucket\n          }\n        }\n        const xhr = editor.core.getXHR(url, editor.opts.imageUploadMethod)\n        _startUpload(xhr, form_data, image, $image_placeholder || $current_image)\n      }\n    }\n  }\n\n  /**\n   * Image drop inside the upload zone.\n   */\n\n  function _bindInsertEvents($popup) {\n\n    // Drag over the dropable area.\n    editor.events.$on($popup, 'dragover dragenter', '.fr-image-upload-layer', function () {\n      $(this).addClass('fr-drop')\n\n      return false\n    }, true)\n\n    // Drag end.\n    editor.events.$on($popup, 'dragleave dragend', '.fr-image-upload-layer', function () {\n      $(this).removeClass('fr-drop')\n\n      return false\n    }, true)\n\n    // Drop.\n    editor.events.$on($popup, 'drop', '.fr-image-upload-layer', function (e) {\n      e.preventDefault()\n      e.stopPropagation()\n      $(this).removeClass('fr-drop')\n      const dt = e.originalEvent.dataTransfer\n\n      if (dt && dt.files) {\n        const inst = $popup.data('instance') || editor\n        inst.events.disableBlur()\n        inst.image.upload(dt.files)\n        inst.events.enableBlur()\n      }\n    }, true)\n\n    if (editor.helpers.isIOS()) {\n      editor.events.$on($popup, 'touchstart', '.fr-image-upload-layer input[type=\"file\"]', function () {\n        $(this).trigger('click')\n      }, true)\n    }\n\n    editor.events.$on($popup, 'change', '.fr-image-upload-layer input[type=\"file\"]', function () {\n      if (this.files) {\n        const inst = $popup.data('instance') || editor\n\n        inst.events.disableBlur()\n        $popup.find('input:focus').blur()\n        inst.events.enableBlur()\n\n        inst.image.upload(this.files, $current_image)\n      }\n\n      // Else IE 9 case.\n      // Chrome fix.\n      $(this).val('')\n    }, true)\n  }\n\n  function _beforeElementDrop($el) {\n    if ($el.is('img') && $el.parents('.fr-img-caption').length > 0) {\n      return $el.parents('.fr-img-caption')\n    }\n  }\n\n  function _drop(e) {\n\n    // Check if we are dropping files.\n    const dt = e.originalEvent.dataTransfer\n\n    if (dt && dt.files && dt.files.length) {\n      const img = dt.files[0]\n\n      if (img && img.type && img.type.indexOf('image') !== -1 && editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\\//g, '')) >= 0) {\n        if (!editor.opts.imageUpload) {\n          e.preventDefault()\n          e.stopPropagation()\n\n          return false\n        }\n\n        editor.markers.remove()\n        editor.markers.insertAtPoint(e.originalEvent)\n\n        editor.$el.find('.fr-marker').replaceWith(FE.MARKERS)\n\n        if (editor.$el.find('.fr-marker').length === 0) {\n          editor.selection.setAtEnd(editor.el)\n        }\n\n        // Hide popups.\n        editor.popups.hideAll()\n\n        // Show the image insert popup.\n        let $popup = editor.popups.get('image.insert')\n\n        if (!$popup) $popup = _initInsertPopup()\n        editor.popups.setContainer('image.insert', editor.$sc)\n\n        let left = e.originalEvent.pageX\n        let top = e.originalEvent.pageY\n\n        if (editor.opts.iframe) {\n          const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\n          const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\n          top += editor.$iframe.offset().top + iframePaddingTop\n          left += editor.$iframe.offset().left + iframePaddingLeft\n        }\n\n        editor.popups.show('image.insert', left, top)\n        showProgressBar()\n\n        // Dropped file is an image that we allow.\n        if (editor.opts.imageAllowedTypes.indexOf(img.type.replace(/image\\//g, '')) >= 0) {\n\n          // Image might be selected.\n          _exitEdit(true)\n\n          // Upload images.\n          upload(dt.files)\n        }\n        else {\n          _throwError(BAD_FILE_TYPE)\n        }\n\n        // Cancel anything else.\n        e.preventDefault()\n        e.stopPropagation()\n\n        return false\n      }\n    }\n  }\n\n  function _initEvents() {\n\n    // Mouse down on image. It might start move.\n    editor.events.$on(editor.$el, editor._mousedown, editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function (e) {\n      if ($(this).parents('contenteditable').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\n\n      if (!editor.helpers.isMobile()) editor.selection.clear()\n\n      mousedown = true\n\n      if (editor.popups.areVisible()) editor.events.disableBlur()\n\n      // Prevent the image resizing.\n      if (editor.browser.msie) {\n        editor.events.disableBlur()\n        editor.$el.attr('contenteditable', false)\n      }\n\n      if (!editor.draggable && e.type != 'touchstart') e.preventDefault()\n\n      e.stopPropagation()\n    })\n\n    // Mouse up on an image prevent move.\n    editor.events.$on(editor.$el, editor._mouseup, editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function (e) {\n      if ($(this).parents('contenteditable').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\n\n      if (mousedown) {\n        mousedown = false\n\n        // Remove moving class.\n        e.stopPropagation()\n\n        if (editor.browser.msie) {\n          editor.$el.attr('contenteditable', true)\n          editor.events.enableBlur()\n        }\n      }\n    })\n\n    // Show image popup when it was selected.\n    editor.events.on('keyup', function (e) {\n      if (e.shiftKey && editor.selection.text().replace(/\\n/g, '') === '' && editor.keys.isArrow(e.which)) {\n        const s_el = editor.selection.element()\n        const e_el = editor.selection.endElement()\n\n        if (s_el && s_el.tagName == 'IMG') {\n          _editImg($(s_el))\n        }\n        else if (e_el && e_el.tagName == 'IMG') {\n          _editImg($(e_el))\n        }\n      }\n    }, true)\n\n    // Drop inside the editor.\n    editor.events.on('drop', _drop)\n    editor.events.on('element.beforeDrop', _beforeElementDrop)\n\n    editor.events.on('mousedown window.mousedown', _markExit)\n    editor.events.on('window.touchmove', _unmarkExit)\n\n    editor.events.on('mouseup window.mouseup', function () {\n      if ($current_image) {\n        _exitEdit()\n\n        return false\n      }\n\n      _unmarkExit()\n    })\n    editor.events.on('commands.mousedown', function ($btn) {\n      if ($btn.parents('.fr-toolbar').length > 0) {\n        _exitEdit()\n      }\n    })\n    editor.events.on('image.resizeEnd', function () {\n      if (editor.opts.iframe) {\n        editor.size.syncIframe()\n      }\n    })\n\n    editor.events.on('blur image.hideResizer commands.undo commands.redo element.dropped', function () {\n      mousedown = false\n      _exitEdit(true)\n    })\n\n    editor.events.on('modals.hide', function () {\n      if ($current_image) {\n        _selectImage()\n        editor.selection.clear()\n      }\n    })\n\n    editor.events.on('image.resizeEnd', function () {\n      if (editor.win.getSelection) {\n        _editImg($current_image)\n      }\n    })\n\n    // Add new line after image is inserted.\n    if (editor.opts.imageAddNewLine) {\n      editor.events.on('image.inserted', function ($img) {\n        var lastNode = $img.get(0)\n\n         // Ignore first BR after image.\n        if (lastNode.nextSibling && lastNode.nextSibling.tagName === 'BR') lastNode = lastNode.nextSibling;\n\n         // Look upper nodes.\n        while (lastNode && !editor.node.isElement(lastNode)) {\n          if (!editor.node.isLastSibling(lastNode)) {\n            lastNode = null;\n          }\n          else {\n            lastNode = lastNode.parentNode;\n          }\n        }\n\n         // If node is element, then image is last element.\n        if (editor.node.isElement(lastNode)) {\n\n           // ENTER_BR mode.\n          if (editor.opts.enter === FE.ENTER_BR) {\n            $img.after('<br>');\n          }\n          else {\n            var $parent = $(editor.node.blockParent($img.get(0)));\n\n             $parent.after('<' + editor.html.defaultTag() + '><br></' + editor.html.defaultTag() + '>');\n          }\n        }\n      })\n    }\n  }\n\n  /**\n   * Init the image upload popup.\n   */\n\n  function _initInsertPopup(delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('image.insert', _refreshInsertPopup)\n      editor.popups.onHide('image.insert', _hideInsertPopup)\n\n      return true\n    }\n\n    let active\n    let $popup\n\n    // Image buttons.\n    let image_buttons = ''\n\n    // https://github.com/froala/wysiwyg-editor/issues/2987\n\n    if (!editor.opts.imageUpload && editor.opts.imageInsertButtons.indexOf('imageUpload') !== -1) {\n      editor.opts.imageInsertButtons.splice(editor.opts.imageInsertButtons.indexOf('imageUpload'), 1)\n    }\n\n    const buttonList = editor.button.buildList(editor.opts.imageInsertButtons)\n\n    if (buttonList !== '') {\n      image_buttons = '<div class=\"fr-buttons fr-tabs\">' + buttonList + '</div>'\n    }\n\n    const uploadIndex = editor.opts.imageInsertButtons.indexOf('imageUpload')\n    const urlIndex = editor.opts.imageInsertButtons.indexOf('imageByURL')\n\n    // Image upload layer.\n    let upload_layer = ''\n\n    if (uploadIndex >= 0) {\n      active = ' fr-active'\n\n      if (urlIndex >= 0 && uploadIndex > urlIndex) {\n        active = ''\n      }\n\n      upload_layer = '<div class=\"fr-image-upload-layer' + active + ' fr-layer\" id=\"fr-image-upload-layer-' + editor.id + '\"><strong>' + editor.language.translate('Drop image') + '</strong><br>(' + editor.language.translate('or click') + ')<div class=\"fr-form\"><input type=\"file\" accept=\"image/' + editor.opts.imageAllowedTypes.join(', image/').toLowerCase() + '\" tabIndex=\"-1\" aria-labelledby=\"fr-image-upload-layer-' + editor.id + '\" role=\"button\"></div></div>'\n    }\n\n    // Image by url layer.\n    let by_url_layer = ''\n\n    if (urlIndex >= 0) {\n      active = ' fr-active'\n\n      if (uploadIndex >= 0 && urlIndex > uploadIndex) {\n        active = ''\n      }\n\n      by_url_layer = '<div class=\"fr-image-by-url-layer' + active + ' fr-layer\" id=\"fr-image-by-url-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input id=\"fr-image-by-url-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"http://\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageInsertByURL\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Insert') + '</button></div></div>'\n    }\n\n    // Progress bar.\n    const progress_bar_layer = '<div class=\"fr-image-progress-bar-layer fr-layer\"><h3 tabIndex=\"-1\" class=\"fr-message\">Uploading</h3><div class=\"fr-loader\"><span class=\"fr-progress\"></span></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-dismiss\" data-cmd=\"imageDismissError\" tabIndex=\"2\" role=\"button\">OK</button></div></div>'\n\n    const template = {\n      buttons: image_buttons,\n      upload_layer: upload_layer,\n      by_url_layer: by_url_layer,\n      progress_bar: progress_bar_layer\n    }\n\n    // Set the template in the popup.\n    if (editor.opts.imageInsertButtons.length >= 1) {\n      $popup = editor.popups.create('image.insert', template)\n    }\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll', function () {\n        if ($current_image && editor.popups.isVisible('image.insert')) {\n          replace()\n        }\n      })\n    }\n\n    _bindInsertEvents($popup)\n\n    return $popup\n  }\n\n\n  /**\n   * Refresh the ALT popup.\n   */\n\n  function _refreshAltPopup() {\n    if ($current_image) {\n      const $popup = editor.popups.get('image.alt')\n      $popup.find('input').val($current_image.attr('alt') || '').trigger('change')\n    }\n  }\n\n  /**\n   * Show the ALT popup.\n   */\n\n  function showAltPopup() {\n    let $popup = editor.popups.get('image.alt')\n\n    if (!$popup) $popup = _initAltPopup()\n    hideProgressBar()\n    editor.popups.refresh('image.alt')\n    editor.popups.setContainer('image.alt', editor.$sc)\n\n    let $el = getEl()\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap')\n    }\n\n    let left = $el.offset().left + $el.outerWidth() / 2\n    const top = $el.offset().top + $el.outerHeight()\n\n    editor.popups.show('image.alt', left, top, $el.outerHeight(), true)\n  }\n\n  /**\n   * Init the image upload popup.\n   */\n\n  function _initAltPopup(delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('image.alt', _refreshAltPopup)\n\n      return true\n    }\n\n    // Image buttons.\n    let image_buttons = ''\n    image_buttons = '<div class=\"fr-buttons fr-tabs\">' + editor.button.buildList(editor.opts.imageAltButtons) + '</div>'\n\n    // Image by url layer.\n    let alt_layer = ''\n    alt_layer = '<div class=\"fr-image-alt-layer fr-layer fr-active\" id=\"fr-image-alt-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input id=\"fr-image-alt-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('Alternative Text') + '\" tabIndex=\"1\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageSetAlt\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Update') + '</button></div></div>'\n\n    const template = {\n      buttons: image_buttons,\n      alt_layer: alt_layer\n    }\n\n    // Set the template in the popup.\n    const $popup = editor.popups.create('image.alt', template)\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll.image-alt', function () {\n        if ($current_image && editor.popups.isVisible('image.alt')) {\n          showAltPopup()\n        }\n      })\n    }\n\n    return $popup\n  }\n\n  /**\n   * Set ALT based on the values from the popup.\n   */\n\n  function setAlt(alt) {\n    if ($current_image) {\n      const $popup = editor.popups.get('image.alt')\n      $current_image.attr('alt', alt || $popup.find('input').val() || '')\n      $popup.find('input:focus').blur()\n      _editImg($current_image)\n    }\n  }\n\n  /**\n   * Refresh the size popup.\n   */\n\n  // Issue 2845\n\n  function _refreshSizePopup() {\n    const $popup = editor.popups.get('image.size')\n\n    if ($current_image) {\n\n      if (hasCaption()) {\n        let $el = $current_image.parent()\n\n        if (!($el.get(0).style.width)) {\n          $el = $current_image.parent().parent()\n        }\n        $popup.find('input[name=\"width\"]').val($el.get(0).style.width).trigger('change')\n        $popup.find('input[name=\"height\"]').val($el.get(0).style.height).trigger('change')\n      }\n      else {\n        $popup.find('input[name=\"width\"]').val($current_image.get(0).style.width).trigger('change')\n        $popup.find('input[name=\"height\"]').val($current_image.get(0).style.height).trigger('change')\n      }\n    }\n  }\n\n  /**\n   * Show the size popup.\n   */\n\n  function showSizePopup() {\n    let $popup = editor.popups.get('image.size')\n\n    if (!$popup) $popup = _initSizePopup()\n    hideProgressBar()\n    editor.popups.refresh('image.size')\n    editor.popups.setContainer('image.size', editor.$sc)\n\n    let $el = getEl()\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap')\n    }\n\n    let left = $el.offset().left + $el.outerWidth() / 2\n    const top = $el.offset().top + $el.outerHeight()\n\n    editor.popups.show('image.size', left, top, $el.outerHeight(), true)\n  }\n\n  /**\n   * Init the image upload popup.\n   */\n\n  function _initSizePopup(delayed) {\n    if (delayed) {\n      editor.popups.onRefresh('image.size', _refreshSizePopup)\n\n      return true\n    }\n\n    // Image buttons.\n    let image_buttons = ''\n    image_buttons = '<div class=\"fr-buttons fr-tabs\">' + editor.button.buildList(editor.opts.imageSizeButtons) + '</div>'\n\n    // Size layer.\n    let size_layer = ''\n    size_layer = '<div class=\"fr-image-size-layer fr-layer fr-active\" id=\"fr-image-size-layer-' + editor.id + '\"><div class=\"fr-image-group\"><div class=\"fr-input-line\"><input id=\"fr-image-size-layer-width-' + editor.id + '\" type=\"text\" name=\"width\" placeholder=\"' + editor.language.translate('Width') + '\" tabIndex=\"1\"></div><div class=\"fr-input-line\"><input id=\"fr-image-size-layer-height' + editor.id + '\" type=\"text\" name=\"height\" placeholder=\"' + editor.language.translate('Height') + '\" tabIndex=\"1\"></div></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"imageSetSize\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('Update') + '</button></div></div>'\n\n    const template = {\n      buttons: image_buttons,\n      size_layer: size_layer\n    }\n\n    // Set the template in the popup.\n    const $popup = editor.popups.create('image.size', template)\n\n    if (editor.$wp) {\n      editor.events.$on(editor.$wp, 'scroll.image-size', function () {\n        if ($current_image && editor.popups.isVisible('image.size')) {\n          showSizePopup()\n        }\n      })\n    }\n\n    return $popup\n  }\n\n  /**\n   * Set size based on the current image size.\n   */\n\n  function setSize(width, height) {\n    if ($current_image) {\n      const $popup = editor.popups.get('image.size')\n      width = width || $popup.find('input[name=\"width\"]').val() || ''\n      height = height || $popup.find('input[name=\"height\"]').val() || ''\n      const regex = /^[\\d]+((px)|%)*$/g\n\n      $current_image.removeAttr('width').removeAttr('height')\n\n      if (width.match(regex)) $current_image.css('width', width)\n      else $current_image.css('width', '')\n\n      if (height.match(regex)) $current_image.css('height', height)\n      else $current_image.css('height', '')\n\n      if (hasCaption()) {\n        $current_image.parents('.fr-img-caption').removeAttr('width').removeAttr('height')\n\n        if (width.match(regex)) $current_image.parents('.fr-img-caption').css('width', width)\n        else $current_image.parents('.fr-img-caption').css('width', '')\n\n        if (height.match(regex)) $current_image.parents('.fr-img-caption').css('height', height)\n        else $current_image.parents('.fr-img-caption').css('height', '')\n      }\n\n      if ($popup) $popup.find('input:focus').blur()\n      _editImg($current_image)\n    }\n  }\n\n  /**\n   * Show the image upload layer.\n   */\n\n  function showLayer(name) {\n    const $popup = editor.popups.get('image.insert')\n\n    let left\n    let top\n\n    // Click on the button from the toolbar without image selected.\n    if (!$current_image && !editor.opts.toolbarInline) {\n      const $btn = editor.$tb.find('.fr-command[data-cmd=\"insertImage\"]')\n      left = $btn.offset().left\n      top = $btn.offset().top + (editor.opts.toolbarBottom ? 10 : $btn.outerHeight() - 10)\n    }\n\n    // Image is selected.\n    else if ($current_image) {\n\n      let $el = getEl()\n\n      if (hasCaption()) {\n        $el = $el.find('.fr-img-wrap')\n      }\n\n      // Set the top to the bottom of the image.\n      top = $el.offset().top + $el.outerHeight()\n      left = $el.offset().left\n    }\n\n    // Image is selected and we are in inline mode.\n    if (!$current_image && editor.opts.toolbarInline) {\n\n      // Set top to the popup top.\n      top = $popup.offset().top - editor.helpers.getPX($popup.css('margin-top'))\n\n      // If the popup is above apply height correction.\n      if ($popup.hasClass('fr-above')) {\n        top += $popup.outerHeight()\n      }\n    }\n\n    // Show the new layer.\n    $popup.find('.fr-layer').removeClass('fr-active')\n    $popup.find('.fr-' + name + '-layer').addClass('fr-active')\n\n    editor.popups.show('image.insert', left, top, ($current_image ? $current_image.outerHeight() : 0))\n    editor.accessibility.focusPopup($popup)\n  }\n\n  /**\n   * Refresh the upload image button.\n   */\n\n  function refreshUploadButton($btn) {\n    const $popup = editor.popups.get('image.insert')\n    if ($popup && $popup.find('.fr-image-upload-layer').hasClass('fr-active')) {\n      $btn.addClass('fr-active').attr('aria-pressed', true)\n    }\n  }\n\n  /**\n   * Refresh the insert by url button.\n   */\n\n  function refreshByURLButton($btn) {\n    const $popup = editor.popups.get('image.insert')\n    if ($popup && $popup.find('.fr-image-by-url-layer').hasClass('fr-active')) {\n      $btn.addClass('fr-active').attr('aria-pressed', true)\n    }\n  }\n\n  function _resizeImage(e, initPageX, direction, step) {\n    e.pageX = initPageX\n    _handlerMousedown.call(this, e)\n    e.pageX = e.pageX + direction * Math.floor(Math.pow(1.1, step))\n    _handlerMousemove.call(this, e)\n    _handlerMouseup.call(this, e)\n\n    return ++step\n  }\n\n  /**\n   * Init image resizer.\n   */\n  function _initImageResizer() {\n    let doc\n\n    // No shared image resizer.\n    if (!editor.shared.$image_resizer) {\n\n      // Create shared image resizer.\n      editor.shared.$image_resizer = $(document.createElement('div')).attr('class', 'fr-image-resizer')\n      $image_resizer = editor.shared.$image_resizer\n\n      // Bind mousedown event shared.\n      editor.events.$on($image_resizer, 'mousedown', function (e) {\n        e.stopPropagation()\n      }, true)\n\n      // Image resize is enabled.\n      if (editor.opts.imageResize) {\n        $image_resizer.append(_getHandler('nw') + _getHandler('ne') + _getHandler('sw') + _getHandler('se'))\n\n        // Add image resizer overlay and set it.\n        editor.shared.$img_overlay = $(document.createElement('div')).attr('class', 'fr-image-overlay')\n        $overlay = editor.shared.$img_overlay\n        doc = $image_resizer.get(0).ownerDocument\n        $(doc).find('body').first().append($overlay)\n      }\n    }\n    else {\n      $image_resizer = editor.shared.$image_resizer\n      $overlay = editor.shared.$img_overlay\n\n      editor.events.on('destroy', function () {\n        $('body').first().append($image_resizer.removeClass('fr-active'))\n      }, true)\n    }\n\n    // Shared destroy.\n    editor.events.on('shared.destroy', function () {\n      $image_resizer.html('').removeData().remove()\n      $image_resizer = null\n\n      if (editor.opts.imageResize) {\n        $overlay.remove()\n        $overlay = null\n      }\n    }, true)\n\n    // Window resize. Exit from edit.\n    if (!editor.helpers.isMobile()) {\n      editor.events.$on($(editor.o_win), 'resize', function () {\n        if ($current_image && !$current_image.hasClass('fr-uploading')) {\n          _exitEdit(true)\n        }\n        else if ($current_image) {\n          _repositionResizer()\n          replace()\n          showProgressBar(false)\n        }\n      })\n    }\n\n    // Image resize is enabled.\n    if (editor.opts.imageResize) {\n      doc = $image_resizer.get(0).ownerDocument\n      editor.events.$on($image_resizer, editor._mousedown, '.fr-handler', _handlerMousedown)\n      editor.events.$on($(doc), editor._mousemove, _handlerMousemove)\n      editor.events.$on($(doc.defaultView || doc.parentWindow), editor._mouseup, _handlerMouseup)\n      editor.events.$on($overlay, 'mouseleave', _handlerMouseup)\n\n      // Accessibility.\n\n      // Used for keys holing.\n      let step = 1\n      let prevKey = null\n      let prevTimestamp = 0\n\n      // Keydown event.\n      editor.events.on('keydown', function (e) {\n        if ($current_image) {\n          const ctrlKey = navigator.userAgent.indexOf('Mac OS X') != -1 ? e.metaKey : e.ctrlKey\n          const keycode = e.which\n\n          if (keycode !== prevKey || e.timeStamp - prevTimestamp > 200) {\n            step = 1\n\n            // Reset step. Known browser issue: Keyup does not trigger when ctrl is pressed.\n          }\n\n          // Increase image size.\n          if ((keycode == FE.KEYCODE.EQUALS || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_EQUALS)) && ctrlKey && !e.altKey) {\n            step = _resizeImage.call(this, e, 1, 1, step)\n          }\n\n          // Decrease image size.\n          else if ((keycode == FE.KEYCODE.HYPHEN || (editor.browser.mozilla && keycode == FE.KEYCODE.FF_HYPHEN)) && ctrlKey && !e.altKey) {\n            step = _resizeImage.call(this, e, 2, -1, step)\n          }\n          else if (!editor.keys.ctrlKey(e) && keycode == FE.KEYCODE.ENTER) {\n            $current_image.before('<br>')\n            _editImg($current_image)\n          }\n\n          // Save key code.\n          prevKey = keycode\n\n          // Save timestamp.\n          prevTimestamp = e.timeStamp\n        }\n      }, true)\n\n      // Reset the step on key up event.\n      editor.events.on('keyup', function () {\n        step = 1\n      })\n    }\n  }\n\n  /**\n   * Remove the current image.\n   */\n  function remove($img) {\n    $img = $img || getEl()\n\n    if ($img) {\n      if (editor.events.trigger('image.beforeRemove', [$img]) !== false) {\n        editor.popups.hideAll()\n        _selectImage()\n        _exitEdit(true)\n\n        if (!editor.undo.canDo()) editor.undo.saveStep()\n\n        if ($img.get(0) == editor.el) {\n          $img.removeAttr('src')\n        }\n        else {\n          if ($img.get(0).parentNode && $img.get(0).parentNode.tagName == 'A') {\n            editor.selection.setBefore($img.get(0).parentNode) || editor.selection.setAfter($img.get(0).parentNode) || $img.parent().after(FE.MARKERS)\n            $($img.get(0).parentNode).remove()\n          }\n          else {\n            editor.selection.setBefore($img.get(0)) || editor.selection.setAfter($img.get(0)) || $img.after(FE.MARKERS)\n            $img.remove()\n          }\n\n          editor.html.fillEmptyBlocks()\n          editor.selection.restore()\n        }\n\n        editor.undo.saveStep()\n      }\n    }\n  }\n\n  function _editorKeydownHandler(e) {\n    const key_code = e.which\n\n    if ($current_image && (key_code == FE.KEYCODE.BACKSPACE || key_code == FE.KEYCODE.DELETE)) {\n      e.preventDefault()\n      e.stopPropagation()\n      remove()\n\n      return false\n    }\n    else if ($current_image && key_code == FE.KEYCODE.ESC) {\n      const $img = $current_image\n      _exitEdit(true)\n      editor.selection.setAfter($img.get(0))\n      editor.selection.restore()\n      e.preventDefault()\n\n      return false\n    }\n\n    // Move cursor if left and right arrows are used.\n    else if ($current_image && (key_code == FE.KEYCODE.ARROW_LEFT || key_code == FE.KEYCODE.ARROW_RIGHT)) {\n      const img = $current_image.get(0)\n      _exitEdit(true)\n\n      if (key_code == FE.KEYCODE.ARROW_LEFT) {\n        editor.selection.setBefore(img)\n      }\n      else {\n        editor.selection.setAfter(img)\n      }\n\n      editor.selection.restore()\n      e.preventDefault()\n\n      return false\n    }\n    else if ($current_image && key_code != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\n      e.preventDefault()\n      e.stopPropagation()\n\n      return false\n    }\n  }\n\n  /**\n   * Do some cleanup on images.\n   */\n  function _cleanOnGet(el) {\n\n    // Tag is image.\n    if (el && el.tagName == 'IMG') {\n\n      // Remove element if it has class fr-uploading or fr-error.\n      if (editor.node.hasClass(el, 'fr-uploading') || editor.node.hasClass(el, 'fr-error')) {\n        el.parentNode.removeChild(el)\n      }\n\n      // Remove class if it is draggable.\n      else if (editor.node.hasClass(el, 'fr-draggable')) {\n        el.classList.remove('fr-draggable')\n      }\n\n      if (el.parentNode && el.parentNode.parentNode && editor.node.hasClass(el.parentNode.parentNode, 'fr-img-caption')) {\n        const p_node = el.parentNode.parentNode\n        p_node.removeAttribute('contenteditable')\n        p_node.removeAttribute('draggable')\n        p_node.classList.remove('fr-draggable')\n\n        const n_node = el.nextSibling\n\n        if (n_node) {\n          n_node.removeAttribute('contenteditable')\n        }\n      }\n    }\n\n    // Look for inner nodes that might be in a similar case.\n    else if (el && el.nodeType == Node.ELEMENT_NODE) {\n      const imgs = el.querySelectorAll('img.fr-uploading, img.fr-error, img.fr-draggable')\n\n      for (let i = 0; i < imgs.length; i++) {\n        _cleanOnGet(imgs[i])\n      }\n    }\n  }\n\n  /**\n   * Initialization.\n   */\n  function _init() {\n    _initEvents()\n\n    // Init on image.\n    if (editor.el.tagName == 'IMG') {\n      editor.$el.addClass('fr-view')\n    }\n\n    editor.events.$on(editor.$el, editor.helpers.isMobile() && !editor.helpers.isWindowsPhone() ? 'touchend' : 'click', editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', _edit)\n\n    if (editor.helpers.isMobile()) {\n      editor.events.$on(editor.$el, 'touchstart', editor.el.tagName == 'IMG' ? null : 'img:not([contenteditable=\"false\"])', function () {\n        touchScroll = false\n      })\n\n      editor.events.$on(editor.$el, 'touchmove', function () {\n        touchScroll = true\n      })\n    }\n\n    if (editor.$wp) {\n      editor.events.on('window.keydown keydown', _editorKeydownHandler, true)\n\n      editor.events.on('keyup', function (e) {\n        if ($current_image && e.which == FE.KEYCODE.ENTER) {\n\n          return false\n        }\n      }, true)\n\n      // Prevent typing in image caption DOM structure.\n      editor.events.$on(editor.$el, 'keydown', function () {\n        let el = editor.selection.element()\n\n        // Parent node of the current element.\n        if (el.nodeType === Node.TEXT_NODE) {\n          el = el.parentNode\n        }\n\n        if (!editor.node.hasClass(el, 'fr-inner')) {\n          if (!editor.node.hasClass(el, 'fr-img-caption')) {\n            el = $(el).parents('.fr-img-caption').get(0)\n          }\n\n          // Check if we are in image caption.\n          if (editor.node.hasClass(el, 'fr-img-caption')) {\n            $(el).after($.FE.INVISIBLE_SPACE + $.FE.MARKERS);\n            editor.selection.restore();\n          }\n        }\n      })\n    }\n    else {\n      editor.events.$on(editor.$win, 'keydown', _editorKeydownHandler)\n    }\n\n    // ESC from accessibility.\n    editor.events.on('toolbar.esc', function () {\n      if ($current_image) {\n        if (editor.$wp) {\n          editor.events.disableBlur()\n          editor.events.focus()\n        }\n        else {\n          const $img = $current_image\n          _exitEdit(true)\n          editor.selection.setAfter($img.get(0))\n          editor.selection.restore()\n        }\n\n        return false\n      }\n    }, true)\n\n    // focusEditor from accessibility.\n    editor.events.on('toolbar.focusEditor', function () {\n      if ($current_image) {\n\n        return false\n      }\n    }, true)\n\n    // Copy/cut image.\n    editor.events.on('window.cut window.copy', function (e) {\n      // Do copy only if image.edit popups is visible and not focused.\n      if ($current_image && editor.popups.isVisible('image.edit') && !editor.popups.get('image.edit').find(':focus').length) {\n\n        const $el = getEl()\n\n        if (hasCaption()) {\n          $el.before(FE.START_MARKER)\n          $el.after(FE.END_MARKER)\n          editor.selection.restore()\n          editor.paste.saveCopiedText($el.get(0).outerHTML, $el.text())\n        }\n        else {\n          _selectImage()\n          editor.paste.saveCopiedText($current_image.get(0).outerHTML, $current_image.attr('alt'))\n        }\n\n        if (e.type == 'copy') {\n          setTimeout(function () {\n            _editImg($current_image)\n          })\n        }\n        else {\n          _exitEdit(true)\n          editor.undo.saveStep()\n          setTimeout(function () {\n            editor.undo.saveStep()\n          }, 0)\n        }\n      }\n    }, true)\n\n    // Fix IE copy not working when selection is collapsed.\n    if (editor.browser.msie) {\n      editor.events.on('keydown', function (e) {\n        // Selection is collapsed and we have an image.\n        if (!(editor.selection.isCollapsed() && $current_image)) return true\n\n        const key_code = e.which\n\n        // Copy.\n        if (key_code == FE.KEYCODE.C && editor.keys.ctrlKey(e)) {\n          editor.events.trigger('window.copy')\n        }\n\n        // Cut.\n        else if (key_code == FE.KEYCODE.X && editor.keys.ctrlKey(e)) {\n          editor.events.trigger('window.cut')\n        }\n      })\n    }\n\n    // Do not leave page while uploading.\n    editor.events.$on($(editor.o_win), 'keydown', function (e) {\n      const key_code = e.which\n\n      if ($current_image && key_code == FE.KEYCODE.BACKSPACE) {\n        e.preventDefault()\n\n        return false\n      }\n    })\n\n    // Check if image is uploading to abort it.\n    editor.events.$on(editor.$win, 'keydown', function (e) {\n      const key_code = e.which\n\n      if ($current_image && $current_image.hasClass('fr-uploading') && key_code == FE.KEYCODE.ESC) {\n        $current_image.trigger('abortUpload')\n      }\n    })\n\n    editor.events.on('destroy', function () {\n      if ($current_image && $current_image.hasClass('fr-uploading')) {\n        $current_image.trigger('abortUpload')\n      }\n    })\n\n    editor.events.on('paste.before', _clipboardPaste)\n    editor.events.on('paste.beforeCleanup', _clipboardPasteCleanup)\n    editor.events.on('paste.after', _uploadPastedImages)\n    editor.events.on('html.set', _refreshImageList)\n    editor.events.on('html.inserted', _refreshImageList)\n    _refreshImageList()\n\n    editor.events.on('destroy', function () {\n      images = []\n    })\n\n    // Remove any fr-uploading / fr-error images.\n    editor.events.on('html.processGet', _cleanOnGet)\n\n    if (editor.opts.imageOutputSize) {\n      let imgs\n\n      editor.events.on('html.beforeGet', function () {\n        imgs = editor.el.querySelectorAll('img')\n        for (let i = 0; i < imgs.length; i++) {\n          const width = imgs[i].style.width || $(imgs[i]).width()\n          const height = imgs[i].style.height || $(imgs[i]).height()\n\n          if (width) imgs[i].setAttribute('width', ('' + width).replace(/px/, ''))\n\n          if (height) imgs[i].setAttribute('height', ('' + height).replace(/px/, ''))\n        }\n      })\n    }\n\n    if (editor.opts.iframe) {\n      editor.events.on('image.loaded', editor.size.syncIframe)\n    }\n\n    if (editor.$wp) {\n      _syncImages()\n      editor.events.on('contentChanged', _syncImages)\n    }\n\n    editor.events.$on($(editor.o_win), 'orientationchange.image', function () {\n      setTimeout(function () {\n        if ($current_image) {\n          _editImg($current_image)\n        }\n      }, 100)\n    })\n\n    _initEditPopup(true)\n    _initInsertPopup(true)\n    _initSizePopup(true)\n    _initAltPopup(true)\n\n    editor.events.on('node.remove', function ($node) {\n      if ($node.get(0).tagName == 'IMG') {\n        remove($node)\n\n        return false\n      }\n    })\n  }\n\n  function _processPastedImage(img) {\n    if (editor.events.trigger('image.beforePasteUpload', [img]) === false) {\n\n      return false\n    }\n\n    // Show the progress bar.\n    $current_image = $(img)\n    _repositionResizer()\n    _showEditPopup()\n    replace()\n    showProgressBar()\n\n    $current_image.on('load', function () {\n      _repositionResizer()\n      showProgressBar()\n      $(this).off('load')\n    })\n\n    const splitSrc = $(img).attr('src').split(',')\n\n    // Convert image to blob.\n    const binary = atob(splitSrc[1])\n    const array = []\n\n    for (let i = 0; i < binary.length; i++) {\n      array.push(binary.charCodeAt(i))\n    }\n\n    const upload_img = new Blob([new Uint8Array(array)], {\n      type: splitSrc[0].replace(/data\\:/g, '').replace(/;base64/g, '')\n    })\n\n    upload([upload_img], $current_image)\n  }\n\n  function _uploadPastedImages() {\n    if (!editor.opts.imagePaste) {\n      editor.$el.find('img[data-fr-image-pasted]').remove()\n    }\n    else {\n\n      // Safari won't work https://bugs.webkit.org/show_bug.cgi?id=49141\n      editor.$el.find('img[data-fr-image-pasted]').each(function (index, img) {\n        if (editor.opts.imagePasteProcess) {\n          let width = editor.opts.imageDefaultWidth\n\n          if (width && width != 'auto') {\n            width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px')\n          }\n          $(img)\n            .css('width', width)\n            .removeClass('fr-dii fr-dib fr-fir fr-fil')\n\n          _setStyle($(img), editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign)\n        }\n\n        // Data images.\n        if (img.src.indexOf('data:') === 0) {\n          _processPastedImage(img)\n        }\n\n        // New way Safari is pasting images.\n        else if (img.src.indexOf('blob:') === 0 || (img.src.indexOf('http') === 0 && editor.opts.imageUploadRemoteUrls && editor.opts.imageCORSProxy)) {\n          const _img = new Image()\n          _img.crossOrigin = 'Anonymous'\n          _img.onload = function () {\n            // Create canvas.\n            const canvas = editor.o_doc.createElement('CANVAS')\n            const context = canvas.getContext('2d')\n\n            // Set height.\n            canvas.height = this.naturalHeight\n            canvas.width = this.naturalWidth\n\n            // Draw image.\n            context.drawImage(this, 0, 0)\n\n            // pushing the execution at end of the stack\n            setTimeout(function () {\n              _processPastedImage(img)\n            }, 0)\n\n            // Update image and process it.\n            img.src = canvas.toDataURL('image/jpeg')\n\n          }\n\n          _img.src = (img.src.indexOf('blob:') === 0 ? '' : (editor.opts.imageCORSProxy + '/')) + img.src\n        }\n\n        // Images without http (Safari ones.).\n        else if (img.src.indexOf('http') !== 0 || img.src.indexOf('https://mail.google.com/mail') === 0) {\n          editor.selection.save()\n          $(img).remove()\n          editor.selection.restore()\n        }\n        else {\n          $(img).removeAttr('data-fr-image-pasted')\n        }\n      })\n    }\n  }\n\n  function _clipboardImageLoaded(e) {\n    const result = e.target.result\n\n    // Default width.\n    let width = editor.opts.imageDefaultWidth\n\n    if (width && width != 'auto') {\n      width = width + (editor.opts.imageResizeWithPercent ? '%' : 'px')\n    }\n\n    editor.undo.saveStep()\n\n    editor.html.insert('<img data-fr-image-pasted=\"true\" src=\"' + result + '\"' + (width ? ' style=\"width: ' + width + ';\"' : '') + '>')\n\n    const $img = editor.$el.find('img[data-fr-image-pasted=\"true\"]')\n\n    if ($img) {\n      _setStyle($img, editor.opts.imageDefaultDisplay, editor.opts.imageDefaultAlign)\n    }\n\n    editor.events.trigger('paste.after')\n  }\n\n  function _processsClipboardPaste(file) {\n    const reader = new FileReader()\n    reader.onload = _clipboardImageLoaded\n    reader.readAsDataURL(file)\n  }\n\n  function _clipboardPaste(e) {\n    if (e && e.clipboardData && e.clipboardData.items) {\n\n      let file = null\n\n      if (!((e.clipboardData.types && e.clipboardData.types.indexOf('text/rtf') != -1) || e.clipboardData.getData('text/rtf'))) {\n        for (let i = 0; i < e.clipboardData.items.length; i++) {\n          file = e.clipboardData.items[i].getAsFile()\n\n          if (file) {\n            break\n          }\n        }\n      }\n      else {\n        file = e.clipboardData.items[0].getAsFile()\n      }\n\n      if (file) {\n        _processsClipboardPaste(file)\n\n        return false\n      }\n    }\n  }\n\n  function _clipboardPasteCleanup(clipboard_html) {\n    clipboard_html = clipboard_html.replace(/<img /gi, '<img data-fr-image-pasted=\"true\" ')\n\n    return clipboard_html\n  }\n\n  /**\n   * Start edit.\n   */\n  let touchScroll\n\n  function _edit(e) {\n    if ($(this).parents('[contenteditable]').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\n\n    if (e && e.type == 'touchend' && touchScroll) {\n\n      return true\n    }\n\n    if (e && editor.edit.isDisabled()) {\n      e.stopPropagation()\n      e.preventDefault()\n\n      return false\n    }\n\n    // Hide resizer for other instances.\n    for (let i = 0; i < FE.INSTANCES.length; i++) {\n      if (FE.INSTANCES[i] != editor) {\n        FE.INSTANCES[i].events.trigger('image.hideResizer')\n      }\n    }\n\n    editor.toolbar.disable()\n\n    if (e) {\n      e.stopPropagation()\n      e.preventDefault()\n    }\n\n    // Hide keyboard.\n    if (editor.helpers.isMobile()) {\n      editor.events.disableBlur()\n      editor.$el.blur()\n      editor.events.enableBlur()\n    }\n\n    if (editor.opts.iframe) {\n      editor.size.syncIframe()\n    }\n\n    // Store current image.\n    $current_image = $(this)\n\n    // Select image.\n    _selectImage()\n\n    // Reposition resizer.\n    _repositionResizer()\n    _showEditPopup()\n\n    // Issue 2801\n    if (editor.browser.msie) {\n      if (editor.popups.areVisible()) {\n        editor.events.disableBlur()\n      }\n\n      if (editor.win.getSelection) {\n        editor.win.getSelection().removeAllRanges()\n        editor.win.getSelection().addRange(editor.doc.createRange())\n      }\n    }\n    else {\n      editor.selection.clear()\n    }\n\n    // Fix for image remaining selected.\n    if (editor.helpers.isIOS()) {\n      editor.events.disableBlur()\n      editor.$el.blur()\n    }\n\n    // Refresh buttons.\n    editor.button.bulkRefresh()\n    editor.events.trigger('video.hideResizer')\n  }\n\n  /**\n   * Exit edit.\n   */\n\n  function _exitEdit(force_exit) {\n    if ($current_image && (_canExit() || force_exit === true)) {\n      editor.toolbar.enable()\n      $image_resizer.removeClass('fr-active')\n      editor.popups.hide('image.edit')\n      $current_image = null\n      _unmarkExit()\n\n      $handler = null\n\n      if ($overlay) {\n        $overlay.hide()\n      }\n    }\n  }\n\n  let img_exit_flag = false\n\n  function _markExit() {\n    img_exit_flag = true\n  }\n\n  function _unmarkExit() {\n    img_exit_flag = false\n  }\n\n  function _canExit() {\n\n    return img_exit_flag\n  }\n\n  /**\n   * Set style for image.\n   */\n  function _setStyle($img, _display, _align) {\n\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      $img.removeClass('fr-fil fr-fir fr-dib fr-dii')\n\n      if (_align) {\n        $img.addClass('fr-fi' + _align[0])\n      }\n\n      if (_display) {\n        $img.addClass('fr-di' + _display[0])\n      }\n    }\n    else {\n      if (_display == 'inline') {\n        $img.css({\n          display: 'inline-block',\n          verticalAlign: 'bottom',\n          margin: editor.opts.imageDefaultMargin\n        })\n\n        if (_align == 'center') {\n          $img.css({\n            'float': 'none',\n            marginBottom: '',\n            marginTop: '',\n            maxWidth: 'calc(100% - ' + (2 * editor.opts.imageDefaultMargin) + 'px)',\n            textAlign: 'center'\n          })\n        }\n        else if (_align == 'left') {\n          $img.css({\n            'float': 'left',\n            marginLeft: 0,\n            maxWidth: 'calc(100% - ' + editor.opts.imageDefaultMargin + 'px)',\n            textAlign: 'left'\n          })\n        }\n        else {\n          $img.css({\n            'float': 'right',\n            marginRight: 0,\n            maxWidth: 'calc(100% - ' + editor.opts.imageDefaultMargin + 'px)',\n            textAlign: 'right'\n          })\n        }\n      }\n      else if (_display == 'block') {\n        $img.css({\n          display: 'block',\n          'float': 'none',\n          verticalAlign: 'top',\n          margin: editor.opts.imageDefaultMargin + 'px auto',\n          textAlign: 'center'\n        })\n\n        if (_align == 'left') {\n          $img.css({\n            marginLeft: 0,\n            textAlign: 'left'\n          })\n        }\n        else if (_align == 'right') {\n          $img.css({\n            marginRight: 0,\n            textAlign: 'right'\n          })\n        }\n      }\n    }\n  }\n\n  /**\n   * Align image.\n   */\n  function align(val) {\n    const $el = getEl()\n\n    $el.removeClass('fr-fir fr-fil')\n\n    // Easy case. Use classes.\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      if (val == 'left') {\n        $el.addClass('fr-fil')\n      }\n      else if (val == 'right') {\n        $el.addClass('fr-fir')\n      }\n    }\n    else {\n      _setStyle($el, getDisplay(), val)\n    }\n\n    _selectImage()\n    _repositionResizer()\n    _showEditPopup()\n    editor.selection.clear()\n  }\n\n  /**\n   * Get image alignment.\n   */\n  function getAlign($img) {\n    if (typeof $img == 'undefined') $img = getEl()\n\n    if ($img) {\n\n      // Image has left class.\n      if ($img.hasClass('fr-fil')) {\n\n        return 'left'\n      }\n\n      // Image has right class.\n      else if ($img.hasClass('fr-fir')) {\n\n        return 'right'\n      }\n\n      // Image has display class set.\n      else if ($img.hasClass('fr-dib') || $img.hasClass('fr-dii')) {\n\n        return 'center'\n      }\n      else {\n        // Set float to none.\n        const flt = $img.css('float')\n\n        $img.css('float', 'none')\n\n        // Image has display block.\n        if ($img.css('display') == 'block') {\n\n          // Set float to the initial value.\n          $img.css('float', '')\n\n          if ($img.css('float') != flt) $img.css('float', flt)\n\n          // Margin left is 0.\n          // Margin right is auto.\n          if (parseInt($img.css('margin-left'), 10) === 0) {\n\n            return 'left'\n          }\n\n          // Margin left is auto.\n          // Margin right is 0.\n          else if (parseInt($img.css('margin-right'), 10) === 0) {\n\n            return 'right'\n          }\n        }\n\n        // Display inline.\n        else {\n\n          // Set float.\n          $img.css('float', '')\n\n          if ($img.css('float') != flt) $img.css('float', flt)\n\n          // Float left.\n          if ($img.css('float') == 'left') {\n\n            return 'left'\n          }\n\n          // Float right.\n          else if ($img.css('float') == 'right') {\n\n            return 'right'\n          }\n        }\n      }\n    }\n\n    return 'center'\n  }\n\n  /**\n   * Get image display.\n   */\n  function getDisplay($img) {\n    if (typeof $img == 'undefined') $img = getEl()\n\n    // Set float to none.\n    const flt = $img.css('float')\n    $img.css('float', 'none')\n\n    // Image has display block.\n    if ($img.css('display') == 'block') {\n\n      // Set float to the initial value.\n      $img.css('float', '')\n\n      if ($img.css('float') != flt) $img.css('float', flt)\n\n      return 'block'\n    }\n\n    // Display inline.\n    else {\n\n      // Set float.\n      $img.css('float', '')\n\n      if ($img.css('float') != flt) $img.css('float', flt)\n\n      return 'inline'\n    }\n\n    return 'inline'\n  }\n\n  /**\n   * Refresh the align icon.\n   */\n  function refreshAlign($btn) {\n    if ($current_image) {\n      $btn.find('> *').first().replaceWith(editor.icon.create('image-align-' + getAlign()))\n    }\n  }\n\n  /**\n   * Refresh the align option from the dropdown.\n   */\n\n  function refreshAlignOnShow($btn, $dropdown) {\n    if ($current_image) {\n      $dropdown.find('.fr-command[data-param1=\"' + getAlign() + '\"]').addClass('fr-active').attr('aria-selected', true)\n    }\n  }\n\n  /**\n   * Align image.\n   */\n\n  function display(val) {\n    const $el = getEl()\n\n    $el.removeClass('fr-dii fr-dib')\n\n    // Easy case. Use classes.\n    if (!editor.opts.htmlUntouched && editor.opts.useClasses) {\n      if (val == 'inline') {\n        $el.addClass('fr-dii')\n      }\n      else if (val == 'block') {\n        $el.addClass('fr-dib')\n      }\n    }\n    else {\n      _setStyle($el, val, getAlign())\n    }\n\n    _selectImage()\n    _repositionResizer()\n    _showEditPopup()\n    editor.selection.clear()\n  }\n\n  /**\n   * Refresh the image display selected option.\n   */\n\n  function refreshDisplayOnShow($btn, $dropdown) {\n    if ($current_image) {\n      $dropdown.find('.fr-command[data-param1=\"' + getDisplay() + '\"]').addClass('fr-active').attr('aria-selected', true)\n    }\n  }\n\n  /**\n   * Show the replace popup.\n   */\n\n  function replace() {\n    let $popup = editor.popups.get('image.insert')\n\n    if (!$popup) $popup = _initInsertPopup()\n\n    if (!editor.popups.isVisible('image.insert')) {\n      hideProgressBar()\n      editor.popups.refresh('image.insert')\n      editor.popups.setContainer('image.insert', editor.$sc)\n    }\n\n    let $el = getEl()\n\n    if (hasCaption()) {\n      $el = $el.find('.fr-img-wrap')\n    }\n\n    let left = $el.offset().left + $el.outerWidth() / 2\n    const top = $el.offset().top + $el.outerHeight()\n\n    editor.popups.show('image.insert', left, top, $el.outerHeight(true), true)\n  }\n\n  /**\n   * Place selection around current image.\n   */\n  function _selectImage() {\n    if ($current_image) {\n      editor.events.disableBlur()\n      editor.selection.clear()\n      const range = editor.doc.createRange()\n      range.selectNode($current_image.get(0))\n\n      // Collapse range in IE.\n      if (editor.browser.msie) range.collapse(true)\n\n      const selection = editor.selection.get()\n      selection.addRange(range)\n      editor.events.enableBlur()\n    }\n  }\n\n  /**\n   * Get back to the image main popup.\n   */\n  function back() {\n    if ($current_image) {\n      editor.events.disableBlur()\n      $('.fr-popup input:focus').blur()\n      _editImg($current_image)\n    }\n    else {\n      editor.events.disableBlur()\n      editor.selection.restore()\n      editor.events.enableBlur()\n\n      editor.popups.hide('image.insert')\n      editor.toolbar.showInline()\n    }\n  }\n\n  /**\n   * Get the current image.\n   */\n\n  function get() {\n\n    return $current_image\n  }\n\n  function getEl() {\n    return hasCaption() ? $current_image.parents('.fr-img-caption').first() : $current_image\n  }\n\n  /**\n   * Apply specific style.\n   */\n\n  function applyStyle(val, imageStyles, multipleStyles) {\n    if (typeof imageStyles == 'undefined') imageStyles = editor.opts.imageStyles\n\n    if (typeof multipleStyles == 'undefined') multipleStyles = editor.opts.imageMultipleStyles\n\n    if (!$current_image) return false\n\n    const $img = getEl()\n\n    // Remove multiple styles.\n    if (!multipleStyles) {\n      const styles = Object.keys(imageStyles)\n      styles.splice(styles.indexOf(val), 1)\n      $img.removeClass(styles.join(' '))\n    }\n\n    if (typeof imageStyles[val] == 'object') {\n      $img.removeAttr('style')\n      $img.css(imageStyles[val].style)\n    }\n    else {\n      $img.toggleClass(val)\n    }\n\n    _editImg($current_image)\n  }\n\n  function hasCaption() {\n    if ($current_image) {\n      return $current_image.parents('.fr-img-caption').length > 0\n    }\n\n    return false\n  }\n\n  function toggleCaption() {\n    let $el\n\n    if ($current_image && !hasCaption()) {\n      $el = $current_image\n\n      // Check if there is a link wrapping the image.\n      if ($current_image.parent().is('a')) {\n        $el = $current_image.parent()\n      }\n\n      // Issue 2861\n\n      const current_width = $el.width()\n\n      $el.wrap('<span ' + (!editor.browser.mozilla ? 'contenteditable=\"false\"' : '') + 'class=\"fr-img-caption ' + $current_image.attr('class') + '\" draggable=\"false\"></span>')\n      $el.wrap('<span class=\"fr-img-wrap\"></span>')\n      $el.after('<span class=\"fr-inner\"' + (!editor.browser.mozilla ? ' contenteditable=\"true\"' : '') + '>' + FE.START_MARKER + 'Image caption' + FE.END_MARKER + '</span>')\n      $current_image.removeAttr('class').removeAttr('style').removeAttr('width')\n\n      $current_image.parents('.fr-img-caption').css('width', current_width + 'px')\n\n      _exitEdit(true)\n\n      editor.selection.restore()\n    }\n    else {\n      $el = getEl()\n      $current_image.insertAfter($el)\n      $current_image\n        .attr('class', $el.attr('class').replace('fr-img-caption', ''))\n        .attr('style', $el.attr('style'))\n      $el.remove()\n\n      _editImg($current_image)\n    }\n  }\n\n  return {\n    _init: _init,\n    showInsertPopup: showInsertPopup,\n    showLayer: showLayer,\n    refreshUploadButton: refreshUploadButton,\n    refreshByURLButton: refreshByURLButton,\n    upload: upload,\n    insertByURL: insertByURL,\n    align: align,\n    refreshAlign: refreshAlign,\n    refreshAlignOnShow: refreshAlignOnShow,\n    display: display,\n    refreshDisplayOnShow: refreshDisplayOnShow,\n    replace: replace,\n    back: back,\n    get: get,\n    getEl: getEl,\n    insert: insert,\n    showProgressBar: showProgressBar,\n    remove: remove,\n    hideProgressBar: hideProgressBar,\n    applyStyle: applyStyle,\n    showAltPopup: showAltPopup,\n    showSizePopup: showSizePopup,\n    setAlt: setAlt,\n    setSize: setSize,\n    toggleCaption: toggleCaption,\n    hasCaption: hasCaption,\n    exitEdit: _exitEdit,\n    edit: _editImg\n  }\n}\n\n// Insert image button.\nFE.DefineIcon('insertImage', {\n  NAME: 'image',\n  SVG_KEY: 'insertImage'\n})\nFE.RegisterShortcut(FE.KEYCODE.P, 'insertImage', null, 'P')\nFE.RegisterCommand('insertImage', {\n  title: 'Insert Image',\n  undo: false,\n  focus: true,\n  refreshAfterCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('image.insert')) {\n      this.image.showInsertPopup()\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur()\n        this.selection.restore()\n      }\n      this.popups.hide('image.insert')\n    }\n  },\n  plugin: 'image'\n})\n\n// Image upload button inside the insert image popup.\nFE.DefineIcon('imageUpload', {\n  NAME: 'upload',\n  SVG_KEY: 'upload'\n})\nFE.RegisterCommand('imageUpload', {\n  title: 'Upload Image',\n  undo: false,\n  focus: false,\n  toggle: true,\n  callback: function () {\n    this.image.showLayer('image-upload')\n  },\n  refresh: function ($btn) {\n    this.image.refreshUploadButton($btn)\n  }\n})\n\n// Image by URL button inside the insert image popup.\nFE.DefineIcon('imageByURL', {\n  NAME: 'link',\n  SVG_KEY: 'insertLink'\n})\nFE.RegisterCommand('imageByURL', {\n  title: 'By URL',\n  undo: false,\n  focus: false,\n  toggle: true,\n  callback: function () {\n    this.image.showLayer('image-by-url')\n  },\n  refresh: function ($btn) {\n    this.image.refreshByURLButton($btn)\n  }\n})\n\n// Insert image button inside the insert by URL layer.\nFE.RegisterCommand('imageInsertByURL', {\n  title: 'Insert Image',\n  undo: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.insertByURL()\n  },\n  refresh: function ($btn) {\n    const $current_image = this.image.get()\n\n    if (!$current_image) {\n      $btn.text(this.language.translate('Insert'))\n    }\n    else {\n      $btn.text(this.language.translate('Replace'))\n    }\n  }\n})\n\n// Image display.\nFE.DefineIcon('imageDisplay', {\n  NAME: 'star',\n  SVG_KEY: 'imageDisplay'\n})\nFE.RegisterCommand('imageDisplay', {\n  title: 'Display',\n  type: 'dropdown',\n  options: {\n    inline: 'Inline',\n    block: 'Break Text'\n  },\n  callback: function (cmd, val) {\n    this.image.display(val)\n  },\n  refresh: function ($btn) {\n    if (!this.opts.imageTextNear) $btn.addClass('fr-hidden')\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.image.refreshDisplayOnShow($btn, $dropdown)\n  }\n})\n\n// Image align.\nFE.DefineIcon('image-align', {\n  NAME: 'align-left',\n  SVG_KEY: 'alignLeft'\n})\nFE.DefineIcon('image-align-left', {\n  NAME: 'align-left',\n  SVG_KEY: 'alignLeft'\n})\nFE.DefineIcon('image-align-right', {\n  NAME: 'align-right',\n  SVG_KEY: 'alignRight'\n})\nFE.DefineIcon('image-align-center', {\n  NAME: 'align-justify',\n  SVG_KEY: 'alignCenter'\n})\n\nFE.DefineIcon('imageAlign', {\n  NAME: 'align-justify',\n  SVG_KEY: 'alignJustify'\n})\nFE.RegisterCommand('imageAlign', {\n  type: 'dropdown',\n  title: 'Align',\n  options: {\n    left: 'Align Left',\n    center: 'None',\n    right: 'Align Right'\n  },\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = FE.COMMANDS.imageAlign.options\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"imageAlign\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.icon.create('image-align-' + val) + '<span class=\"fr-sr-only\">' + this.language.translate(options[val]) + '</span></a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    this.image.align(val)\n  },\n  refresh: function ($btn) {\n    this.image.refreshAlign($btn)\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    this.image.refreshAlignOnShow($btn, $dropdown)\n  }\n})\n\n// Image replace.\nFE.DefineIcon('imageReplace', {\n  NAME: 'exchange',\n  FA5NAME: 'exchange-alt',\n  SVG_KEY: 'replaceImage'\n})\nFE.RegisterCommand('imageReplace', {\n  title: 'Replace',\n  undo: false,\n  focus: false,\n  popup: true,\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.replace()\n  }\n})\n\n// Image remove.\nFE.DefineIcon('imageRemove', {\n  NAME: 'trash',\n  SVG_KEY: 'remove'\n})\nFE.RegisterCommand('imageRemove', {\n  title: 'Remove',\n  callback: function () {\n    this.image.remove()\n  }\n})\n\n// Image back.\nFE.DefineIcon('imageBack', {\n  NAME: 'arrow-left',\n  SVG_KEY: 'back'\n})\nFE.RegisterCommand('imageBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  callback: function () {\n    this.image.back()\n  },\n  refresh: function ($btn) {\n    const $ = this.$\n    const $current_image = this.image.get()\n\n    if (!$current_image && !this.opts.toolbarInline) {\n      $btn.addClass('fr-hidden')\n      $btn.next('.fr-separator').addClass('fr-hidden')\n    }\n    else {\n      $btn.removeClass('fr-hidden')\n      $btn.next('.fr-separator').removeClass('fr-hidden')\n    }\n  }\n})\n\nFE.RegisterCommand('imageDismissError', {\n  title: 'OK',\n  undo: false,\n  callback: function () {\n    this.image.hideProgressBar(true)\n  }\n})\n\n// Image styles.\nFE.DefineIcon('imageStyle', {\n  NAME: 'magic',\n  SVG_KEY: 'imageClass'\n})\nFE.RegisterCommand('imageStyle', {\n  title: 'Style',\n  type: 'dropdown',\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = this.opts.imageStyles\n\n    for (const cls in options) {\n      if (options.hasOwnProperty(cls)) {\n        let val = options[cls]\n\n        if (typeof val == 'object') val = val.title\n\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"imageStyle\" data-param1=\"' + cls + '\">' + this.language.translate(val) + '</a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    this.image.applyStyle(val)\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    const $ = this.$\n    const $current_image = this.image.getEl()\n\n    if ($current_image) {\n      $dropdown.find('.fr-command').each(function () {\n        const cls = $(this).data('param1')\n        const active = $current_image.hasClass(cls)\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active)\n      })\n    }\n  }\n})\n\n// Image alt.\nFE.DefineIcon('imageAlt', {\n  NAME: 'info',\n  SVG_KEY: 'imageAltText'\n})\nFE.RegisterCommand('imageAlt', {\n  undo: false,\n  focus: false,\n  popup: true,\n  title: 'Alternative Text',\n  callback: function () {\n    this.image.showAltPopup()\n  }\n})\n\nFE.RegisterCommand('imageSetAlt', {\n  undo: true,\n  focus: false,\n  title: 'Update',\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.setAlt()\n  }\n})\n\n// Image size.\nFE.DefineIcon('imageSize', {\n  NAME: 'arrows-alt',\n  SVG_KEY: 'imageSize'\n})\nFE.RegisterCommand('imageSize', {\n  undo: false,\n  focus: false,\n  popup: true,\n  title: 'Change Size',\n  callback: function () {\n    this.image.showSizePopup()\n  }\n})\n\nFE.RegisterCommand('imageSetSize', {\n  undo: true,\n  focus: false,\n  title: 'Update',\n  refreshAfterCallback: false,\n  callback: function () {\n    this.image.setSize()\n  }\n})\n\nFE.DefineIcon('imageCaption', {\n  NAME: 'commenting',\n  FA5NAME: 'comment-alt',\n  SVG_KEY: 'imageCaption'\n})\n\nFE.RegisterCommand('imageCaption', {\n  undo: true,\n  focus: false,\n  title: 'Image Caption',\n  refreshAfterCallback: true,\n  callback: function () {\n    this.image.toggleCaption()\n  },\n  refresh: function ($btn) {\n    if (this.image.get()) {\n      $btn.toggleClass('fr-active', this.image.hasCaption())\n    }\n  }\n})\n"],"names":["Object","assign","FE","POPUP_TEMPLATES","DEFAULTS","imageInsertButtons","imageEditButtons","imageAltButtons","imageSizeButtons","imageUpload","imageUploadURL","imageCORSProxy","imageUploadRemoteUrls","imageUploadParam","imageUploadParams","imageUploadToS3","imageUploadMethod","imageMaxSize","imageAllowedTypes","imageResize","imageResizeWithPercent","imageRoundPercent","imageDefaultWidth","imageDefaultAlign","imageDefaultDisplay","imageSplitHTML","imageStyles","imageMove","imageMultipleStyles","imageTextNear","imagePaste","imagePasteProcess","imageMinWidth","imageOutputSize","imageDefaultMargin","imageAddNewLine","PLUGINS","image","editor","$","DEFAULT_IMAGE_UPLOAD_URL","$current_image","$image_resizer","$handler","$overlay","mousedown","BAD_LINK","MISSING_LINK","ERROR_DURING_UPLOAD","BAD_RESPONSE","MAX_SIZE_EXCEEDED","BAD_FILE_TYPE","NO_CORS_IE","CORRUPTED_IMAGE","error_messages","_refreshInsertPopup","$popup","popups","get","$url_input","find","val","attr","trigger","showInsertPopup","$btn","$tb","_initInsertPopup","hideProgressBar","hasClass","refresh","setContainer","isVisible","button","getPosition","left","top","show","outerHeight","position","forSelection","_showEditPopup","_initEditPopup","$el","getEl","hasCaption","$sc","offset","outerWidth","showProgressBar","_hideInsertPopup","_convertStyleToClasses","$img","parents","length","first","addClass","getAlign","getDisplay","css","_convertClassesToStyle","d","a","_setStyle","removeClass","_refreshImageList","images","el","tagName","querySelectorAll","i","opts","htmlUntouched","useClasses","iframe","on","size","syncIframe","_syncImages","loaded","c_images","Array","prototype","slice","call","image_srcs","push","getAttribute","toggleClass","removeAttribute","parentNode","node","p_node","browser","mozilla","setAttribute","classList","add","n_node","nextSibling","indexOf","events","old_images_srcs","_repositionResizer","_initImageResizer","$container","$wp","append","data","wrap_correction_top","scrollTop","wrap_correction_left","scrollLeft","helpers","getPX","is","iframePaddingTop","iframePaddingLeft","getBoundingClientRect","width","height","_getHandler","pos","_setWidth","_handlerMousedown","e","core","sameInstance","preventDefault","stopPropagation","undo","canDo","saveStep","start_x","pageX","originalEvent","touches","type","oel","$oel","doc","ownerDocument","win","defaultView","parentWindow","editor_inside_iframe","location","parent","ex","frameElement","clientLeft","parentsUntil","html","blockTagsQuery","toFixed","hideAll","_unmarkExit","_handlerMousemove","real_image_size","c_x","s_x","diff_x","Math","round","removeAttr","match","_handlerMouseup","hide","_throwError","code","response","edit","_showErrorMessage","language","translate","remove","message","delayed","$on","disableBlur","image_buttons","buildList","template","buttons","create","no_message","_setProgressMessage","dismiss","focus","run","dropRedo","_exitEdit","selection","setAfter","restore","progress","$layer","text","$message_header","insertByURL","$input","img_url","trim","xhr","XMLHttpRequest","onload","status","upload","Blob","onerror","insert","open","responseType","send","blur","_editImg","_edit","_loadedCallback","next","link","sanitize","$existing_img","off","sanitizeURL","Image","old_src","clone","removeData","replaceWith","atts","attributes","att","nodeName","hasOwnProperty","_addImage","src","_parseResponse","resp","JSON","parse","_parseXMLResponse","key","_imageUploaded","responseXML","responseText","_imageUploadError","_imageUploadProgress","lengthComputable","complete","total","loadCallback","data_str","document","createElement","markers","split","wrap","$marker","after","isLastSibling","insertAfter","clear","_imageUploadAborted","_startUpload","form_data","$image_placeholder","_sendRequest","placeholder","onprogress","onabort","readyState","abort","reader","FileReader","result","binary","atob","array","charCodeAt","window","URL","createObjectURL","Uint8Array","readAsDataURL","_browserUpload","name","Date","getTime","replace","drag_support","formdata","FormData","keyStart","params","url","uploadURL","region","bucket","getXHR","_bindInsertEvents","dt","dataTransfer","files","inst","enableBlur","isIOS","_beforeElementDrop","_drop","img","insertAtPoint","MARKERS","setAtEnd","pageY","$iframe","_initEvents","_mousedown","not","isMobile","areVisible","msie","draggable","_mouseup","shiftKey","keys","isArrow","which","s_el","element","e_el","endElement","_markExit","_selectImage","getSelection","lastNode","isElement","enter","ENTER_BR","$parent","blockParent","defaultTag","onRefresh","onHide","active","splice","buttonList","uploadIndex","urlIndex","upload_layer","id","join","toLowerCase","by_url_layer","progress_bar_layer","progress_bar","_refreshAltPopup","showAltPopup","_initAltPopup","alt_layer","setAlt","alt","_refreshSizePopup","style","showSizePopup","_initSizePopup","size_layer","setSize","regex","showLayer","toolbarInline","toolbarBottom","accessibility","focusPopup","refreshUploadButton","refreshByURLButton","_resizeImage","initPageX","direction","step","floor","pow","shared","$img_overlay","o_win","_mousemove","prevKey","prevTimestamp","ctrlKey","navigator","userAgent","metaKey","keycode","timeStamp","KEYCODE","EQUALS","FF_EQUALS","altKey","HYPHEN","FF_HYPHEN","ENTER","before","setBefore","fillEmptyBlocks","_editorKeydownHandler","key_code","BACKSPACE","DELETE","ESC","ARROW_LEFT","ARROW_RIGHT","F10","isBrowserAction","_cleanOnGet","removeChild","nodeType","Node","ELEMENT_NODE","imgs","_init","isWindowsPhone","touchScroll","TEXT_NODE","INVISIBLE_SPACE","$win","START_MARKER","END_MARKER","paste","saveCopiedText","outerHTML","setTimeout","isCollapsed","C","X","_clipboardPaste","_clipboardPasteCleanup","_uploadPastedImages","$node","_processPastedImage","splitSrc","upload_img","each","index","_img","crossOrigin","canvas","o_doc","context","getContext","naturalHeight","naturalWidth","drawImage","toDataURL","save","_clipboardImageLoaded","target","_processsClipboardPaste","file","clipboardData","items","types","getData","getAsFile","clipboard_html","isDisabled","INSTANCES","toolbar","disable","removeAllRanges","addRange","createRange","bulkRefresh","force_exit","_canExit","enable","img_exit_flag","_display","_align","display","verticalAlign","margin","marginBottom","marginTop","maxWidth","textAlign","marginLeft","marginRight","align","flt","parseInt","refreshAlign","icon","refreshAlignOnShow","$dropdown","refreshDisplayOnShow","range","selectNode","collapse","back","showInline","applyStyle","multipleStyles","styles","toggleCaption","current_width","exitEdit","DefineIcon","NAME","SVG_KEY","RegisterShortcut","P","RegisterCommand","title","refreshAfterCallback","popup","callback","plugin","toggle","options","inline","block","cmd","refreshOnShow","center","right","c","COMMANDS","imageAlign","FA5NAME","cls"],"mappings":"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"}