{"version":3,"file":"table.js","sources":["../../../src/js/plugins/table.js"],"sourcesContent":["import FE from '../index.js'\n\nObject.assign(FE.POPUP_TEMPLATES, {\n  'table.insert': '[_BUTTONS_][_ROWS_COLUMNS_]',\n  'table.edit': '[_BUTTONS_]',\n  'table.colors': '[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]'\n})\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  tableInsertMaxSize: 10,\n  tableEditButtons: ['tableHeader', 'tableRemove', 'tableRows', 'tableColumns', 'tableStyle', '-', 'tableCells', 'tableCellBackground', 'tableCellVerticalAlign', 'tableCellHorizontalAlign', 'tableCellStyle'],\n  tableInsertButtons: ['tableBack', '|'],\n  tableResizer: true,\n  tableDefaultWidth: '100%',\n  tableResizerOffset: 5,\n  tableResizingLimit: 30,\n  tableColorsButtons: ['tableBack', '|'],\n  tableColors: [\n    '#61BD6D', '#1ABC9C', '#54ACD2', '#2C82C9', '#9365B8', '#475577', '#CCCCCC',\n    '#41A85F', '#00A885', '#3D8EB9', '#2969B0', '#553982', '#28324E', '#000000',\n    '#F7DA64', '#FBA026', '#EB6B56', '#E25041', '#A38F84', '#EFEFEF', '#FFFFFF',\n    '#FAC51C', '#F37934', '#D14841', '#B8312F', '#7C706B', '#D1D5D8', 'REMOVE'\n  ],\n  tableColorsStep: 7,\n  tableCellStyles: {\n    'fr-highlighted': 'Highlighted',\n    'fr-thick': 'Thick'\n  },\n  tableStyles: {\n    'fr-dashed-borders': 'Dashed Borders',\n    'fr-alternate-rows': 'Alternate Rows'\n  },\n  tableCellMultipleStyles: true,\n  tableMultipleStyles: true,\n  tableInsertHelper: true,\n  tableInsertHelperOffset: 15\n})\n\nFE.PLUGINS.table = function (editor) {\n  const $= editor.$\n  let $resizer\n  let $insert_helper\n  let mouseDownCellFlag\n  let mouseDownFlag\n  let mouseDownCell\n  let mouseMoveTimer\n  let resizingFlag\n\n  /*\n   * Show the insert table popup.\n   */\n  function _showInsertPopup() {\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"insertTable\"]')\n     \n    let $popup = editor.popups.get('table.insert')\n\n    if (!$popup) $popup = _initInsertPopup()\n\n    if (!$popup.hasClass('fr-active')) {\n\n      // Insert table popup\n      editor.popups.refresh('table.insert')\n      editor.popups.setContainer('table.insert', editor.$tb)\n\n      // Insert table left and top position.\n      const { left, top } = editor.button.getPosition($btn)\n      editor.popups.show('table.insert', left, top, $btn.outerHeight())\n    }\n  }\n\n  /*\n   * Show the table edit popup.\n   */\n  function _showEditPopup() {\n    // Set popup position.\n    const map = _tableMap()\n    if (map) {\n      let $popup = editor.popups.get('table.edit')\n\n      if (!$popup) $popup = _initEditPopup()\n\n      if ($popup) {\n        editor.popups.setContainer('table.edit', editor.$sc)\n        const offset = _selectionOffset(map)\n        let left = offset.left + (offset.right - offset.left) / 2\n        let top = offset.bottom\n\n        editor.popups.show('table.edit', left, top, offset.bottom - offset.top, true)\n\n        // Disable toolbar buttons only if there are more than one cells selected.\n        if (editor.edit.isDisabled()) {\n\n          // Disable toolbar.\n          if (selectedCells().length > 1) {\n            editor.toolbar.disable()\n          }\n\n          // Allow text selection.\n          editor.$el.removeClass('fr-no-selection')\n          editor.edit.on()\n\n          editor.button.bulkRefresh()\n\n          // https://github.com/froala/wysiwyg-editor/issues/1851.\n          // https://github.com/froala-labs/froala-editor-js-2/issues/314.\n          // https://github.com/froala/wysiwyg-editor/issues/1656.\n          // https://github.com/froala-labs/froala-editor-js-2/issues/294.\n\n          // Place selection in last selected table cell.\n          editor.selection.setAtEnd(editor.$el.find('.fr-selected-cell').last().get(0))\n          editor.selection.restore()\n        }\n      }\n    }\n  }\n\n  /*\n   * Show the table colors popup.\n   */\n  function _showColorsPopup() {\n\n    // Set popup position.\n    const map = _tableMap()\n\n    if (map) {\n      let $popup = editor.popups.get('table.colors')\n\n      if (!$popup) $popup = _initColorsPopup()\n\n      editor.popups.setContainer('table.colors', editor.$sc)\n      const offset = _selectionOffset(map)\n      let left = (offset.left + offset.right) / 2\n      let top = offset.bottom\n\n      // Refresh selected color.\n      _refreshColor()\n\n      editor.popups.show('table.colors', left, top, offset.bottom - offset.top, true)\n    }\n  }\n\n  /*\n   * Called on table edit popup hide.\n   */\n  function _hideEditPopup() {\n\n    // Enable toolbar.\n    if (selectedCells().length === 0) {\n      editor.toolbar.enable()\n    }\n  }\n\n  /**\n   * Init the insert table popup.\n   */\n  function _initInsertPopup(delayed) {\n    if (delayed) {\n      editor.popups.onHide('table.insert', function () {\n\n        // Clear previous cell selection.\n        editor.popups.get('table.insert').find('.fr-table-size .fr-select-table-size > span[data-row=\"1\"][data-col=\"1\"]').trigger('mouseover')\n      })\n\n      return true\n    }\n\n    // Table buttons.\n    let table_buttons = ''\n\n    if (editor.opts.tableInsertButtons.length > 0) {\n      table_buttons = '<div class=\"fr-buttons fr-tabs\">' + editor.button.buildList(editor.opts.tableInsertButtons) + '</div>'\n    }\n\n    const template = {\n      buttons: table_buttons,\n      rows_columns: _insertTableHtml()\n    }\n\n    const $popup = editor.popups.create('table.insert', template)\n\n    // Initialize insert table grid events.\n    editor.events.$on($popup, 'mouseover', '.fr-table-size .fr-select-table-size .fr-table-cell', function (e) {\n      _hoverCell($(e.currentTarget))\n    }, true)\n\n    _addAccessibility($popup)\n\n    return $popup\n  }\n\n  /*\n   * Hover table cell.\n   */\n  function _hoverCell($table_cell) {\n    let row = $table_cell.data('row')\n    if(row !== null) {\n      row = parseInt(row)\n    }\n\n    let col = $table_cell.data('col')\n    if(col !== null) {\n      col = parseInt(col)\n    }\n    \n    const $select_size = $table_cell.parent()\n\n    // Update size in title.\n    $select_size.siblings('.fr-table-size-info').html(row + ' &times; ' + col)\n\n    // Remove hover and fr-active-item class from all cells.\n    $select_size.find('> span').removeClass('hover fr-active-item')\n\n    // Add hover class only to the correct cells.\n    for (let i = 1; i <= editor.opts.tableInsertMaxSize; i++) {\n      for (let j = 0; j <= editor.opts.tableInsertMaxSize; j++) {\n        const $cell = $select_size.find('> span[data-row=\"' + i + '\"][data-col=\"' + j + '\"]')\n\n        if (i <= row && j <= col) {\n          $cell.addClass('hover')\n        }\n        else if ((i <= row + 1 || (i <= 2 && !editor.helpers.isMobile()))) {\n          $cell.css('display', 'inline-block')\n        }\n        else if (i > 2 && !editor.helpers.isMobile()) {\n          $cell.css('display', 'none')\n        }\n      }\n    }\n\n    // Mark table cell as the active item.\n    $table_cell.addClass('fr-active-item')\n  }\n\n  /*\n   * The HTML for insert table grid.\n   */\n  function _insertTableHtml() {\n\n    // Grid html\n    let rows_columns = '<div class=\"fr-table-size\"><div class=\"fr-table-size-info\">1 &times; 1</div><div class=\"fr-select-table-size\">'\n\n    for (let i = 1; i <= editor.opts.tableInsertMaxSize; i++) {\n      for (let j = 1; j <= editor.opts.tableInsertMaxSize; j++) {\n        let display = 'inline-block'\n\n        // Display only first 2 rows.\n        if (i > 2 && !editor.helpers.isMobile()) {\n          display = 'none'\n        }\n\n        let cls = 'fr-table-cell '\n\n        if (i == 1 && j == 1) {\n          cls += ' hover'\n        }\n\n        rows_columns += '<span class=\"fr-command ' + cls + '\" tabIndex=\"-1\" data-cmd=\"tableInsert\" data-row=\"' + i + '\" data-col=\"' + j + '\" data-param1=\"' + i + '\" data-param2=\"' + j + '\" style=\"display: ' + display + ';\" role=\"button\"><span></span><span class=\"fr-sr-only\">' + i + ' &times; ' + j + '&nbsp;&nbsp;&nbsp;</span></span>'\n      }\n      rows_columns += '<div class=\"new-line\"></div>'\n    }\n\n    rows_columns += '</div></div>'\n\n    return rows_columns\n  }\n\n  /*\n   * Register keyboard events.\n   */\n  function _addAccessibility($popup) {\n\n    // Hover cell when table.insert cells are focused.\n    editor.events.$on($popup, 'focus', '[tabIndex]', function (e) {\n      const $focused_el = $(e.currentTarget)\n      _hoverCell($focused_el)\n    })\n\n    // Register popup event.\n    editor.events.on('popup.tab', function (e) {\n      const $focused_item = $(e.currentTarget)\n\n      // Skip if popup is not visible or focus is elsewere.\n      if (!editor.popups.isVisible('table.insert') || !$focused_item.is('span, a')) {\n        return true\n      }\n\n      const key_code = e.which\n      let status\n\n      if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\n        if ($focused_item.is('span.fr-table-cell')) {\n\n          // Get all current cells.\n          const $cells = $focused_item.parent().find('span.fr-table-cell')\n\n          // Get focused item position.\n          const index = $cells.index($focused_item)\n\n          // Get cell matrix dimensions.\n          const columns = editor.opts.tableInsertMaxSize\n\n          // Get focused item coordinates.\n          let column = index % columns\n          let line = Math.floor(index / columns)\n\n          // Calculate next coordinates. Go to the other opposite site of the matrix if there is no next adjacent element.\n          if (FE.KEYCODE.ARROW_UP == key_code) {\n            line = Math.max(0, line - 1)\n          }\n          else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n            line = Math.min(editor.opts.tableInsertMaxSize - 1, line + 1)\n          }\n          else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n            column = Math.max(0, column - 1)\n          }\n          else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n            column = Math.min(editor.opts.tableInsertMaxSize - 1, column + 1)\n          }\n\n          // Get the next element based on the new coordinates.\n          const nextIndex = line * columns + column\n          const $el = $($cells.get(nextIndex))\n\n          // Hover cell\n          _hoverCell($el)\n\n          // Focus.\n          editor.events.disableBlur()\n          $el.focus()\n\n          status = false\n        }\n      }\n\n      // ENTER or SPACE.\n      else if (FE.KEYCODE.ENTER == key_code) {\n\n        editor.button.exec($focused_item)\n        status = false\n      }\n\n      // Prevent propagation.\n      if (status === false) {\n        e.preventDefault()\n        e.stopPropagation()\n      }\n\n      return status\n    }, true)\n  }\n\n  /**\n   * Init the table edit popup.\n   */\n  function _initEditPopup(delayed) {\n    if (delayed) {\n      editor.popups.onHide('table.edit', _hideEditPopup)\n\n      return true\n    }\n\n    // Table buttons.\n    let table_buttons = ''\n\n    if (editor.opts.tableEditButtons.length > 0) {\n      table_buttons = `<div class=\"fr-buttons\">${editor.button.buildList(editor.opts.tableEditButtons)}</div>`\n\n      const template = {\n        buttons: table_buttons\n      }\n\n      const $popup = editor.popups.create('table.edit', template)\n\n      editor.events.$on(editor.$wp, 'scroll.table-edit', function () {\n        if (editor.popups.isVisible('table.edit')) {\n          _showEditPopup()\n        }\n      })\n\n      return $popup\n    }\n\n    return false\n  }\n\n  /*\n   * Init the table cell background popup.\n   */\n  function _initColorsPopup() {\n\n    // Table colors buttons.\n    let table_buttons = ''\n\n    if (editor.opts.tableColorsButtons.length > 0) {\n      table_buttons = '<div class=\"fr-buttons fr-tabs\">' + editor.button.buildList(editor.opts.tableColorsButtons) + '</div>'\n    }\n\n    // Custom HEX.\n    let custom_color = ''\n\n    if (editor.opts.colorsHEXInput) {\n      custom_color = '<div class=\"fr-color-hex-layer fr-table-colors-hex-layer fr-active fr-layer\" id=\"fr-table-colors-hex-layer-' + editor.id + '\"><div class=\"fr-input-line\"><input maxlength=\"7\" id=\"fr-table-colors-hex-layer-text-' + editor.id + '\" type=\"text\" placeholder=\"' + editor.language.translate('HEX Color') + '\" tabIndex=\"1\" aria-required=\"true\"></div><div class=\"fr-action-buttons\"><button type=\"button\" class=\"fr-command fr-submit\" data-cmd=\"tableCellBackgroundCustomColor\" tabIndex=\"2\" role=\"button\">' + editor.language.translate('OK') + '</button></div></div>'\n    }\n\n    const template = {\n      buttons: table_buttons,\n      colors: _colorsHTML(),\n      custom_color: custom_color\n    }\n\n    const $popup = editor.popups.create('table.colors', template)\n\n    editor.events.$on(editor.$wp, 'scroll.table-colors', function () {\n      if (editor.popups.isVisible('table.colors')) {\n        _showColorsPopup()\n      }\n    })\n\n    _addColorsAccessibility($popup)\n\n    return $popup\n  }\n\n  /*\n   * HTML for the table colors.\n   */\n  function _colorsHTML() {\n\n    // Create colors html.\n    let colors_html = '<div class=\"fr-color-set fr-table-colors\">'\n\n    // Add colors.\n    for (let i = 0; i < editor.opts.tableColors.length; i++) {\n      if (i !== 0 && i % editor.opts.tableColorsStep === 0) {\n        colors_html += '<br>'\n      }\n\n      if (editor.opts.tableColors[i] != 'REMOVE') {\n        colors_html += '<span class=\"fr-command\" style=\"background: ' + editor.opts.tableColors[i] + ';\" tabIndex=\"-1\" role=\"button\" data-cmd=\"tableCellBackgroundColor\" data-param1=\"' + editor.opts.tableColors[i] + '\"><span class=\"fr-sr-only\">' + editor.language.translate('Color') + ' ' + editor.opts.tableColors[i] + '&nbsp;&nbsp;&nbsp;</span></span>'\n      }\n\n      else {\n        colors_html += '<span class=\"fr-command\" data-cmd=\"tableCellBackgroundColor\" tabIndex=\"-1\" role=\"button\" data-param1=\"REMOVE\" title=\"' + editor.language.translate('Clear Formatting') + '\">' + editor.icon.create('tableColorRemove') + '<span class=\"fr-sr-only\">' + editor.language.translate('Clear Formatting') + '</span></span>'\n      }\n    }\n\n    colors_html += '</div>'\n\n    return colors_html\n  }\n\n  /*\n   * Set custom color\n   */\n  function customColor() {\n    const $popup = editor.popups.get('table.colors')\n    const $input = $popup.find('.fr-table-colors-hex-layer input')\n\n    if ($input.length) {\n      setBackground($input.val())\n    }\n  }\n\n  /*\n   * Register keyboard events for colors.\n   */\n  function _addColorsAccessibility($popup) {\n\n    // Register popup event.\n    editor.events.on('popup.tab', function (e) {\n      const $focused_item = $(e.currentTarget)\n\n      // Skip if popup is not visible or focus is elsewere.\n      if (!editor.popups.isVisible('table.colors') || !$focused_item.is('span')) {\n        return true\n      }\n      const key_code = e.which\n      let status = true\n\n      // Tabbing.\n      if (FE.KEYCODE.TAB == key_code) {\n        const $tb = $popup.find('.fr-buttons')\n\n        // Focus back the popup's toolbar if exists.\n        status = !editor.accessibility.focusToolbar($tb, (e.shiftKey ? true : false))\n      }\n\n      // Arrows.\n      else if (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code || FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_RIGHT == key_code) {\n\n        // Get all current colors.\n        const $colors = $focused_item.parent().find('span.fr-command')\n\n        // Get focused item position.\n        const index = $colors.index($focused_item)\n\n        // Get color matrix dimensions.\n        const columns = editor.opts.colorsStep\n        const lines = Math.floor($colors.length / columns)\n\n        // Get focused item coordinates.\n        const column = index % columns\n        const line = Math.floor(index / columns)\n\n        let nextIndex = line * columns + column\n        const dimension = lines * columns\n\n        // Calculate next index. Go to the other opposite site of the matrix if there is no next adjacent element.\n        // Up/Down: Traverse matrix lines.\n        // Left/Right: Traverse the matrix as it is a vector.\n        if (FE.KEYCODE.ARROW_UP == key_code) {\n          nextIndex = (((nextIndex - columns) % dimension) + dimension) % dimension // Javascript negative modulo bug.\n        }\n        else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n          nextIndex = (nextIndex + columns) % dimension\n        }\n        else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n          nextIndex = (((nextIndex - 1) % dimension) + dimension) % dimension // Javascript negative modulo bug.\n        }\n        else if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n          nextIndex = (nextIndex + 1) % dimension\n        }\n\n        // Get the next element based on the new index.\n        const $el = $($colors.get(nextIndex))\n\n        // Focus.\n        editor.events.disableBlur()\n        $el.focus()\n\n        status = false\n      }\n\n      // ENTER or SPACE.\n      else if (FE.KEYCODE.ENTER == key_code) {\n\n        editor.button.exec($focused_item)\n        status = false\n      }\n\n      // Prevent propagation.\n      if (status === false) {\n        e.preventDefault()\n        e.stopPropagation()\n      }\n\n      return status\n    }, true)\n  }\n\n  /*\n   * Show the current selected color.\n   */\n  function _refreshColor() {\n    const $popup = editor.popups.get('table.colors')\n    const $cell = editor.$el.find('.fr-selected-cell').first()\n    const color = editor.helpers.RGBToHex($cell.css('background-color'))\n    const $input = $popup.find('.fr-table-colors-hex-layer input')\n\n    // Remove current color selection.\n    $popup.find('.fr-selected-color').removeClass('fr-selected-color fr-active-item')\n\n    // Find the selected color.\n    $popup.find('span[data-param1=\"' + color + '\"]').addClass('fr-selected-color fr-active-item')\n    $input.val(color).trigger('change')\n  }\n\n  /*\n   * Insert table method.\n   */\n  function insert(rows, cols) {\n\n    // Create table HTML.\n    let table = '<table ' + (!editor.opts.tableDefaultWidth ? '' : 'style=\"width: ' + editor.opts.tableDefaultWidth + ';\" ') + 'class=\"fr-inserted-table\"><tbody>'\n    const cell_width = 100 / cols\n    let i\n    let j\n\n    for (i = 0; i < rows; i++) {\n      table += '<tr>'\n\n      for (j = 0; j < cols; j++) {\n        table += '<td' + (!editor.opts.tableDefaultWidth ? '' : ' style=\"width: ' + cell_width.toFixed(4) + '%;\"') + '>'\n\n        if (i === 0 && j === 0) table += FE.MARKERS\n        table += '<br></td>'\n      }\n      table += '</tr>'\n    }\n    table += '</tbody></table>'\n\n    editor.html.insert(table)\n\n    // Update cursor position.\n    editor.selection.restore()\n\n    const $table = editor.$el.find('.fr-inserted-table')\n    $table.removeClass('fr-inserted-table')\n    editor.events.trigger('table.inserted', [$table.get(0)])\n  }\n\n  /*\n   * Delete table method.\n   */\n  function remove() {\n    if (selectedCells().length > 0) {\n      const $current_table = selectedTable()\n\n      // Update cursor position.\n      editor.selection.setBefore($current_table.get(0)) || editor.selection.setAfter($current_table.get(0))\n      editor.selection.restore()\n\n      // Hide table edit popup.\n      editor.popups.hide('table.edit')\n\n      // Delete table.\n      $current_table.remove()\n\n      // Enable toolbar.\n      editor.toolbar.enable()\n    }\n  }\n\n  /*\n   * Add table header.\n   */\n  function addHeader() {\n    const $table = selectedTable()\n\n    // If there is a selection in the table and the table doesn't have a header already.\n    if ($table.length > 0 && $table.find('th').length === 0) {\n\n      // Create header HTML.\n      let thead = '<thead><tr>'\n\n      let i\n      let col = 0\n\n      // Get first row and count table columns.\n      $table.find('tr').first().find('> td').each(function () {\n        const $td = $(this)\n\n        col += parseInt($td.attr('colspan'), 10) || 1\n      })\n\n      // Add cells.\n      for (i = 0; i < col; i++) {\n        thead += '<th><br></th>'\n      }\n\n      thead += '</tr></thead>'\n\n      $table.prepend(thead)\n\n      // Reposition table edit popup.\n      _showEditPopup()\n    }\n  }\n\n  /*\n   * Remove table header.\n   */\n  function removeHeader() {\n    const $current_table = selectedTable()\n    const $table_header = $current_table.find('thead')\n\n    // Table has a header.\n    if ($table_header.length > 0) {\n\n      // If table does not have any other rows then delete table.\n      if ($current_table.find('tbody tr').length === 0) {\n\n        // Remove table.\n        remove()\n      }\n\n      else {\n        $table_header.remove()\n\n        // Reposition table edit popup if there any more selected celss.\n        if (selectedCells().length > 0) {\n          _showEditPopup()\n        }\n        else {\n\n          // Hide popup.\n          editor.popups.hide('table.edit')\n\n          // Update cursor position.\n          //const td = $current_table.find('tbody tr:first td:first').get(0)\n          const td = $current_table.find('tbody tr').first().find('td').first().get(0)\n\n          if (td) {\n            editor.selection.setAtEnd(td)\n            editor.selection.restore()\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Insert row method.\n   */\n  function insertRow(position) {\n    const $table = selectedTable()\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n\n      // Cannot insert row above the table header.\n      if (editor.$el.find('th.fr-selected-cell').length > 0 && position == 'above') {\n        return\n      }\n\n      else {\n        let i\n        let ref_row\n        let $ref_row\n\n        // Create a table map.\n        const map = _tableMap()\n\n        // Get selected cells from the table.\n        const selection = _currentSelection(map)\n\n        // Return if no selected cell\n        if(selection == null) {\n          return\n        }\n\n        // Reference row.\n        if (position == 'above') {\n          ref_row = selection.min_i\n        }\n        else {\n          ref_row = selection.max_i\n        }\n\n        // Create row HTML.\n        let tr = '<tr>'\n\n        // Add cells.\n        for (i = 0; i < map[ref_row].length; i++) {\n\n          // If cell has rowspan we should increase it.\n          if ((position == 'below' && ref_row < map.length - 1 && map[ref_row][i] == map[ref_row + 1][i]) ||\n            (position == 'above' && ref_row > 0 && map[ref_row][i] == map[ref_row - 1][i])) {\n\n            // Don't increase twice for colspan.\n            if (i === 0 || (i > 0 && map[ref_row][i] != map[ref_row][i - 1])) {\n              const $cell = $(map[ref_row][i])\n              $cell.attr('rowspan', parseInt($cell.attr('rowspan'), 10) + 1)\n            }\n\n          }\n          else {\n            tr += '<td><br></td>'\n          }\n        }\n\n        // Close row tag.\n        tr += '</tr>'\n\n        // Current selection is in header. Should insert in table body\n        if (editor.$el.find('th.fr-selected-cell').length > 0 && position == 'below') {\n          $ref_row = $($table.find('tbody').not($table.find('> table tbody')))\n        }\n\n        // Selection is in body\n        else {\n          $ref_row = $($table.find('tr').not($table.find('> table tr')).get(ref_row));\n        }\n\n        // Insert new row.\n        if (position == 'below') {\n          if ($ref_row.attr('tagName') == 'TBODY') {\n            $ref_row.prepend(tr)\n          }\n          else {\n            if ($ref_row[0].parentNode) {\n              $ref_row[0].insertAdjacentHTML('afterend', tr)\n            }\n          }\n        }\n        else if (position == 'above') {\n          $ref_row.before(tr)\n\n          // Reposition table edit popup.\n          if (editor.popups.isVisible('table.edit')) {\n            _showEditPopup()\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Delete row method.\n   */\n  function deleteRow() {\n    const $table = selectedTable()\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n      let i\n      let j\n      let $row\n\n      // Create a table map.\n      let map = _tableMap()\n\n      // Get selected cells from the table.\n      const selection = _currentSelection(map)\n\n      // Return if no selected cell\n      if(selection == null) {\n        return\n      }\n\n      // If all the rows are selected then delete the entire table.\n      if (selection.min_i === 0 && selection.max_i == map.length - 1) {\n        remove()\n\n      }\n      else {\n\n        // We should delete selected rows.\n        for (i = selection.max_i; i >= selection.min_i; i--) {\n          // $row = $($table.find('tr').not($table.find('table tr')).get(i))\n          // querySelectorAll is returning incorrect result for $table.find('table tr'), it should only return any nested table tr but it is return own tr's as well. \n          // therefore trying diff way to fetch the table's own rows\n          $row = $($table.find('tr').not($table.find('> table tr')).get(i));\n\n          // Go through the table map to check for rowspan on the row to delete.\n          for (j = 0; j < map[i].length; j++) {\n\n            // Don't do this twice if we have a colspan.\n            if (j === 0 || map[i][j] != map[i][j - 1]) {\n              const $cell = $(map[i][j])\n\n              // We should decrease rowspan.\n              if (parseInt($cell.attr('rowspan'), 10) > 1) {\n                const rowspan = parseInt($cell.attr('rowspan'), 10) - 1\n\n                if (rowspan == 1) {\n                  $cell.removeAttr('rowspan')\n                }\n                else {\n                  $cell.attr('rowspan', rowspan)\n                }\n              }\n\n              // We might need to move tds on the row below if we have a rowspan that starts here.\n              if (i < map.length - 1 && map[i][j] == map[i + 1][j] && (i === 0 || map[i][j] != map[i - 1][j])) {\n\n                // Move td to the row below.\n                const td = map[i][j]\n                let col = j\n\n                // Go back until we get the last element (we might have colspan).\n                while (col > 0 && map[i][col] == map[i][col - 1]) {\n                  col--\n                }\n\n                // Add td at the beginning of the row below.\n                if (col === 0) {\n                  // $($table.find('tr').not($table.find('table tr')).get(i + 1)).prepend(td)\n                  // querySelectorAll is returning incorrect result for $table.find('table tr'), it should only return any nested table tr but it is return own tr's as well. \n                  // therefore trying diff way to fetch the table's own rows\n                  $($table.find('tr').not($table.find('> table tr')).get(i + 1)).prepend(td);\n\n                }\n                else {\n                  if($(map[i+1][col-1])[0].parentNode) {\n                    $(map[i+1][col-1])[0].insertAdjacentElement('afterend', td)\n                  }\n                }\n              }\n            }\n          }\n\n          // Remove tbody or thead if there are no more rows.\n          const $row_parent = $row.parent()\n          $row.remove()\n\n          if ($row_parent.find('tr').length === 0) {\n            $row_parent.remove()\n          }\n\n          // Table has changed.\n          map = _tableMap($table)\n        }\n\n        _updateCellSpan(0, map.length - 1, 0, map[0].length - 1, $table)\n\n        // Update cursor position\n        if (selection.min_i > 0) {\n\n          // Place cursor in the row above selection.\n          editor.selection.setAtEnd(map[selection.min_i - 1][0])\n        }\n        else {\n\n          // Place cursor in the row below selection.\n          editor.selection.setAtEnd(map[0][0])\n        }\n        editor.selection.restore()\n\n        // Hide table edit popup.\n        editor.popups.hide('table.edit')\n      }\n    }\n  }\n\n  /*\n   * Insert column method.\n   */\n  function insertColumn(position) {\n    const $table = selectedTable()\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n\n      // Create a table map.\n      const map = _tableMap()\n\n      // Get selected cells from the table.\n      const selection = _currentSelection(map)\n\n      // Reference row.\n      let ref_col\n\n      if (position == 'before') {\n        ref_col = selection.min_j\n      }\n      else {\n        ref_col = selection.max_j\n      }\n\n      // Old and new column widths.\n      const old_width = 100 / map[0].length\n      const new_width = 100 / (map[0].length + 1)\n\n      // Go through all cells and get their initial (old) widths.\n      let $cell\n\n      $table.find('th, td').each(function () {\n        $cell = $(this)\n        $cell.data('old-width', $cell.outerWidth() / $table.outerWidth() * 100)\n      })\n\n      // Parse each row to insert a new td.\n      $table.find('tr').not($table.find('> table tr')).each(function (index) {\n        // Get the exact td index before / after which we have to add the new td.\n        // ref_col means the table column number, but this is not the same with the td number in a row.\n        // We might have colspan or rowspan greater than 1.\n        const $row = $(this)\n        let col_no = 0\n        let td_no = 0\n        let ref_td\n\n        // Start with the first td (td_no = 0) in the current row.\n        // Sum colspans (col_no) to see when we reach ref_col.\n        // Summing colspans we get the same number with the table column number.\n        while (col_no - 1 < ref_col) {\n\n          // Get current td.\n          ref_td = $row.find('> th, > td').get(td_no)\n\n          // There are no more tds in this row.\n          if (!ref_td) {\n            ref_td = null\n            break\n          }\n\n          // The current td is the same with the td from the table map.\n          if (ref_td == map[index][col_no]) {\n\n            // The current td might have colspan.\n            col_no += parseInt($(ref_td).attr('colspan'), 10) || 1\n\n            // Go to the next td on the current row.\n            td_no++\n          }\n\n          // If current td is not the same with the td from the table map.\n          // This means that this table cell (map[index][td_no]) has rowspan.\n          // There is at least one td less on this row due to rowspan (based on map[index][td_no] colspan value).\n          // We want to count this as a column as well.\n          else {\n            col_no += parseInt($(map[index][col_no]).attr('colspan'), 10) || 1\n\n            // ref_td is one td ahead. Get previous td if we want to insert column after.\n            if (position == 'after') {\n\n              // There is a rowspan and so ref_td is the first td, but it is not in the first column.\n              if (td_no === 0) {\n                ref_td = -1\n\n              }\n              else {\n                ref_td = $row.find('> th, > td').get(td_no - 1)\n              }\n            }\n          }\n        }\n\n        const $ref_td = $(ref_td)\n\n        // If the computed column number is higher than the reference number\n        // then on this row we have a colspan longer than the reference column.\n        // When adding a column after we should increase colspan on this row.\n        //\n        // If we want to add a column before, but the td on the reference column is\n        // the same with the previous one then we have a td with colspan that\n        // starts before the column reference number.\n        // When adding a column before we should increase colspan on this row.\n        if ((position == 'after' && col_no - 1 > ref_col) ||\n          (position == 'before' && ref_col > 0 && map[index][ref_col] == map[index][ref_col - 1])) {\n\n          // Don't increase twice for rowspan.\n          if (index === 0 || (index > 0 && map[index][ref_col] != map[index - 1][ref_col])) {\n            const colspan = parseInt($ref_td.attr('colspan'), 10) + 1\n\n            $ref_td.attr('colspan', colspan)\n\n            // Update this cell's width.\n            $ref_td.css('width', ($ref_td.data('old-width') * new_width / old_width + new_width).toFixed(4) + '%')\n            $ref_td.removeData('old-width')\n          }\n\n        }\n\n        else {\n\n          // Create HTML for a new cell.\n          let td\n\n          // Might be a td or a th.\n          if ($row.find('th').length > 0) {\n            td = '<th style=\"width: ' + new_width.toFixed(4) + '%;\"><br></th>'\n          }\n          else {\n            td = '<td style=\"width: ' + new_width.toFixed(4) + '%;\"><br></td>'\n          }\n\n          // Insert exactly at the beginning.\n          if (ref_td == -1) {\n            $row.prepend(td)\n\n            // Insert exactly at the end.\n          }\n          else if (ref_td == null) {\n            $row.append(td)\n\n            // Insert td on the current row.\n          }\n          else {\n            if (position == 'before') {\n              $ref_td.before(td)\n            }\n\n            else if (position == 'after') {\n              if($ref_td[0].parentNode) {\n                $ref_td[0].insertAdjacentHTML('afterend', td)\n              }\n            }\n          }\n        }\n      })\n\n      // Parse each row to update cells' width.\n      $table.find('th, td').each(function () {\n        $cell = $(this)\n\n        // Update width and remove data.\n        if ($cell.data('old-width')) {\n          $cell.css('width', ($cell.data('old-width') * new_width / old_width).toFixed(4) + '%')\n          $cell.removeData('old-width')\n        }\n      })\n\n      // Reposition table edit popup.\n      if (editor.popups.isVisible('table.edit')) {\n        _showEditPopup()\n      }\n    }\n  }\n\n  /*\n   * Delete column method.\n   */\n  function deleteColumn() {\n    const $table = selectedTable()\n\n    // We have selection in a table.\n    if ($table.length > 0) {\n      let i\n      let j\n      let $cell\n\n      // Create a table map.\n      const map = _tableMap()\n\n      // Get selected cells from the table.\n      const selection = _currentSelection(map)\n\n      // Return if no selected column\n      if(selection == null) {\n        return\n      }\n\n      // If all the rows are selected then delete the entire table.\n      if (selection.min_j === 0 && selection.max_j == map[0].length - 1) {\n        remove()\n      }\n      else {\n        // Old width of all the columns that remain afte the delete.\n        let old_width = 0\n\n        // Go through all cells and get their initial (old) widths.\n        for (i = 0; i < map.length; i++) {\n          for (j = 0; j < map[0].length; j++) {\n            $cell = $(map[i][j])\n\n            if (!$cell.hasClass('fr-selected-cell')) {\n              $cell.data('old-width', $cell.outerWidth() / $table.outerWidth() * 100)\n\n              if (j < selection.min_j || j > selection.max_j) {\n                old_width += $cell.outerWidth() / $table.outerWidth() * 100\n              }\n            }\n          }\n        }\n\n        old_width /= map.length\n\n        // We should delete selected columns.\n        for (j = selection.max_j; j >= selection.min_j; j--) {\n\n          // Go through the table map to check for colspan.\n          for (i = 0; i < map.length; i++) {\n\n            // Don't do this twice if we have a rowspan.\n            if (i === 0 || map[i][j] != map[i - 1][j]) {\n\n              // We should decrease colspan.\n              $cell = $(map[i][j])\n\n              if ((parseInt($cell.attr('colspan'), 10) || 1) > 1) {\n                const colspan = parseInt($cell.attr('colspan'), 10) - 1\n\n                if (colspan == 1) {\n                  $cell.removeAttr('colspan')\n                }\n                else {\n                  $cell.attr('colspan', colspan)\n                }\n\n                // Update cell width.\n                $cell.css('width', (($cell.data('old-width') - _columnWidth(j, map)) * 100 / old_width).toFixed(4) + '%')\n                $cell.removeData('old-width')\n\n                // If there is no colspan delete the cell.\n              }\n              else {\n\n                // We might need to delete the row too if it is empty.\n                const $row = $($cell.parent().get(0))\n\n                $cell.remove()\n\n                // Check if there are any more tds in the current row.\n                if ($row.find('> th, > td').length === 0) {\n\n                  // Check if it is okay to delete the tr.\n                  if ($row.prev().length === 0 || $row.next().length === 0 ||\n                    $row.prev().find('> th[rowspan], > td[rowspan]').length < $row.prev().find('> th, > td').length) {\n                    $row.remove()\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        _updateCellSpan(0, map.length - 1, 0, map[0].length - 1, $table)\n\n        // Update cursor position\n        if (selection.min_j > 0) {\n          // Place cursor in the column before selection.\n          editor.selection.setAtEnd(map[selection.min_i][selection.min_j - 1])\n        }\n        else {\n          // Place cursor in the column after selection.\n          editor.selection.setAtEnd(map[selection.min_i][0])\n        }\n        editor.selection.restore()\n\n        // Hide table edit popup.\n        editor.popups.hide('table.edit')\n\n        // Scale current cells' width after column has been deleted.\n        $table.find('th, td').each(function () {\n          $cell = $(this)\n\n          // Update width and remove data.\n          if ($cell.data('old-width')) {\n            $cell.css('width', ($cell.data('old-width') * 100 / old_width).toFixed(4) + '%')\n            $cell.removeData('old-width')\n          }\n        })\n      }\n    }\n  }\n\n  /*\n   * Update or remove colspan attribute.\n   */\n  function _updateColspan(min_j, max_j, $table) {\n    let i\n    let j\n    let k\n    let first_span\n    let span\n    let decrease = 0\n\n    // Create a table map.\n    const map = _tableMap($table)\n\n    // A column might have been deleted.\n    max_j = Math.min(max_j, map[0].length - 1)\n\n    // If max_j and min_j are the same, then only one column is selected and colspan is preserved.\n    if (max_j > min_j) {\n      // Find out how much we should decrease colspan.\n      // Parsing only the first row is enough.\n      for (j = min_j; j <= max_j; j++) {\n\n        // This cell has colspan and has already been checked.\n        if (j > min_j && map[0][j] == map[0][j - 1]) {\n          continue\n        }\n\n        // Current cell colspan\n        first_span = Math.min(parseInt(map[0][j].getAttribute('colspan'), 10) || 1, max_j - min_j + 1)\n\n        // Cell has colspan between min_j and max_j.\n        /* j + 1 will never exceed the number of columns in a table.\n         * A colspan is detected before the last column and all next cells on that row are skipped.\n         */\n        if (first_span > 1 && map[0][j] == map[0][j + 1]) {\n\n          // The value we should decrease colspan with.\n          decrease = first_span - 1\n\n          // Check all columns on the current row.\n          // We found a colspan on the first row (i = 0), continue with second row (i = 1).\n          for (i = 1; i < map.length; i++) {\n\n            // This cell has rowspan and has already been checked.\n            if (map[i][j] == map[i - 1][j]) {\n              continue\n            }\n\n            // Look for a colspan on the same columns.\n            for (k = j; k < j + first_span; k++) {\n              span = parseInt(map[i][k].getAttribute('colspan'), 10) || 1\n\n              // There are other cells with colspan on this column.\n              /* k + 1 will never exceed the number of columns in a table.\n               * A colspan is detected before the last column and all next cells on that row are skipped.\n               */\n              if (span > 1 && map[i][k] == map[i][k + 1]) {\n                decrease = Math.min(decrease, span - 1)\n\n                // Skip colspan.\n                k += decrease\n              }\n              else {\n                decrease = Math.max(0, decrease - 1)\n\n                // Stop if decrease reaches 0.\n                if (!decrease) {\n                  break\n                }\n              }\n            }\n\n            // Stop looking on the next columns if decrease reaches 0.\n            if (!decrease) {\n              break\n            }\n          }\n        }\n      }\n    }\n\n    // Update colspan attribute.\n    if (decrease) {\n      _decreaseCellSpan(map, decrease, 'colspan', 0, map.length - 1, min_j, max_j)\n    }\n  }\n\n  /*\n   * Update or remove rowspan attribute.\n   */\n  function _updateRowspan(min_i, max_i, $table) {\n    let i\n    let j\n    let k\n    let first_span\n    let span\n    let decrease = 0\n\n    // Create a table map.\n    const map = _tableMap($table)\n\n    // A row might have been deleted.\n    max_i = Math.min(max_i, map.length - 1)\n\n    // If max_i and min_i are the same, then only one row is selected and rowspan is preserved.\n    if (max_i > min_i) {\n      // Find out how much we should decrease rowspan.\n      // Parsing only the first column is enough.\n      for (i = min_i; i <= max_i; i++) {\n\n        // This cell has rowspan and has already been checked.\n        if (i > min_i && map[i][0] == map[i - 1][0]) {\n          continue\n        }\n\n        // Current cell rowspan\n        first_span = Math.min(parseInt(map[i][0].getAttribute('rowspan'), 10) || 1, max_i - min_i + 1)\n\n        // Cell has rowspan between min_i and max_i.\n        /* i + 1 will never exceed the number of rows in a table.\n         * A rowspan is detected before the last row and all next cells on that column are skipped.\n         */\n        if (first_span > 1 && map[i][0] == map[i + 1][0]) {\n\n          // The value we should decrease rowspan with.\n          decrease = first_span - 1\n\n          // Check all columns on the current row.\n          // We found a rowspan on the first column (j = 0), continue with second column (j = 1).\n          for (j = 1; j < map[0].length; j++) {\n\n            // This cell has colspan and has already been checked.\n            if (map[i][j] == map[i][j - 1]) {\n              continue\n            }\n\n            // Look for a rowspan on the same rows.\n            for (k = i; k < i + first_span; k++) {\n              span = parseInt(map[k][j].getAttribute('rowspan'), 10) || 1\n\n              // There are other cells with rowspan on this row.\n              /* k + 1 will never exceed the number of rows in a table.\n               * A rowspan is detected before the last row and all next cells on that column are skipped.\n               */\n              if (span > 1 && map[k][j] == map[k + 1][j]) {\n                decrease = Math.min(decrease, span - 1)\n\n                // Skip rowspan.\n                k += decrease\n              }\n              else {\n                decrease = Math.max(0, decrease - 1)\n\n                // Stop if decrease reaches 0.\n                if (!decrease) {\n                  break\n                }\n              }\n            }\n\n            // Stop looking on the next columns if decrease reaches 0.\n            if (!decrease) {\n              break\n            }\n          }\n        }\n      }\n    }\n\n    // Update rowspan attribute.\n    if (decrease) {\n      _decreaseCellSpan(map, decrease, 'rowspan', min_i, max_i, 0, map[0].length - 1)\n    }\n  }\n\n  /*\n   * Decrease the colspan or rowspan with the amount specified.\n   */\n  function _decreaseCellSpan(map, decrease, span_type, min_i, max_i, min_j, max_j) {\n\n    // Update span attribute.\n    let i\n    let j\n    let span\n\n    // Go only through lines and columns that need to be updated.\n    for (i = min_i; i <= max_i; i++) {\n      for (j = min_j; j <= max_j; j++) {\n\n        // This cell has rowspan or colspan and has already been checked.\n        if ((i > min_i && map[i][j] == map[i - 1][j]) || (j > min_j && map[i][j] == map[i][j - 1])) {\n          continue\n        }\n\n        span = parseInt(map[i][j].getAttribute(span_type), 10) || 1\n\n        // Update cell span.\n        if (span > 1) {\n          if (span - decrease > 1) map[i][j].setAttribute(span_type, span - decrease)\n          else map[i][j].removeAttribute(span_type)\n        }\n      }\n    }\n  }\n\n  /*\n   * Update or remove colspan and rowspan attributes.\n   */\n  function _updateCellSpan(min_i, max_i, min_j, max_j, $table) {\n    _updateRowspan(min_i, max_i, $table)\n    _updateColspan(min_j, max_j, $table)\n  }\n\n  /*\n   * Merge selected cells method.\n   */\n  function mergeCells() {\n\n    // We have more than one cell selected in a table. Cannot merge td and th.\n    if (selectedCells().length > 1 && (editor.$el.find('th.fr-selected-cell').length === 0 || editor.$el.find('td.fr-selected-cell').length === 0)) {\n\n      _removeKeyboardSelectionHandlers()\n\n      // Create a table map.\n      const map = _tableMap()\n\n      // Get selected cells.\n      const selection = _currentSelection(map)\n\n      // Return if no selected cells\n      if(selection == null) {\n        return\n      }\n\n      let i\n      let $cell\n      const cells = editor.$el.find('.fr-selected-cell')\n      const $first_cell = $(cells[0])\n      const $first_row = $first_cell.parent()\n      const first_row_cells = $first_row.find('.fr-selected-cell')\n      const $current_table = $first_cell.closest('table')\n      let content = $first_cell.html()\n      let width = 0\n\n      // Update cell width.\n      for (i = 0; i < first_row_cells.length; i++) {\n        width += $(first_row_cells[i]).outerWidth()\n      }\n\n      // Width might exceed 100% due to cell borders.\n      $first_cell.css('width', Math.min(100, (width / $current_table.outerWidth() * 100)).toFixed(4) + '%')\n\n      // Set the colspan for the merged cells.\n      if (selection.min_j < selection.max_j) {\n        $first_cell.attr('colspan', selection.max_j - selection.min_j + 1)\n      }\n\n      // Set the rowspan for the merged cells.\n      if (selection.min_i < selection.max_i) {\n        $first_cell.attr('rowspan', selection.max_i - selection.min_i + 1)\n      }\n\n      // Go through all selected cells to merge their content.\n      for (i = 1; i < cells.length; i++) {\n        $cell = $(cells[i])\n\n        // If cell is empty, don't add only <br> tags.\n        if ($cell.html() != '<br>' && $cell.html() !== '') {\n          content += '<br>' + $cell.html()\n        }\n\n        // Remove cell.\n        $cell.remove()\n      }\n\n      // Set the HTML content.\n      $first_cell.html(content)\n      editor.selection.setAtEnd($first_cell.get(0))\n      editor.selection.restore()\n\n      // Enable toolbar.\n      editor.toolbar.enable()\n\n      // Update rowspan before removing empty rows (otherwise table map is not correct).\n      _updateRowspan(selection.min_i, selection.max_i, $current_table)\n\n      // Merge is done, check if we have empty trs to clean.\n      const empty_trs = $current_table.find('tr:empty')\n\n      for (i = empty_trs.length - 1; i >= 0; i--) {\n        $(empty_trs[i]).remove()\n      }\n\n      // Update colspan after removing empty rows and updating rowspan.\n      _updateColspan(selection.min_j, selection.max_j, $current_table)\n\n      // Reposition table edit popup.\n      _showEditPopup()\n    }\n  }\n\n  /*\n   * Split cell horizontally method.\n   */\n  function splitCellHorizontally() {\n\n    // We have only one cell selected in a table.\n    if (selectedCells().length == 1) {\n      const $selected_cell = editor.$el.find('.fr-selected-cell')\n      const $current_row = $selected_cell.parent()\n      const $current_table = $selected_cell.closest('table')\n      const current_rowspan = parseInt($selected_cell.attr('rowspan'), 10)\n\n      // Create a table map.\n      const map = _tableMap()\n      const cell_origin = _cellOrigin($selected_cell.get(0), map)\n\n      // Create new td.\n      const $new_td = $selected_cell.clone().html('<br>')\n\n      // Cell has rowspan.\n      if (current_rowspan > 1) {\n\n        // Split current cell's rowspan.\n        const new_rowspan = Math.ceil(current_rowspan / 2)\n\n        if (new_rowspan > 1) {\n          $selected_cell.attr('rowspan', new_rowspan)\n        }\n        else {\n          $selected_cell.removeAttr('rowspan')\n        }\n\n        // Update new td's rowspan.\n        if (current_rowspan - new_rowspan > 1) {\n          $new_td.attr('rowspan', current_rowspan - new_rowspan)\n        }\n        else {\n          $new_td.removeAttr('rowspan')\n        }\n\n        // Find where we should insert the new td.\n        const row = cell_origin.row + new_rowspan\n        let col = cell_origin.col === 0 ? cell_origin.col : cell_origin.col - 1\n\n        // Go back until we find a td on this row. We might have colspans and rowspans.\n        while (col >= 0 && (map[row][col] == map[row][col - 1] || (row > 0 && map[row][col] == map[row - 1][col]))) {\n          col--\n        }\n\n        if (col == -1) {\n\n          // We couldn't find a previous td on this row. Prepend the new td.\n          // $($current_table.find('tr').not($current_table.find('table tr')).get(row)).prepend($new_td)\n          // querySelectorAll is returning incorrect result for $table.find('table tr'), it should only return any nested table tr but it is return own tr's as well. \n          // therefore trying diff way to fetch the table's own rows\n          $($current_table.find('tr').not($current_table.find('> table tr')).get(row)).prepend($new_td);\n\n\n        }\n        else {\n          if($(map[row][col])[0].parentNode) {\n            $(map[row][col])[0].insertAdjacentElement('afterend', $new_td[0])\n          }\n        }\n\n      }\n      else {\n\n        // Add new row bellow with only one cell.\n        const $row = $(document.createElement('tr')).append($new_td)\n        let i\n\n        // Increase rowspan for all cells on the current row.\n        for (i = 0; i < map[0].length; i++) {\n\n          // Don't do this twice if we have a colspan.\n          if (i === 0 || map[cell_origin.row][i] != map[cell_origin.row][i - 1]) {\n            const $cell = $(map[cell_origin.row][i])\n\n            if (!$cell.is($selected_cell)) {\n              $cell.attr('rowspan', (parseInt($cell.attr('rowspan'), 10) || 1) + 1)\n            }\n          }\n        }\n\n        if($current_row[0].parentNode) {\n          $current_row[0].insertAdjacentElement('afterend', $row[0])\n        }\n      }\n\n      // Remove selection\n      _removeSelection()\n\n      // Hide table edit popup.\n      editor.popups.hide('table.edit')\n    }\n  }\n\n  /*\n   * Split cell vertically method.\n   */\n  function splitCellVertically() {\n\n    // We have only one cell selected in a table.\n    if (selectedCells().length == 1) {\n      const $selected_cell = editor.$el.find('.fr-selected-cell')\n      const current_colspan = parseInt($selected_cell.attr('colspan'), 10) || 1\n      const parent_width = $selected_cell.parent().outerWidth()\n      let width = $selected_cell.outerWidth()\n\n      // Create new td.\n      const $new_td = $selected_cell.clone().html('<br>')\n\n      // Create a table map.\n      const map = _tableMap()\n      const cell_origin = _cellOrigin($selected_cell.get(0), map)\n\n      if (current_colspan > 1) {\n\n        // Split current colspan.\n        const new_colspan = Math.ceil(current_colspan / 2)\n\n        width = _columnsWidth(cell_origin.col, cell_origin.col + new_colspan - 1, map) / parent_width * 100\n        const new_width = _columnsWidth(cell_origin.col + new_colspan, cell_origin.col + current_colspan - 1, map) / parent_width * 100\n\n        // Update colspan for current cell.\n        if (new_colspan > 1) {\n          $selected_cell.attr('colspan', new_colspan)\n        }\n        else {\n          $selected_cell.removeAttr('colspan')\n        }\n\n        // Update new td's colspan.\n        if (current_colspan - new_colspan > 1) {\n          $new_td.attr('colspan', current_colspan - new_colspan)\n        }\n        else {\n          $new_td.removeAttr('colspan')\n        }\n\n        // Update cell width.\n        $selected_cell.css('width', width.toFixed(4) + '%')\n        $new_td.css('width', new_width.toFixed(4) + '%')\n\n        // Increase colspan for all cells on the current column.\n      }\n      else {\n        let i\n\n        for (i = 0; i < map.length; i++) {\n\n          // Don't do this twice if we have a rowspan.\n          if (i === 0 || map[i][cell_origin.col] != map[i - 1][cell_origin.col]) {\n            const $cell = $(map[i][cell_origin.col])\n\n            if (!$cell.is($selected_cell)) {\n              const colspan = (parseInt($cell.attr('colspan'), 10) || 1) + 1\n              $cell.attr('colspan', colspan)\n            }\n          }\n        }\n\n        // Update cell width.\n        width = width / parent_width * 100 / 2\n\n        $selected_cell.css('width', width.toFixed(4) + '%')\n        $new_td.css('width', width.toFixed(4) + '%')\n      }\n\n      // Add a new td after the current one.\n      if($selected_cell[0].parentNode) {\n        $selected_cell[0].insertAdjacentElement('afterend', $new_td[0])\n      }\n\n      // Remove selection\n      _removeSelection()\n\n      // Hide table edit popup.\n      editor.popups.hide('table.edit')\n    }\n  }\n\n  /*\n   * Set background color to selected cells.\n   */\n  function setBackground(color) {\n    const $selected_cells = editor.$el.find('.fr-selected-cell')\n\n    // Set background  color.\n    if (color != 'REMOVE') {\n      $selected_cells.css('background-color', editor.helpers.HEXtoRGB(color))\n    }\n\n    // Remove background color.\n    else {\n      $selected_cells.css('background-color', '')\n    }\n\n    _showEditPopup()\n  }\n\n  /*\n   * Set vertical align to selected cells.\n   */\n  function verticalAlign(val) {\n    editor.$el.find('.fr-selected-cell').css('vertical-align', val)\n  }\n\n  /*\n   * Apply horizontal alignment to selected cells.\n   */\n  function horizontalAlign(val) {\n    editor.$el.find('.fr-selected-cell').css('text-align', val)\n  }\n\n  /**\n   * Apply specific style to selected table or selected cells.\n   * val              class to apply.\n   * obj              table or selected cells.\n   * multiple_styles  editor.opts.tableStyles or editor.opts.tableCellStyles.\n   * style            editor.opts.tableStyles or editor.opts.tableCellStyles\n   */\n  function applyStyle(val, obj, multiple_styles, styles) {\n    if (obj.length > 0) {\n\n      // Remove multiple styles.\n      if (!multiple_styles) {\n        const classes = Object.keys(styles)\n        classes.splice(classes.indexOf(val), 1)\n        obj.removeClass(classes.join(' '))\n      }\n\n      obj.toggleClass(val)\n    }\n  }\n\n  /*\n   * Create a table map.\n   */\n  function _tableMap($table) {\n    $table = $table || null\n\n    const map = []\n\n    if ($table == null && selectedCells().length > 0) {\n      $table = selectedTable()\n    }\n\n    if ($table) {\n      $table.findVisible('tr').not($table.find('> table tr')).each(function (row, tr) {\n        const $tr = $(tr)\n\n        let c_index = 0\n        $tr.find('> th, > td').each(function (col, td) {\n          const $td = $(td)\n          const cspan = parseInt($td.attr('colspan'), 10) || 1\n          const rspan = parseInt($td.attr('rowspan'), 10) || 1\n\n          for (let i = row; i < row + rspan; i++) {\n            for (let j = c_index; j < c_index + cspan; j++) {\n              if (!map[i]) map[i] = []\n\n              if (!map[i][j]) {\n                map[i][j] = td\n              }\n              else {\n                c_index++\n              }\n            }\n          }\n\n          c_index += cspan\n        })\n      })\n    }\n\n    return map\n  }\n\n  /*\n   * Get the i, j coordinates of a cell in the table map.\n   * These are the coordinates where the cell starts.\n   */\n  function _cellOrigin(td, map) {\n    for (let i = 0; i < map.length; i++) {\n      for (let j = 0; j < map[i].length; j++) {\n        if (map[i][j] == td) {\n          return {\n            row: i,\n            col: j\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Get the i, j coordinates where a cell ends in the table map.\n   */\n  function _cellEnds(origin_i, origin_j, map) {\n    let max_i = origin_i + 1\n    let max_j = origin_j + 1\n\n    // Compute max_i\n    while (max_i < map.length) {\n      if (map[max_i][origin_j] != map[origin_i][origin_j]) {\n        max_i--\n        break\n      }\n\n      max_i++\n    }\n\n    if (max_i == map.length) {\n      max_i--\n    }\n\n    // Compute max_j\n    while (max_j < map[origin_i].length) {\n      if (map[origin_i][max_j] != map[origin_i][origin_j]) {\n        max_j--\n        break\n      }\n\n      max_j++\n    }\n\n    if (max_j == map[origin_i].length) {\n      max_j--\n    }\n\n    return {\n      row: max_i,\n      col: max_j\n    }\n  }\n\n  /*\n   * Remove handler classes that are used to select table cells with keyboard.\n   */\n  function _removeKeyboardSelectionHandlers() {\n    if (editor.el.querySelector('.fr-cell-fixed')) {\n      editor.el.querySelector('.fr-cell-fixed').classList.remove('fr-cell-fixed')\n    }\n\n    if (editor.el.querySelector('.fr-cell-handler')) {\n      editor.el.querySelector('.fr-cell-handler').classList.remove('fr-cell-handler')\n    }\n  }\n\n  /*\n   * Remove selection from cells.\n   */\n  function _removeSelection() {\n    const cells = editor.$el.find('.fr-selected-cell')\n\n    if (cells.length > 0) {\n\n      // Remove selection.\n      cells.each(function () {\n        const $cell = $(this)\n\n        $cell.removeClass('fr-selected-cell')\n\n        if ($cell.attr('class') === '') {\n          $cell.removeAttr('class')\n        }\n      })\n    }\n\n    _removeKeyboardSelectionHandlers()\n  }\n\n  /*\n   * Clear selection to prevent Firefox cell selection.\n   */\n  function _clearSelection() {\n    editor.events.disableBlur()\n    editor.selection.clear()\n\n    // Prevent text selection while selecting multiple cells.\n    // Happens in Chrome.\n    editor.$el.addClass('fr-no-selection')\n\n    // Cursor will not appear if we don't make blur.\n    editor.$el.blur()\n    editor.events.enableBlur()\n  }\n\n  /*\n   * Get current selected cells coordintates.\n   */\n  function _currentSelection(map) {\n    const cells = editor.$el.find('.fr-selected-cell')\n    if (cells.length > 0) {\n      let min_i = map.length\n      let max_i = 0\n      let min_j = map[0].length\n      let max_j = 0\n      let i\n\n      for (i = 0; i < cells.length; i++) {\n        const cellOrigin = _cellOrigin(cells[i], map)\n        const cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\n\n        min_i = Math.min(cellOrigin.row, min_i)\n        max_i = Math.max(cellEnd.row, max_i)\n        min_j = Math.min(cellOrigin.col, min_j)\n        max_j = Math.max(cellEnd.col, max_j)\n      }\n\n      return {\n        min_i: min_i,\n        max_i: max_i,\n        min_j: min_j,\n        max_j: max_j\n      }\n    }\n    else {\n      return null\n    }\n  }\n\n  /*\n   * Minimum and maximum coordinates for the selection in the table map.\n   */\n  function _selectionLimits(min_i, max_i, min_j, max_j, map) {\n    let first_i = min_i\n    let last_i = max_i\n    let first_j = min_j\n    let last_j = max_j\n    let i\n    let j\n    let cellOrigin\n    let cellEnd\n\n    // Go through first and last columns.\n    for (i = first_i; i <= last_i; i++) {\n\n      // First column.\n      if ((parseInt($(map[i][first_j]).attr('rowspan'), 10) || 1) > 1 ||\n        (parseInt($(map[i][first_j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[i][first_j], map)\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\n\n        first_i = Math.min(cellOrigin.row, first_i)\n        last_i = Math.max(cellEnd.row, last_i)\n        first_j = Math.min(cellOrigin.col, first_j)\n        last_j = Math.max(cellEnd.col, last_j)\n      }\n\n      // Last column.\n      if ((parseInt($(map[i][last_j]).attr('rowspan'), 10) || 1) > 1 ||\n        (parseInt($(map[i][last_j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[i][last_j], map)\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\n\n        first_i = Math.min(cellOrigin.row, first_i)\n        last_i = Math.max(cellEnd.row, last_i)\n        first_j = Math.min(cellOrigin.col, first_j)\n        last_j = Math.max(cellEnd.col, last_j)\n      }\n    }\n\n    // Go through first and last rows.\n    for (j = first_j; j <= last_j; j++) {\n\n      // First row.\n      if ((parseInt($(map[first_i][j]).attr('rowspan'), 10) || 1) > 1 ||\n        (parseInt($(map[first_i][j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[first_i][j], map)\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\n\n        first_i = Math.min(cellOrigin.row, first_i)\n        last_i = Math.max(cellEnd.row, last_i)\n        first_j = Math.min(cellOrigin.col, first_j)\n        last_j = Math.max(cellEnd.col, last_j)\n      }\n\n      // Last column.\n      if ((parseInt($(map[last_i][j]).attr('rowspan'), 10) || 1) > 1 ||\n        (parseInt($(map[last_i][j]).attr('colspan'), 10) || 1) > 1) {\n        cellOrigin = _cellOrigin(map[last_i][j], map)\n        cellEnd = _cellEnds(cellOrigin.row, cellOrigin.col, map)\n\n        first_i = Math.min(cellOrigin.row, first_i)\n        last_i = Math.max(cellEnd.row, last_i)\n        first_j = Math.min(cellOrigin.col, first_j)\n        last_j = Math.max(cellEnd.col, last_j)\n      }\n    }\n\n    if (first_i == min_i && last_i == max_i && first_j == min_j && last_j == max_j) {\n      return {\n        min_i: min_i,\n        max_i: max_i,\n        min_j: min_j,\n        max_j: max_j\n      }\n\n    }\n    else {\n      return _selectionLimits(first_i, last_i, first_j, last_j, map)\n    }\n  }\n\n  /*\n   * Get the left and right offset position for the current selection.\n   */\n  function _selectionOffset(map) {\n    const selection = _currentSelection(map)\n\n    // Return if no selected item\n    if(selection == null) {\n      return\n    }\n    \n    // Top left cell.\n    const $tl = $(map[selection.min_i][selection.min_j])\n\n    // Top right cell.\n    const $tr = $(map[selection.min_i][selection.max_j])\n\n    // Bottom left cell.\n    const $bl = $(map[selection.max_i][selection.min_j])\n\n    const left = $tl.offset().left\n    const right = $tr.offset().left + $tr.outerWidth()\n    const top = $tl.offset().top\n    const bottom = $bl.offset().top + $bl.outerHeight()\n\n    return {\n      left: left,\n      right: right,\n      top: top,\n      bottom: bottom\n    }\n  }\n\n  /*\n   * Select table cells.\n   * firstCell is either the top left corner or the fr-cell-fixed corner of the selection.\n   * lastCell is either the bottom right corner ot the fr-cell-handler of the selection.\n   */\n  function selectCells(firstCell, lastCell) {\n\n    // If the first and last cells are the same then just select it.\n    if ($(firstCell).is(lastCell)) {\n\n      // Remove previous selection.\n      _removeSelection()\n\n      $(firstCell).addClass('fr-selected-cell')\n    }\n\n    // Select multiple cells.\n    else {\n      // Prevent Firefox cell selection.\n      _clearSelection()\n\n      // Turn editor toolbar off.\n      editor.edit.off()\n\n      // Create a table map.\n      const map = _tableMap()\n\n      // Get first and last cell's i and j map coordinates.\n      const firstCellOrigin = _cellOrigin(firstCell, map)\n      const lastCellOrigin = _cellOrigin(lastCell, map)\n\n      // Some cells between these coordinates might have colspan or rowspan.\n      // The selected area exceeds first and last cells' coordinates.\n      const limits = _selectionLimits(Math.min(firstCellOrigin.row, lastCellOrigin.row),\n        Math.max(firstCellOrigin.row, lastCellOrigin.row),\n        Math.min(firstCellOrigin.col, lastCellOrigin.col),\n        Math.max(firstCellOrigin.col, lastCellOrigin.col),\n        map)\n\n      // Remove previous selection.\n      _removeSelection()\n\n      // We always need to set the selection handler classes as user may use keyboard to select at anytime.\n      firstCell.classList.add('fr-cell-fixed')\n      lastCell.classList.add('fr-cell-handler')\n\n      // Select all cells between the first and last cell.\n      for (let i = limits.min_i; i <= limits.max_i; i++) {\n        for (let j = limits.min_j; j <= limits.max_j; j++) {\n          $(map[i][j]).addClass('fr-selected-cell')\n        }\n      }\n    }\n  }\n\n  /*\n   * Get the cell under the mouse cursor.\n   */\n  function _getCellUnder(e) {\n    let cell = null\n    const $target = $(e.target)\n\n    if (e.target.tagName == 'TD' || e.target.tagName == 'TH') {\n      cell = e.target\n    }\n    else if ($target.closest('td').length > 0) {\n      cell = $target.closest('td').get(0)\n    }\n    else if ($target.closest('th').length > 0) {\n      cell = $target.closest('th').get(0)\n    }\n\n    // Cell should reside inside editor.\n    if (editor.$el.html.toString().search(cell) === -1) return null\n\n    return cell\n  }\n\n  /*\n   * Stop table cell editing and allow text editing.\n   */\n  function _stopEdit() {\n\n    // Clear previous selection.\n    _removeSelection()\n\n    // Hide table edit popup.\n    editor.popups.hide('table.edit')\n  }\n\n  /*\n   * Mark that mouse is down.\n   */\n  function _mouseDown(e) {\n    const cell = _getCellUnder(e)\n\n    if ($(cell).parents('[contenteditable]').not('.fr-element').not('.fr-img-caption').not('body').first().attr('contenteditable') == 'false') return true\n\n    // Stop table editing if user clicks outside the table.\n    if (selectedCells().length > 0 && !cell) {\n      _stopEdit()\n    }\n\n    // Only do mouseDown if the editor is not disabled by user.\n    if (!editor.edit.isDisabled() || editor.popups.isVisible('table.edit')) {\n\n      // On left click.\n      if (e.which == 1 && !(e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) {\n        mouseDownFlag = true\n\n        // User clicked on a table cell.\n        if (cell) {\n\n          // We always have to clear previous selection except when using shift key to select multiple cells.\n          if (selectedCells().length > 0 && !e.shiftKey) {\n            _stopEdit()\n          }\n\n          e.stopPropagation()\n\n          editor.events.trigger('image.hideResizer')\n          editor.events.trigger('video.hideResizer')\n\n          // Keep record of left mouse click being down\n          mouseDownCellFlag = true\n\n          const tag_name = cell.tagName.toLowerCase()\n\n          // Select multiple cells using Shift key\n          if (e.shiftKey && editor.$el.find(tag_name + '.fr-selected-cell').length > 0) {\n\n            // Cells must be in the same table.\n            if ($(editor.$el.find(tag_name + '.fr-selected-cell').closest('table')).is($(cell).closest('table'))) {\n\n              // Select cells between.\n              selectCells(mouseDownCell, cell)\n\n              // Do nothing if cells are not in the same table.\n            }\n            else {\n\n              // Prevent Firefox selection.\n              _clearSelection()\n            }\n          }\n\n          else {\n\n            // Prevent Firefox selection for ctrl / cmd key.\n            // https://github.com/froala/wysiwyg-editor/issues/1323:\n            //  - we have more than one cell selected or\n            //  - selection is starting in another cell than the one we clicked on.\n            if ((editor.keys.ctrlKey(e) || e.shiftKey) && (selectedCells().length > 1 || ($(cell).find(editor.selection.element()).length === 0 && !$(cell).is(editor.selection.element())))) {\n              _clearSelection()\n            }\n\n            // Save cell where mouse has been clicked\n            mouseDownCell = cell\n\n            // Select cell.\n            if (editor.opts.tableEditButtons.length > 0) {\n              selectCells(mouseDownCell, mouseDownCell)\n            }\n          }\n        }\n      }\n\n      // On right click stop table editing.\n      else if ((e.which == 3 || (e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) && cell) {\n        _stopEdit()\n      }\n    }\n  }\n\n  /*\n   * Notify that mouse is no longer pressed.\n   */\n  function _mouseUp(e) {\n\n    // Mouse down started in a popup and ends in the editor.\n    // https://github.com/froala/wysiwyg-editor/issues/3190\n    if (editor.popups.areVisible()) {\n      return true;\n    }\n\n    // User clicked somewhere else in the editor (except the toolbar).\n    // We need this because mouse down is not triggered outside the editor.\n    if (!mouseDownCellFlag && !editor.$tb.is(e.target) && !editor.$tb.is($(e.target).closest('.fr-toolbar'))) {\n      if (selectedCells().length > 0) {\n        editor.toolbar.enable()\n      }\n\n      _removeSelection()\n    }\n\n    // On left click.\n    if (e.which == 1 && !(e.which == 1 && editor.helpers.isMac() && e.ctrlKey)) {\n      mouseDownFlag = false\n\n      // Mouse down was in a table cell.\n      if (mouseDownCellFlag) {\n\n        // Left click is no longer pressed.\n        mouseDownCellFlag = false\n\n        const cell = _getCellUnder(e)\n\n        // If we have one selected cell and mouse is lifted somewhere else.\n        if (!cell && selectedCells().length == 1) {\n\n          // We have a text selection and not cell selection.\n          _removeSelection()\n        }\n\n        // If there are selected cells then show table edit popup.\n        else if (selectedCells().length > 0) {\n          if (editor.selection.isCollapsed()) {\n            _showEditPopup()\n          }\n\n          // No text selection.\n          else {\n            _removeSelection()\n          }\n        }\n      }\n\n      // Resizing stops.\n      if (resizingFlag) {\n        resizingFlag = false\n\n        $resizer.removeClass('fr-moving')\n\n        // Allow text selection.\n        editor.$el.removeClass('fr-no-selection')\n        editor.edit.on()\n\n        // Set release Y coordinate.\n        let left = parseFloat($resizer.css('left')) + editor.opts.tableResizerOffset + editor.$wp.offset().left\n\n        if (editor.opts.iframe) {\n          left -= editor.$iframe.offset().left\n        }\n        $resizer.data('release-position', left)\n\n        // Clear resizing limits.\n        $resizer.removeData('max-left')\n        $resizer.removeData('max-right')\n\n        // Resize.\n        _resize(e)\n\n        // Hide resizer.\n        _hideResizer()\n      }\n    }\n  }\n\n  /*\n   * User drags mouse over multiple cells to select them.\n   */\n  function _mouseEnter(e) {\n    if (mouseDownCellFlag === true && editor.opts.tableEditButtons.length > 0) {\n      const $cell = $(e.currentTarget)\n\n      // Cells should be in the same table.\n      if ($cell.closest('table').is(selectedTable())) {\n\n        // Don't select both ths and tds.\n        if (e.currentTarget.tagName == 'TD' && editor.$el.find('th.fr-selected-cell').length === 0) {\n\n          // Select cells between.\n          selectCells(mouseDownCell, e.currentTarget)\n\n          return\n        }\n\n        else if (e.currentTarget.tagName == 'TH' && editor.$el.find('td.fr-selected-cell').length === 0) {\n\n          // Select cells between.\n          selectCells(mouseDownCell, e.currentTarget)\n\n          return\n        }\n      }\n\n      // Prevent firefox selection.\n      _clearSelection()\n    }\n  }\n\n  /*\n   * Move cursor in a nested table.\n   */\n  function _moveInNestedTable(cell, direction) {\n    let table = cell\n\n    // Get parent table (editor might be initialized inside cell).\n    while (table && table.tagName != 'TABLE' && table.parentNode != editor.el) {\n      table = table.parentNode\n    }\n\n    if (table && table.tagName == 'TABLE') {\n      const new_map = _tableMap($(table))\n\n      // Move up in the parent table.\n      if (direction == 'up') _moveUp(_cellOrigin(cell, new_map), table, new_map)\n      else if (direction == 'down') _moveDown(_cellOrigin(cell, new_map), table, new_map)\n    }\n  }\n\n  /*\n   * Move cursor up or down outside table.\n   */\n  function _moveWithArrows(origin, table, map, direction) {\n    let up = table\n    let sibling\n\n    // Look up in DOM for the previous or next element.\n    while (up != editor.el) {\n\n      // Nested table.\n      if (up.tagName == 'TD' || up.tagName == 'TH') {\n        break\n      }\n\n      // The table has a sibling element.\n      if (direction == 'up') sibling = up.previousElementSibling\n      else if (direction == 'down') sibling = up.nextElementSibling\n\n      if (sibling) {\n        break\n      }\n\n      // Table might be in a block tag.\n      up = up.parentNode\n    }\n\n    // We have another table (nested).\n    if (up.tagName == 'TD' || up.tagName == 'TH') {\n      _moveInNestedTable(up, direction)\n    }\n\n    // Table has a sibling.\n    else if (sibling) {\n      if (direction == 'up') editor.selection.setAtEnd(sibling)\n\n      if (direction == 'down') editor.selection.setAtStart(sibling)\n    }\n  }\n\n  /*\n   * Move cursor up while in table cell.\n   */\n  function _moveUp(origin, table, map) {\n\n    // Not the first line.\n    if (origin.row > 0) {\n      editor.selection.setAtEnd(map[origin.row - 1][origin.col])\n    }\n\n    // First line.\n    else {\n      _moveWithArrows(origin, table, map, 'up')\n    }\n  }\n\n  /*\n   * Move cursor down while in table cell.\n   */\n  function _moveDown(origin, table, map) {\n\n    // Cell might have rowspan.\n    const row = parseInt(map[origin.row][origin.col].getAttribute('rowspan'), 10) || 1\n\n    // Not the last line.\n    if (origin.row < map.length - row) {\n      editor.selection.setAtStart(map[origin.row + row][origin.col])\n    }\n\n    // Last line.\n    else {\n      _moveWithArrows(origin, table, map, 'down')\n    }\n  }\n\n  /*\n   * Using the arrow keys to move the cursor through the table will not select cells.\n   */\n  function _navigateWithArrows(e) {\n    const key_code = e.which\n\n    // Get current selection.\n    let sel = editor.selection.blocks()\n\n    if (sel.length) {\n      sel = sel[0]\n\n      // Selection should be in a table cell.\n      if (sel.tagName == 'TD' || sel.tagName == 'TH') {\n        let table = sel\n\n        // Get parent table (editor might be initialized inside cell).\n        while (table && table.tagName != 'TABLE' && table.parentNode != editor.el) {\n          table = table.parentNode\n        }\n\n        if (table && table.tagName == 'TABLE') {\n          if (FE.KEYCODE.ARROW_LEFT == key_code || FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_RIGHT == key_code || FE.KEYCODE.ARROW_DOWN == key_code) {\n            if (selectedCells().length > 0) {\n              _stopEdit()\n            }\n\n            // Up and down in Webkit.\n            if (editor.browser.webkit && (FE.KEYCODE.ARROW_UP == key_code || FE.KEYCODE.ARROW_DOWN == key_code)) {\n              const node = editor.selection.ranges(0).startContainer\n\n              if (node.nodeType == Node.TEXT_NODE && ((FE.KEYCODE.ARROW_UP == key_code && node.previousSibling) || (FE.KEYCODE.ARROW_DOWN == key_code && node.nextSibling))) {\n                return\n              }\n\n              e.preventDefault()\n              e.stopPropagation()\n\n              // Table map.\n              const map = _tableMap($(table))\n\n              // Current cell map coordinates.\n              const origin = _cellOrigin(sel, map)\n\n              // Arrow up\n              if (FE.KEYCODE.ARROW_UP == key_code) {\n                _moveUp(origin, table, map)\n              }\n\n              // Arrow down\n              else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n                _moveDown(origin, table, map)\n              }\n\n              // Update cursor position.\n              editor.selection.restore()\n\n              return false\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /*\n   * Initilize table resizer.\n   */\n  function _initResizer() {\n\n    // Append resizer HTML to editor wrapper.\n    if (!editor.shared.$table_resizer) editor.shared.$table_resizer = $(document.createElement('div')).attr('class', 'fr-table-resizer').html('<div></div>')\n    $resizer = editor.shared.$table_resizer\n\n    // Resize table. Mousedown.\n    editor.events.$on($resizer, 'mousedown', function (e) {\n      if (!editor.core.sameInstance($resizer)) return true\n\n      // Stop table editing.\n      if (selectedCells().length > 0) {\n        _stopEdit()\n      }\n\n      // Resize table only using left click.\n      if (e.which == 1) {\n\n        // Save selection so that we can put cursor back at the end.\n        editor.selection.save()\n\n        resizingFlag = true\n\n        $resizer.addClass('fr-moving')\n\n        // Prevent text selection while dragging the table resizer.\n        _clearSelection()\n\n        // Turn editor toolbar off while resizing.\n        editor.edit.off()\n\n        // Show resizer.\n        $resizer.find('div').css('opacity', 1)\n\n        // Prevent selecting text when doing resize.\n        return false\n      }\n    })\n\n    // Mousemove on table resizer.\n    editor.events.$on($resizer, 'mousemove', function (e) {\n      if (!editor.core.sameInstance($resizer)) return true\n\n      if (resizingFlag) {\n        if (editor.opts.iframe) {\n          e.pageX -= editor.$iframe.offset().left\n        }\n\n        _mouseMove(e)\n      }\n    })\n\n    // Editor destroy.\n    editor.events.on('shared.destroy', function () {\n      $resizer.html('').removeData().remove()\n      $resizer = null\n    }, true)\n\n    editor.events.on('destroy', function () {\n      editor.$el.find('.fr-selected-cell').removeClass('fr-selected-cell')\n      $('body').first().append($resizer.hide())\n    }, true)\n  }\n\n  /*\n   * Also clears top and left values, so it doesn't interfer with the insert helper.\n   */\n  function _hideResizer() {\n    if ($resizer) {\n      $resizer.find('div').css('opacity', 0)\n      $resizer.css('top', 0)\n      $resizer.css('left', 0)\n      $resizer.css('height', 0)\n      $resizer.find('div').css('height', 0)\n      $resizer.hide()\n    }\n  }\n\n  /**\n   * Hide the insert helper.\n   */\n  function _hideInsertHelper() {\n    if ($insert_helper) $insert_helper.removeClass('fr-visible').css('left', '-9999px')\n  }\n\n  /*\n   * Place the table resizer between the columns where the mouse is.\n   */\n  function _placeResizer(e, tag_under) {\n    let $tag_under = $(tag_under)\n    const $table = $tag_under.closest('table')\n    const $table_parent = $table.parent()\n\n    // We might have another tag inside the table cell.\n    if (tag_under && (tag_under.tagName != 'TD' && tag_under.tagName != 'TH')) {\n      if ($tag_under.closest('td').length > 0) {\n        tag_under = $tag_under.closest('td')\n      }\n      else if ($tag_under.closest('th').length > 0) {\n        tag_under = $tag_under.closest('th')\n      }\n    }\n\n    // The tag should be a table cell (TD or TH).\n    if (tag_under && (tag_under.tagName == 'TD' || tag_under.tagName == 'TH')) {\n      $tag_under = $(tag_under)\n\n      // https://github.com/froala/wysiwyg-editor/issues/786.\n      if (editor.$el.find($tag_under).length === 0) return false\n\n      // Tag's left and right coordinate.\n      const tag_left = $tag_under.offset().left - 1\n      const tag_right = tag_left + $tag_under.outerWidth()\n\n      // Only if the mouse is close enough to the left or right edges.\n      if (Math.abs(e.pageX - tag_left) <= editor.opts.tableResizerOffset ||\n        Math.abs(tag_right - e.pageX) <= editor.opts.tableResizerOffset) {\n\n        // Create a table map.\n        const map = _tableMap($table)\n        const tag_origin = _cellOrigin(tag_under, map)\n\n        const tag_end = _cellEnds(tag_origin.row, tag_origin.col, map)\n\n        // The column numbers from the map that have to be resized.\n        let first\n        let second\n\n        // Table resizer position and height.\n        const resizer_top = $table.offset().top\n        const resizer_height = $table.outerHeight() - 1\n        let resizer_left\n\n        // The left and right limits between which the resizer can be moved.\n        let max_left\n        let max_right\n\n        if (editor.opts.direction != 'rtl') {\n\n          // Mouse is near the cells's left margin.\n          if (e.pageX - tag_left <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left position.\n            resizer_left = tag_left\n\n            // Resize cells.\n            if (tag_origin.col > 0) {\n\n              // Left limit.\n              max_left = tag_left - _columnWidth(tag_origin.col - 1, map) + editor.opts.tableResizingLimit\n\n              // Right limit.\n              max_right = tag_left + _columnWidth(tag_origin.col, map) - editor.opts.tableResizingLimit\n\n              // Columns to resize.\n              first = tag_origin.col - 1\n              second = tag_origin.col\n            }\n\n            // Resize table.\n            else {\n\n              // Columns to resize.\n              first = null\n              second = 0\n\n              // Resizer limits.\n              max_left = $table.offset().left - 1 - parseInt($table.css('margin-left'), 10)\n              max_right = $table.offset().left - 1 + $table.width() - map[0].length * editor.opts.tableResizingLimit\n            }\n          }\n\n          // Mouse is near the cell's right margin.\n          else if (tag_right - e.pageX <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left possition.\n            resizer_left = tag_right\n\n            // Check for next td.\n            if (tag_end.col < map[tag_end.row].length && map[tag_end.row][tag_end.col + 1]) {\n\n              // Left limit.\n              max_left = tag_right - _columnWidth(tag_end.col, map) + editor.opts.tableResizingLimit\n\n              // Right limit.\n              max_right = tag_right + _columnWidth(tag_end.col + 1, map) - editor.opts.tableResizingLimit\n\n              // Columns to resize.\n              first = tag_end.col\n              second = tag_end.col + 1\n            }\n\n            // Resize table.\n            else {\n\n              // Columns to resize.\n              first = tag_end.col\n              second = null\n\n              // Resizer limits.\n              max_left = $table.offset().left - 1 + map[0].length * editor.opts.tableResizingLimit\n              max_right = $table_parent.offset().left - 1 + $table_parent.width() + parseFloat($table_parent.css('padding-left'))\n            }\n          }\n        }\n\n        // RTL\n        else {\n\n          // Mouse is near the cell's right margin.\n          if (tag_right - e.pageX <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left position.\n            resizer_left = tag_right\n\n            // Resize cells.\n            if (tag_origin.col > 0) {\n\n              // Left limit.\n              max_left = tag_right - _columnWidth(tag_origin.col, map) + editor.opts.tableResizingLimit\n\n              // Right limit.\n              max_right = tag_right + _columnWidth(tag_origin.col - 1, map) - editor.opts.tableResizingLimit\n\n              // Columns to resize.\n              first = tag_origin.col\n              second = tag_origin.col - 1\n            }\n\n            // Resize table.\n            else {\n              first = null\n              second = 0\n\n              // Resizer limits.\n              max_left = $table.offset().left + map[0].length * editor.opts.tableResizingLimit\n              max_right = $table_parent.offset().left - 1 + $table_parent.width() + parseFloat($table_parent.css('padding-left'))\n            }\n          }\n\n          // Mouse is near the cell's left margin.\n          else if (e.pageX - tag_left <= editor.opts.tableResizerOffset) {\n\n            // Table resizer's left position.\n            resizer_left = tag_left\n\n            // Check for next td.\n            if (tag_end.col < map[tag_end.row].length && map[tag_end.row][tag_end.col + 1]) {\n\n              // Left limit.\n              max_left = tag_left - _columnWidth(tag_end.col + 1, map) + editor.opts.tableResizingLimit\n\n              // Right limit.\n              max_right = tag_left + _columnWidth(tag_end.col, map) - editor.opts.tableResizingLimit\n\n              // Columns to resize.\n              first = tag_end.col + 1\n              second = tag_end.col\n            }\n\n            // Resize table.\n            else {\n\n              // Columns to resize.\n              first = tag_end.col\n              second = null\n\n              // Resizer limits.\n              max_left = $table_parent.offset().left + parseFloat($table_parent.css('padding-left'))\n              max_right = $table.offset().left - 1 + $table.width() - map[0].length * editor.opts.tableResizingLimit\n            }\n          }\n        }\n\n        if (!$resizer) _initResizer()\n\n        // Save table.\n        $resizer.data('table', $table)\n\n        // Save columns to resize.\n        $resizer.data('first', first)\n        $resizer.data('second', second)\n\n        $resizer.data('instance', editor)\n        editor.$wp.append($resizer)\n\n        let left = resizer_left - editor.win.pageXOffset - editor.opts.tableResizerOffset - editor.$wp.offset().left\n        let top = resizer_top - editor.$wp.offset().top + editor.$wp.scrollTop()\n\n        if (editor.opts.iframe) {\n          const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\n          const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\n          left += editor.$iframe.offset().left + iframePaddingLeft\n          top += editor.$iframe.offset().top + iframePaddingTop\n\n          max_left += editor.$iframe.offset().left\n          max_right += editor.$iframe.offset().left\n        }\n\n        // Set resizing limits.\n        $resizer.data('max-left', max_left)\n        $resizer.data('max-right', max_right)\n\n        // Initial position of the resizer\n        $resizer.data('origin', resizer_left - editor.win.pageXOffset)\n\n        // Set table resizer's top, left and height.\n        $resizer.css('top', top)\n        $resizer.css('left', left)\n        $resizer.css('height', resizer_height)\n        $resizer.find('div').css('height', resizer_height)\n\n        // Set padding according to tableResizerOffset.\n        $resizer.css('padding-left', editor.opts.tableResizerOffset)\n        $resizer.css('padding-right', editor.opts.tableResizerOffset)\n\n        // Show table resizer.\n        $resizer.show()\n      }\n\n      // Hide resizer when the mouse moves away from the cell's border.\n      else {\n        if (editor.core.sameInstance($resizer)) _hideResizer()\n      }\n    }\n\n    // Hide resizer if mouse is no longer over it.\n    else if ($resizer && $tag_under.get(0) != $resizer.get(0) && $tag_under.parent().get(0) != $resizer.get(0)) {\n      if (editor.core.sameInstance($resizer)) _hideResizer()\n    }\n  }\n\n  /*\n   * Show the insert column helper button.\n   */\n  function _showInsertColHelper(e, table) {\n    if (editor.$box.find('.fr-line-breaker').isVisible()) return false\n\n    // Insert Helper.\n    if (!$insert_helper) _initInsertHelper()\n\n    editor.$box.append($insert_helper)\n    $insert_helper.data('instance', editor)\n    const $table = $(table)\n    const $row = $table.find('tr').first()\n    const mouseX = e.pageX\n    let left = 0\n    let top = 0\n    \n    if (editor.opts.iframe) {\n      const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\n      const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\n      left += editor.$iframe.offset().left - editor.helpers.scrollLeft() + iframePaddingLeft\n      top += editor.$iframe.offset().top - editor.helpers.scrollTop() + iframePaddingTop\n    }\n\n    // Check where the column should be inserted.\n    let btn_width\n\n    $row.find('th, td').each(function () {\n      const $td = $(this)\n\n      // Insert before this td.\n      if ($td.offset().left <= mouseX && mouseX < $td.offset().left + $td.outerWidth() / 2) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\n        $insert_helper.css('top', top + $td.offset().top - editor.$box.offset().top - btn_width - 5)\n        $insert_helper.css('left', left + $td.offset().left - editor.$box.offset().left - btn_width / 2)\n        $insert_helper.data('selected-cell', $td)\n        $insert_helper.data('position', 'before')\n        $insert_helper.addClass('fr-visible')\n\n        return false\n\n        // Insert after this td.\n      }\n      else if ($td.offset().left + $td.outerWidth() / 2 <= mouseX && mouseX < $td.offset().left + $td.outerWidth()) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\n\n        $insert_helper.css('top', top + $td.offset().top - editor.$box.offset().top - btn_width - 5)\n        $insert_helper.css('left', left + $td.offset().left - editor.$box.offset().left + $td.outerWidth() - btn_width / 2)\n        $insert_helper.data('selected-cell', $td)\n        $insert_helper.data('position', 'after')\n        $insert_helper.addClass('fr-visible')\n\n        return false\n      }\n    })\n  }\n\n  /*\n   * Show the insert row helper button.\n   */\n  function _showInsertRowHelper(e, table) {\n    if (editor.$box.find('.fr-line-breaker').isVisible()) return false\n\n    if (!$insert_helper) _initInsertHelper()\n\n    editor.$box.append($insert_helper)\n    $insert_helper.data('instance', editor)\n    const $table = $(table)\n    const mouseY = e.pageY\n    let left = 0\n    let top = 0\n\n    if (editor.opts.iframe) {\n      const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\n      const iframePaddingLeft = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-left'))\n      left += editor.$iframe.offset().left - editor.helpers.scrollLeft() + iframePaddingLeft\n      top += editor.$iframe.offset().top - editor.helpers.scrollTop() + iframePaddingTop\n    }\n\n    // Check where the row should be inserted.\n    let btn_width\n\n    $table.find('tr').each(function () {\n      const $tr = $(this)\n\n      // Insert above this tr.\n      if ($tr.offset().top <= mouseY && mouseY < $tr.offset().top + $tr.outerHeight() / 2) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\n\n        $insert_helper.css('top', top + $tr.offset().top - editor.$box.offset().top - btn_width / 2)\n        $insert_helper.css('left', left + $tr.offset().left - editor.$box.offset().left - btn_width - 5)\n        $insert_helper.data('selected-cell', $tr.find('td').first())\n        $insert_helper.data('position', 'above')\n        $insert_helper.addClass('fr-visible')\n\n        return false\n\n        // Insert below this tr.\n      }\n      else if ($tr.offset().top + $tr.outerHeight() / 2 <= mouseY && mouseY < $tr.offset().top + $tr.outerHeight()) {\n        btn_width = parseInt($insert_helper.find('a').css('width'), 10)\n\n        $insert_helper.css('top', top + $tr.offset().top - editor.$box.offset().top + $tr.outerHeight() - btn_width / 2)\n        $insert_helper.css('left', left + $tr.offset().left - editor.$box.offset().left - btn_width - 5)\n        $insert_helper.data('selected-cell', $tr.find('td').first())\n        $insert_helper.data('position', 'below')\n        $insert_helper.addClass('fr-visible')\n\n        return false\n      }\n    })\n  }\n\n  /*\n   * Check if should show the insert column / row helper button.\n   */\n  function _insertHelper(e, tag_under) {\n\n    // Don't show the insert helper if there are table cells selected.\n    if (selectedCells().length === 0) {\n      let i\n      let tag_below\n      let tag_right\n\n      // Tag is the editor element or body (inline toolbar). Look for closest tag bellow and at the right.\n      if (tag_under && (tag_under.tagName == 'HTML' || tag_under.tagName == 'BODY' || editor.node.isElement(tag_under))) {\n\n        // Look 1px down until a table tag is found or the insert helper offset is reached.\n        for (i = 1; i <= editor.opts.tableInsertHelperOffset; i++) {\n\n          // Look for tag below.\n          tag_below = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset + i)\n\n          // We're on tooltip.\n          if ($(tag_below).hasClass('fr-tooltip')) return true\n\n          // We found a tag bellow.\n          if (tag_below && ((tag_below.tagName == 'TH' || tag_below.tagName == 'TD' || tag_below.tagName == 'TABLE') && ($(tag_below).parents('.fr-wrapper').length || editor.opts.iframe))) {\n\n            // Show the insert column helper button.\n            _showInsertColHelper(e, $(tag_below).closest('table'))\n\n            return true\n          }\n\n          // Look for tag at the right.\n          tag_right = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset + i, e.pageY - editor.win.pageYOffset)\n\n          // We're on tooltip.\n          if ($(tag_right).hasClass('fr-tooltip')) return true\n\n          // We found a tag at the right.\n          if (tag_right && ((tag_right.tagName == 'TH' || tag_right.tagName == 'TD' || tag_right.tagName == 'TABLE') && ($(tag_right).parents('.fr-wrapper').length || editor.opts.iframe))) {\n\n            // Show the insert row helper button.\n            _showInsertRowHelper(e, $(tag_right).closest('table'))\n\n            return true\n          }\n        }\n      }\n\n      // Hide insert helper.\n      if (editor.core.sameInstance($insert_helper)) {\n        _hideInsertHelper()\n      }\n    }\n  }\n\n  /*\n   * Check tag under the mouse on mouse move.\n   */\n  function _tagUnder(e) {\n    mouseMoveTimer = null\n\n    // The tag under the mouse cursor.\n    const tag_under = editor.doc.elementFromPoint(e.pageX - editor.win.pageXOffset, e.pageY - editor.win.pageYOffset)\n\n    // Place table resizer if necessary.\n    if (editor.opts.tableResizer && (!editor.popups.areVisible() || (editor.popups.areVisible() && editor.popups.isVisible('table.edit')))) {\n      _placeResizer(e, tag_under)\n    }\n\n    // Show the insert column / row helper button.\n    if (editor.opts.tableInsertHelper && !editor.popups.areVisible() && !(editor.$tb.hasClass('fr-inline') && editor.$tb.isVisible())) {\n      _insertHelper(e, tag_under)\n    }\n  }\n\n  /*\n   * Repositon the resizer if the user scrolls while resizing.\n   */\n  function _repositionResizer() {\n    if (resizingFlag) {\n      const $table = $resizer.data('table')\n      let top = $table.offset().top - editor.win.pageYOffset\n\n      if (editor.opts.iframe) {\n        const iframePaddingTop = editor.helpers.getPX(editor.$wp.find('.fr-iframe').css('padding-top'))\n        top += editor.$iframe.offset().top - editor.helpers.scrollTop() + iframePaddingTop\n      }\n\n      $resizer.css('top', top)\n    }\n  }\n\n  /*\n   * Resize table method.\n   */\n  function _resize() {\n\n    // Resizer initial position.\n    const initial_positon = $resizer.data('origin')\n\n    // Resizer release position.\n    const release_position = $resizer.data('release-position')\n\n    // Do resize only if the resizer's position has changed.\n    if (initial_positon !== release_position) {\n\n      // Columns that have to be resized.\n      const first = $resizer.data('first')\n      const second = $resizer.data('second')\n\n      const $table = $resizer.data('table')\n      const table_width = $table.outerWidth()\n\n      if (!editor.undo.canDo()) editor.undo.saveStep()\n\n      // Resize columns and not the table.\n      if (first != null && second != null) {\n\n        // Create a table map.\n        const map = _tableMap($table)\n\n        // Got through all cells on these columns and get their initial width.\n        const first_widths = []\n        const first_percentages = []\n        const second_widths = []\n        const second_percentages = []\n        let i\n        let $first_cell\n        let $second_cell\n\n        // We must do this before updating widths.\n        for (i = 0; i < map.length; i++) {\n          $first_cell = $(map[i][first])\n          $second_cell = $(map[i][second])\n\n          // Widths in px.\n          first_widths[i] = $first_cell.outerWidth()\n          second_widths[i] = $second_cell.outerWidth()\n\n          // Widths in percentages.\n          first_percentages[i] = first_widths[i] / table_width * 100\n          second_percentages[i] = second_widths[i] / table_width * 100\n        }\n\n        // Got through all cells on these columns and update their widths.\n        for (i = 0; i < map.length; i++) {\n          $first_cell = $(map[i][first])\n          $second_cell = $(map[i][second])\n\n          // There is a colspan.\n          if (map[i][first] != map[i][second]) {\n            // New percentage for the first cell.\n            const first_cell_percentage = (first_percentages[i] * (first_widths[i] + release_position - initial_positon) / first_widths[i]).toFixed(4)\n\n            $first_cell.css('width', first_cell_percentage + '%')\n            $second_cell.css('width', (first_percentages[i] + second_percentages[i] - first_cell_percentage).toFixed(4) + '%')\n          }\n        }\n      }\n\n      // Resize the table.\n      else {\n        const $table_parent = $table.parent()\n        const table_percentage = table_width / $table_parent.width() * 100\n        const left_margin = (parseInt($table.css('margin-left'), 10) || 0) / $table_parent.width() * 100\n        const right_margin = (parseInt($table.css('margin-right'), 10) || 0) / $table_parent.width() * 100\n        let width\n\n        // Right border RTL or LTR.\n        if ((editor.opts.direction == 'rtl' && second === 0) || (editor.opts.direction != 'rtl' && second !== 0)) {\n          width = (table_width + release_position - initial_positon) / table_width * table_percentage\n          $table.css('margin-right', 'calc(100% - ' + Math.round(width).toFixed(4) + '% - ' + Math.round(left_margin).toFixed(4) + '%)')\n        }\n\n        // Left border RTL or LTR.\n        else if ((editor.opts.direction == 'rtl' && second !== 0) || (editor.opts.direction != 'rtl' && second === 0)) {\n          width = (table_width - release_position + initial_positon) / table_width * table_percentage\n          $table.css('margin-left', 'calc(100% - ' + Math.round(width).toFixed(4) + '% - ' + Math.round(right_margin).toFixed(4) + '%)')\n        }\n\n        // Update table width.\n        $table.css('width', Math.round(width).toFixed(4) + '%')\n      }\n\n      editor.selection.restore()\n      editor.undo.saveStep()\n\n      editor.events.trigger('table.resized', [$table.get(0)])\n    }\n\n    // Clear resizer data.\n    $resizer.removeData('origin')\n    $resizer.removeData('release-position')\n    $resizer.removeData('first')\n    $resizer.removeData('second')\n    $resizer.removeData('table')\n  }\n\n  /*\n   * Get the width of the column. (columns may have colspan)\n   */\n  function _columnWidth(col, map) {\n    let i\n    let width = $(map[0][col]).outerWidth()\n\n    for (i = 1; i < map.length; i++) {\n      width = Math.min(width, $(map[i][col]).outerWidth())\n    }\n\n    return width\n  }\n\n  /*\n   * Get the width of the columns between specified indexes.\n   */\n  function _columnsWidth(col1, col2, map) {\n    let i\n    let width = 0\n\n    // Sum all columns widths.\n    for (i = col1; i <= col2; i++) {\n      width += _columnWidth(i, map)\n    }\n\n    return width\n  }\n\n  /*\n   * Set mouse timer to improve performance.\n   */\n  function _mouseMove(e) {\n\n    // Prevent selecting text when we have cells selected.\n    if (selectedCells().length > 1 && mouseDownFlag) {\n      _clearSelection()\n    }\n\n    // Reset or set timer.\n    if (mouseDownFlag === false && mouseDownCellFlag === false && resizingFlag === false) {\n      if (mouseMoveTimer) {\n        clearTimeout(mouseMoveTimer)\n      }\n\n      // Only resize table if the editor is not disabled by user.\n      if (!editor.edit.isDisabled() || editor.popups.isVisible('table.edit')) {\n\n        // Check tag under in order to place the table resizer or insert helper button.\n        mouseMoveTimer = setTimeout(_tagUnder, 30, e)\n      }\n\n      // Move table resizer.\n    }\n    else if (resizingFlag) {\n\n      // Cursor position.\n      let pos = e.pageX - editor.win.pageXOffset\n\n      if (editor.opts.iframe) {\n        pos += editor.$iframe.offset().left\n      }\n\n      // Left and right limits.\n      const left_limit = $resizer.data('max-left')\n      const right_limit = $resizer.data('max-right')\n\n      // Cursor is between the left and right limits.\n      if (pos >= left_limit && pos <= right_limit) {\n        $resizer.css('left', pos - editor.opts.tableResizerOffset - editor.$wp.offset().left)\n\n        // Cursor has exceeded the left limit. Don't update if it already has the correct value.\n      }\n      else if (pos < left_limit && parseFloat($resizer.css('left'), 10) > left_limit - editor.opts.tableResizerOffset) {\n        $resizer.css('left', left_limit - editor.opts.tableResizerOffset - editor.$wp.offset().left)\n\n        // Cursor has exceeded the right limit. Don't update if it already has the correct value.\n      }\n      else if (pos > right_limit && parseFloat($resizer.css('left'), 10) < right_limit - editor.opts.tableResizerOffset) {\n        $resizer.css('left', right_limit - editor.opts.tableResizerOffset - editor.$wp.offset().left)\n      }\n    }\n    else if (mouseDownFlag) {\n      _hideInsertHelper()\n    }\n  }\n\n  /*\n   * Place selection markers in a table cell.\n   */\n  function _addMarkersInCell($cell) {\n    if (editor.node.isEmpty($cell.get(0))) {\n      $cell.prepend(FE.MARKERS)\n    }\n    else {\n      $cell.prepend(FE.START_MARKER).append(FE.END_MARKER)\n    }\n  }\n\n  /*\n   * Use TAB key to navigate through cells.\n   */\n  function _useTab(e) {\n    const key_code = e.which\n\n    if (key_code == FE.KEYCODE.TAB) {\n\n      // Get starting cell.\n      let $cell\n\n      if (selectedCells().length > 0) {\n        $cell = editor.$el.find('.fr-selected-cell').last()\n      }\n      else {\n        const cell = editor.selection.element()\n\n        if (cell.tagName == 'TD' || cell.tagName == 'TH') {\n          $cell = $(cell)\n        }\n        else if (cell != editor.el) {\n          if ($(cell).parentsUntil(editor.$el, 'td').length > 0) {\n            $cell = $(cell).parents('td').first()\n          }\n          else if ($(cell).parentsUntil(editor.$el, 'th').length > 0) {\n            $cell = $(cell).parents('th').first()\n          }\n        }\n      }\n\n      if ($cell) {\n        e.preventDefault()\n\n        if ($(editor.selection.element()).parentsUntil(editor.$el, 'ol, ul').length > 0 && ($(editor.selection.element()).parents('li').prev().length > 0 || ($(editor.selection.element()).is('li') && $(editor.selection.element()).prev().length > 0))) {\n\n          return true\n        }\n\n        _stopEdit()\n\n        // Go backwards.\n        if (e.shiftKey) {\n\n          // Go to previous cell.\n          if ($cell.prev().length > 0) {\n            _addMarkersInCell($cell.prev())\n          }\n\n          // Go to prev row, last cell.\n          else if ($cell.closest('tr').length > 0 && $cell.closest('tr').prev().length > 0) {\n            _addMarkersInCell($cell.closest('tr').prev().find('td').last())\n          }\n\n          // Go in THEAD, last cell.\n          else if ($cell.closest('tbody').length > 0 && $cell.closest('table').find('thead tr').length > 0) {\n            _addMarkersInCell($cell.closest('table').find('thead tr th').last())\n          }\n        }\n\n        // Go forward.\n        else {\n\n          // Go to next cell.\n          if ($cell.next().length > 0) {\n            _addMarkersInCell($cell.next())\n          }\n\n          // Go to next row, first cell.\n          else if ($cell.closest('tr').length > 0 && $cell.closest('tr').next().length > 0) {\n            _addMarkersInCell($cell.closest('tr').next().find('td').first())\n          }\n\n          // Cursor is in THEAD. Go to next row in TBODY\n          else if ($cell.closest('thead').length > 0 && $cell.closest('table').find('tbody tr').length > 0) {\n            _addMarkersInCell($cell.closest('table').find('tbody tr td').first())\n          }\n\n          // Add new row.\n          else {\n            $cell.addClass('fr-selected-cell')\n            insertRow('below')\n            _removeSelection()\n            _addMarkersInCell($cell.closest('tr').next().find('td').first())\n          }\n        }\n\n        // Update cursor position.\n        editor.selection.restore()\n\n        // Prevent event propagation.\n        return false\n      }\n    }\n  }\n\n  /*\n   * Initilize insert helper.\n   */\n  function _initInsertHelper() {\n\n    // Append insert helper HTML to editor wrapper.\n    if (!editor.shared.$ti_helper) {\n      editor.shared.$ti_helper = $(document.createElement('div')).attr('class', 'fr-insert-helper').html('<a class=\"fr-floating-btn\" role=\"button\" tabIndex=\"-1\" title=\"' + editor.language.translate('Insert') + '\"><svg viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z\"/></svg></a>')\n\n      // Click on insert helper.\n      editor.events.bindClick(editor.shared.$ti_helper, 'a', function () {\n        const $td = $insert_helper.data('selected-cell')\n        const position = $insert_helper.data('position')\n        const inst = $insert_helper.data('instance') || editor\n\n        if (position == 'before') {\n          editor.undo.saveStep()\n\n          $td.addClass('fr-selected-cell')\n          inst.table.insertColumn(position)\n          $td.removeClass('fr-selected-cell')\n\n          editor.undo.saveStep()\n        }\n        else if (position == 'after') {\n          editor.undo.saveStep()\n\n          $td.addClass('fr-selected-cell')\n          inst.table.insertColumn(position)\n          $td.removeClass('fr-selected-cell')\n\n          editor.undo.saveStep()\n        }\n        else if (position == 'above') {\n          editor.undo.saveStep()\n\n          $td.addClass('fr-selected-cell')\n          inst.table.insertRow(position)\n          $td.removeClass('fr-selected-cell')\n\n          editor.undo.saveStep()\n        }\n        else if (position == 'below') {\n          editor.undo.saveStep()\n\n          $td.addClass('fr-selected-cell')\n          inst.table.insertRow(position)\n          $td.removeClass('fr-selected-cell')\n\n          editor.undo.saveStep()\n        }\n\n        // Hide the insert helper so it will reposition.\n        _hideInsertHelper()\n      })\n\n      // Editor destroy.\n      editor.events.on('shared.destroy', function () {\n        editor.shared.$ti_helper.html('').removeData().remove()\n        editor.shared.$ti_helper = null\n      }, true)\n\n      // Prevent the insert helper hide when mouse is over it.\n      editor.events.$on(editor.shared.$ti_helper, 'mousemove', function (e) {\n        e.stopPropagation()\n      }, true)\n\n      // Hide the insert helper if the page is scrolled.\n      editor.events.$on($(editor.o_win), 'scroll', function () {\n        _hideInsertHelper()\n      }, true)\n\n      editor.events.$on(editor.$wp, 'scroll', function () {\n        _hideInsertHelper()\n      }, true)\n    }\n\n    $insert_helper = editor.shared.$ti_helper\n\n    editor.events.on('destroy', function () {\n      $insert_helper = null\n    })\n\n    // Table insert helper tooltip.\n    editor.tooltip.bind(editor.$box, '.fr-insert-helper > a.fr-floating-btn')\n  }\n\n  /**\n   * Destroy\n   */\n  function _destroy() {\n    mouseDownCell = null\n    clearTimeout(mouseMoveTimer)\n  }\n\n  /*\n   * Go back to the table edit popup.\n   */\n  function back() {\n    if (selectedCells().length > 0) {\n      _showEditPopup()\n    }\n    else {\n      editor.popups.hide('table.insert')\n      editor.toolbar.showInline()\n    }\n  }\n\n  /**\n   * Return selected cells.\n   */\n  function selectedCells() {\n    return editor.el.querySelectorAll('.fr-selected-cell')\n  }\n\n  /**\n   * Return selected table.\n   */\n  function selectedTable() {\n    const cells = selectedCells()\n\n    if (cells.length) {\n      let cell = cells[0]\n\n      while (cell && cell.tagName != 'TABLE' && cell.parentNode != editor.el) {\n        cell = cell.parentNode\n      }\n\n      if (cell && cell.tagName == 'TABLE') return $(cell)\n\n      return $([])\n    }\n\n    return $([])\n  }\n\n  /**\n   * Select table cell with alt + space.\n   */\n  function _selectCellWithKeyboard(e) {\n\n    // Alt+space was hit. Try to select cell.\n    if (e.altKey && e.which == FE.KEYCODE.SPACE) {\n      let cell\n      const el = editor.selection.element()\n\n      // Get cell where cursor is.\n      if (el.tagName == 'TD' || el.tagName == 'TH') {\n        cell = el\n      }\n      else if ($(el).closest('td').length > 0) {\n        cell = $(el).closest('td').get(0)\n      }\n      else if ($(el).closest('th').length > 0) {\n        cell = $(el).closest('th').get(0)\n      }\n\n      // Select this cell.\n      if (cell) {\n        e.preventDefault()\n        selectCells(cell, cell)\n        _showEditPopup()\n\n        return false\n      }\n    }\n  }\n\n  /**\n   * Select table cells using arrows.\n   */\n  function selectCellsWithKeyboard(e) {\n    const selection = selectedCells()\n\n    // Return if no selected cell\n    if(selection == null) {\n      return\n    }\n\n    // There are some selected cells.\n    if (selection.length > 0) {\n      const map = _tableMap()\n      const key_code = e.which\n      let fixedCell\n      let handlerCell\n\n      // Only one cell is selected.\n      if (selection.length == 1) {\n        fixedCell = selection[0]\n        handlerCell = fixedCell\n      }\n\n      else {\n        fixedCell = editor.el.querySelector('.fr-cell-fixed')\n        handlerCell = editor.el.querySelector('.fr-cell-handler')\n      }\n\n      const handlerOrigin = _cellOrigin(handlerCell, map)\n\n      // Select column at the right.\n      if (FE.KEYCODE.ARROW_RIGHT == key_code) {\n        if (handlerOrigin.col < map[0].length - 1) {\n          selectCells(fixedCell, map[handlerOrigin.row][handlerOrigin.col + 1])\n\n          return false\n        }\n      }\n\n      // Select row below.\n      else if (FE.KEYCODE.ARROW_DOWN == key_code) {\n        if (handlerOrigin.row < map.length - 1) {\n          selectCells(fixedCell, map[handlerOrigin.row + 1][handlerOrigin.col])\n\n          return false\n        }\n      }\n\n      // Select column at the left.\n      else if (FE.KEYCODE.ARROW_LEFT == key_code) {\n        if (handlerOrigin.col > 0) {\n          selectCells(fixedCell, map[handlerOrigin.row][handlerOrigin.col - 1])\n\n          return false\n        }\n      }\n\n      // Select row above.\n      else if (FE.KEYCODE.ARROW_UP == key_code) {\n        if (handlerOrigin.row > 0) {\n          selectCells(fixedCell, map[handlerOrigin.row - 1][handlerOrigin.col])\n\n          return false\n        }\n      }\n    }\n  }\n\n  /*\n   * Init table.\n   */\n  function _init() {\n    if (!editor.$wp) return false\n\n    // Do cell selection only on desktops (no touch devices)\n    if (!editor.helpers.isMobile()) {\n\n      // Remember if mouse is clicked.\n      mouseDownFlag = false\n      mouseDownCellFlag = false\n      resizingFlag = false\n\n      // Mouse is down in a table cell.\n      editor.events.$on(editor.$el, 'mousedown', _mouseDown)\n\n      // Deselect table cells when user clicks on an image.\n      editor.popups.onShow('image.edit', function () {\n        _removeSelection()\n        mouseDownFlag = false\n        mouseDownCellFlag = false\n      })\n\n      // Deselect table cells when user clicks on a link.\n      editor.popups.onShow('link.edit', function () {\n        _removeSelection()\n        mouseDownFlag = false\n        mouseDownCellFlag = false\n      })\n\n      // Deselect table cells when a command is run.\n      editor.events.on('commands.mousedown', function ($btn) {\n        if ($btn.parents('.fr-toolbar').length > 0) {\n          _removeSelection()\n        }\n      })\n\n      // Mouse enter's a table cell.\n      editor.events.$on(editor.$el, 'mouseover', 'th, td', _mouseEnter)\n\n      // Mouse is no longer pressed.\n      editor.events.$on(editor.$win, 'mouseup', _mouseUp)\n\n      // Iframe mouseup.\n      if (editor.opts.iframe) {\n        editor.events.$on($(editor.o_win), 'mouseup', _mouseUp)\n      }\n\n      // Check tags under the mouse to see if the resizer needs to be shown.\n      editor.events.$on(editor.$win, 'mousemove', _mouseMove)\n\n      // Update resizer's position on scroll.\n      editor.events.$on($(editor.o_win), 'scroll', _repositionResizer)\n\n      // Reposition table edit popup when table cell content changes.\n      editor.events.on('contentChanged', function () {\n        if (selectedCells().length > 0) {\n          _showEditPopup()\n\n          // Make sure we reposition on image load.\n          editor.$el.find('img').on('load.selected-cells', function () {\n            $(this).off('load.selected-cells')\n\n            if (selectedCells().length > 0) {\n              _showEditPopup()\n            }\n          })\n        }\n      })\n\n      // Reposition table edit popup on window resize.\n      editor.events.$on($(editor.o_win), 'resize', function () {\n        _removeSelection()\n      })\n\n      editor.events.on('toolbar.esc', function () {\n        if (selectedCells().length > 0) {\n          editor.events.disableBlur()\n          editor.events.focus()\n\n          return false\n        }\n      }, true)\n\n      // Allow keyboard while selecting table cells.\n      // https://github.com/froala/wysiwyg-editor/issues/2256\n      editor.events.$on($(editor.o_win), 'keydown', function () {\n        if (mouseDownFlag && mouseDownCellFlag) {\n          mouseDownFlag = false\n          mouseDownCellFlag = false\n\n          // Allow text selection.\n          editor.$el.removeClass('fr-no-selection')\n          editor.edit.on()\n\n          editor.selection.setAtEnd(editor.$el.find('.fr-selected-cell').last().get(0))\n          editor.selection.restore()\n\n          // Remove selected cells.\n          _removeSelection()\n        }\n      })\n\n      // Selecting cells with keyboard or moving cursor with arrow keys.\n      editor.events.$on(editor.$el, 'keydown', function (e) {\n        if (e.shiftKey) {\n          if (selectCellsWithKeyboard(e) === false) {\n\n            // Timeout needed due to clearSelection timeout.\n            setTimeout(function () {\n              _showEditPopup()\n            }, 0)\n          }\n        }\n        else {\n          _navigateWithArrows(e)\n        }\n      })\n\n      // Prevent backspace from doing browser back.\n      editor.events.on('keydown', function (e) {\n\n        // Tab in cell.\n        if (_useTab(e) === false) return false\n\n        let selected_cells = selectedCells()\n\n        if (selected_cells.length > 0) {\n\n          // CMD + A clear table cell selection and allow propagation.\n          if (selected_cells.length > 0 && editor.keys.ctrlKey(e) && e.which == FE.KEYCODE.A) {\n            _removeSelection()\n\n            if (editor.popups.isVisible('table.edit')) {\n              editor.popups.hide('table.edit')\n            }\n            selected_cells = []\n\n            return true\n          }\n\n          // ESC clear table cell selection.\n          if (e.which == FE.KEYCODE.ESC) {\n            if (editor.popups.isVisible('table.edit')) {\n              _removeSelection()\n              editor.popups.hide('table.edit')\n              e.preventDefault()\n              e.stopPropagation()\n              e.stopImmediatePropagation()\n              selected_cells = []\n\n              return false\n            }\n          }\n\n          // Backspace clears selected cells content.\n          if (selected_cells.length > 1 && (e.which == FE.KEYCODE.BACKSPACE || e.which == FE.KEYCODE.DELETE)) {\n            editor.undo.saveStep()\n\n            for (let i = 0; i < selected_cells.length; i++) {\n              $(selected_cells[i]).html('<br>')\n\n              if (i == selected_cells.length - 1) {\n                $(selected_cells[i]).prepend(FE.MARKERS)\n              }\n            }\n\n            editor.selection.restore()\n            editor.undo.saveStep()\n            selected_cells = []\n\n            return false\n          }\n\n          // Prevent typing if cells are selected. (Allow browser refresh using keyboard)\n          if (selected_cells.length > 1 && e.which != FE.KEYCODE.F10 && !editor.keys.isBrowserAction(e)) {\n            e.preventDefault()\n            selected_cells = []\n\n            return false\n          }\n        }\n\n        // We may want to select a cell with keyboard.\n        else {\n\n          // Garbage collector.\n          selected_cells = []\n\n          if (_selectCellWithKeyboard(e) === false) return false\n        }\n      }, true)\n\n      // Clean selected cells.\n      let c_selected_cells = []\n      editor.events.on('html.beforeGet', function () {\n        c_selected_cells = selectedCells()\n\n        for (let i = 0; i < c_selected_cells.length; i++) {\n          c_selected_cells[i].className = (c_selected_cells[i].className || '').replace(/fr-selected-cell/g, '')\n        }\n      })\n\n      editor.events.on('html.afterGet', function () {\n        for (let i = 0; i < c_selected_cells.length; i++) {\n          c_selected_cells[i].className = (c_selected_cells[i].className ? c_selected_cells[i].className.trim() + ' ' : '') + 'fr-selected-cell'\n        }\n        c_selected_cells = []\n      })\n\n      _initInsertPopup(true)\n      _initEditPopup(true)\n    }\n\n    editor.events.on('destroy', _destroy)\n  }\n\n  return {\n    _init: _init,\n    insert: insert,\n    remove: remove,\n    insertRow: insertRow,\n    deleteRow: deleteRow,\n    insertColumn: insertColumn,\n    deleteColumn: deleteColumn,\n    mergeCells: mergeCells,\n    splitCellVertically: splitCellVertically,\n    splitCellHorizontally: splitCellHorizontally,\n    addHeader: addHeader,\n    removeHeader: removeHeader,\n    setBackground: setBackground,\n    showInsertPopup: _showInsertPopup,\n    showEditPopup: _showEditPopup,\n    showColorsPopup: _showColorsPopup,\n    back: back,\n    verticalAlign: verticalAlign,\n    horizontalAlign: horizontalAlign,\n    applyStyle: applyStyle,\n    selectedTable: selectedTable,\n    selectedCells: selectedCells,\n    customColor: customColor,\n    selectCells: selectCells\n  }\n}\n\n// Insert table button.\nFE.DefineIcon('insertTable', { NAME: 'table', SVG_KEY: 'insertTable' })\nFE.RegisterCommand('insertTable', {\n  title: 'Insert Table',\n  undo: false,\n  focus: true,\n  refreshOnCallback: false,\n  popup: true,\n  callback: function () {\n    if (!this.popups.isVisible('table.insert')) {\n      this.table.showInsertPopup()\n    }\n    else {\n      if (this.$el.find('.fr-marker').length) {\n        this.events.disableBlur()\n        this.selection.restore()\n      }\n      this.popups.hide('table.insert')\n    }\n  },\n  plugin: 'table'\n})\n\nFE.RegisterCommand('tableInsert', {\n  callback: function (cmd, rows, cols) {\n    this.table.insert(rows, cols)\n    this.popups.hide('table.insert')\n  }\n})\n\n// Table header button.\nFE.DefineIcon('tableHeader', {\n  NAME: 'header',\n  FA5NAME: 'heading',\n  SVG_KEY: 'tableHeader'\n})\nFE.RegisterCommand('tableHeader', {\n  title: 'Table Header',\n  focus: false,\n  toggle: true,\n  callback: function () {\n    const $btn = this.popups.get('table.edit').find('.fr-command[data-cmd=\"tableHeader\"]')\n\n    // If button is active the table has a header,\n    if ($btn.hasClass('fr-active')) {\n      this.table.removeHeader()\n    }\n\n    // Add table header.\n    else {\n      this.table.addHeader()\n    }\n  },\n  refresh: function ($btn) {\n    const $table = this.table.selectedTable()\n\n    if ($table.length > 0) {\n\n      // If table doesn't have a header.\n      if ($table.find('th').length === 0) {\n        $btn.removeClass('fr-active').attr('aria-pressed', false)\n      }\n\n      // Header button is active if table has header.\n      else {\n        $btn.addClass('fr-active').attr('aria-pressed', true)\n      }\n    }\n  }\n})\n\n// Table rows action dropdown.\nFE.DefineIcon('tableRows', { NAME: 'bars', SVG_KEY: 'row' })\nFE.RegisterCommand('tableRows', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Row',\n  options: {\n    above: 'Insert row above',\n    below: 'Insert row below',\n    'delete': 'Delete row'\n  },\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = FE.COMMANDS.tableRows.options\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableRows\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    if (val == 'above' || val == 'below') {\n      this.table.insertRow(val)\n    }\n    else {\n      this.table.deleteRow()\n    }\n  }\n})\n\n// Table columns action dropdown.\nFE.DefineIcon('tableColumns', { NAME: 'bars fa-rotate-90', SVG_KEY: 'columns' })\nFE.RegisterCommand('tableColumns', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Column',\n  options: {\n    before: 'Insert column before',\n    after: 'Insert column after',\n    'delete': 'Delete column'\n  },\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = FE.COMMANDS.tableColumns.options\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableColumns\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    if (val == 'before' || val == 'after') {\n      this.table.insertColumn(val)\n    }\n    else {\n      this.table.deleteColumn()\n    }\n  }\n})\n\n// Table cells action dropdown.\nFE.DefineIcon('tableCells', {\n  NAME: 'square-o',\n  FA5NAME: 'square',\n  SVG_KEY: 'cellOptions'\n})\nFE.RegisterCommand('tableCells', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Cell',\n  options: {\n    merge: 'Merge cells',\n    'vertical-split': 'Vertical split',\n    'horizontal-split': 'Horizontal split'\n  },\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = FE.COMMANDS.tableCells.options\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCells\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    if (val == 'merge') {\n      this.table.mergeCells()\n    }\n    else if (val == 'vertical-split') {\n      this.table.splitCellVertically()\n    }\n\n    // 'horizontal-split'\n    else {\n      this.table.splitCellHorizontally()\n    }\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n\n    // More than one cell selected.\n    if (this.$el.find('.fr-selected-cell').length > 1) {\n      $dropdown.find('a[data-param1=\"vertical-split\"]').addClass('fr-disabled').attr('aria-disabled', true)\n      $dropdown.find('a[data-param1=\"horizontal-split\"]').addClass('fr-disabled').attr('aria-disabled', true)\n      $dropdown.find('a[data-param1=\"merge\"]').removeClass('fr-disabled').attr('aria-disabled', false)\n    }\n\n    // Only one selected cell.\n    else {\n      $dropdown.find('a[data-param1=\"merge\"]').addClass('fr-disabled').attr('aria-disabled', true)\n      $dropdown.find('a[data-param1=\"vertical-split\"]').removeClass('fr-disabled').attr('aria-disabled', false)\n      $dropdown.find('a[data-param1=\"horizontal-split\"]').removeClass('fr-disabled').attr('aria-disabled', false)\n    }\n  }\n})\n\n// Remove table button.\nFE.DefineIcon('tableRemove', { NAME: 'trash', SVG_KEY: 'removeTable' })\nFE.RegisterCommand('tableRemove', {\n  title: 'Remove Table',\n  focus: false,\n  callback: function () {\n    this.table.remove()\n  }\n})\n\n// Table styles.\nFE.DefineIcon('tableStyle', { NAME: 'paint-brush', SVG_KEY: 'tableStyle' })\nFE.RegisterCommand('tableStyle', {\n  title: 'Table Style',\n  type: 'dropdown',\n  focus: false,\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = this.opts.tableStyles\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableStyle\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    this.table.applyStyle(val, this.$el.find('.fr-selected-cell').closest('table'), this.opts.tableMultipleStyles, this.opts.tableStyles)\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    const $ = this.$\n    const $table = this.$el.find('.fr-selected-cell').closest('table')\n\n    if ($table) {\n      $dropdown.find('.fr-command').each(function () {\n        const cls = $(this).data('param1')\n        const active = $table.hasClass(cls)\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active)\n      })\n    }\n  }\n})\n\n// Table cell background color button.\nFE.DefineIcon('tableCellBackground', { NAME: 'tint', SVG_KEY: 'cellBackground' })\nFE.RegisterCommand('tableCellBackground', {\n  title: 'Cell Background',\n  focus: false,\n  popup: true,\n  callback: function () {\n    this.table.showColorsPopup()\n  }\n})\n\n// Select table cell background color command.\nFE.RegisterCommand('tableCellBackgroundColor', {\n  undo: true,\n  focus: false,\n  callback: function (cmd, val) {\n    this.table.setBackground(val)\n  }\n})\n\n// Table back.\nFE.DefineIcon('tableBack', { NAME: 'arrow-left', SVG_KEY: 'back' })\nFE.RegisterCommand('tableBack', {\n  title: 'Back',\n  undo: false,\n  focus: false,\n  back: true,\n  callback: function () {\n    this.table.back()\n  },\n  refresh: function ($btn) {\n    if (this.table.selectedCells().length === 0 && !this.opts.toolbarInline) {\n      $btn.addClass('fr-hidden')\n      $btn.next('.fr-separator').addClass('fr-hidden')\n    }\n    else {\n      $btn.removeClass('fr-hidden')\n      $btn.next('.fr-separator').removeClass('fr-hidden')\n    }\n  }\n})\n\n// Table vertical align dropdown.\nFE.DefineIcon('tableCellVerticalAlign', {\n  NAME: 'arrows-v',\n  FA5NAME: 'arrows-alt-v',\n  SVG_KEY: 'verticalAlignMiddle'\n})\nFE.RegisterCommand('tableCellVerticalAlign', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Vertical Align',\n  options: {\n    Top: 'Align Top',\n    Middle: 'Align Middle',\n    Bottom: 'Align Bottom'\n  },\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = FE.COMMANDS.tableCellVerticalAlign.options\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellVerticalAlign\" data-param1=\"' + val.toLowerCase() + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(val) + '</a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    this.table.verticalAlign(val)\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    $dropdown.find('.fr-command[data-param1=\"' + this.$el.find('.fr-selected-cell').css('vertical-align') + '\"]').addClass('fr-active').attr('aria-selected', true)\n  }\n})\n\n// Table horizontal align dropdown.\nFE.DefineIcon('tableCellHorizontalAlign', { NAME: 'align-left', SVG_KEY: 'alignLeft' })\nFE.DefineIcon('align-left', { NAME: 'align-left', SVG_KEY: 'alignLeft' })\nFE.DefineIcon('align-right', { NAME: 'align-right', SVG_KEY: 'alignRight' })\nFE.DefineIcon('align-center', { NAME: 'align-center', SVG_KEY: 'alignCenter' })\nFE.DefineIcon('align-justify', { NAME: 'align-justify', SVG_KEY: 'alignJustify' })\nFE.RegisterCommand('tableCellHorizontalAlign', {\n  type: 'dropdown',\n  focus: false,\n  title: 'Horizontal Align',\n  options: {\n    left: 'Align Left',\n    center: 'Align Center',\n    right: 'Align Right',\n    justify: 'Align Justify'\n  },\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = FE.COMMANDS.tableCellHorizontalAlign.options\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command fr-title\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellHorizontalAlign\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.icon.create('align-' + val) + '<span class=\"fr-sr-only\">' + this.language.translate(options[val]) + '</span></a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    this.table.horizontalAlign(val)\n  },\n  refresh: function ($btn) {\n    const selected_cells = this.table.selectedCells()\n    const $ = this.$\n    if (selected_cells.length) {\n      $btn.find('> *').first().replaceWith(this.icon.create('align-' + this.helpers.getAlignment($(selected_cells[0]))))\n    }\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n    $dropdown.find('.fr-command[data-param1=\"' + this.helpers.getAlignment(this.$el.find('.fr-selected-cell').first()) + '\"]').addClass('fr-active').attr('aria-selected', true)\n  }\n})\n\n// Table cell styles.\nFE.DefineIcon('tableCellStyle', { NAME: 'magic', SVG_KEY: 'cellStyle' })\nFE.RegisterCommand('tableCellStyle', {\n  title: 'Cell Style',\n  type: 'dropdown',\n  focus: false,\n  html: function () {\n    let c = '<ul class=\"fr-dropdown-list\" role=\"presentation\">'\n    const options = this.opts.tableCellStyles\n\n    for (const val in options) {\n      if (options.hasOwnProperty(val)) {\n        c += '<li role=\"presentation\"><a class=\"fr-command\" tabIndex=\"-1\" role=\"option\" data-cmd=\"tableCellStyle\" data-param1=\"' + val + '\" title=\"' + this.language.translate(options[val]) + '\">' + this.language.translate(options[val]) + '</a></li>'\n      }\n    }\n    c += '</ul>'\n\n    return c\n  },\n  callback: function (cmd, val) {\n    this.table.applyStyle(val, this.$el.find('.fr-selected-cell'), this.opts.tableCellMultipleStyles, this.opts.tableCellStyles)\n  },\n  refreshOnShow: function ($btn, $dropdown) {\n\n    const $ = this.$\n    const $cell = this.$el.find('.fr-selected-cell').first()\n\n    if ($cell) {\n      $dropdown.find('.fr-command').each(function () {\n        const cls = $(this).data('param1')\n        const active = $cell.hasClass(cls)\n        $(this).toggleClass('fr-active', active).attr('aria-selected', active)\n      })\n    }\n  }\n})\n\nFE.RegisterCommand('tableCellBackgroundCustomColor', {\n  title: 'OK',\n  undo: true,\n  callback: function () {\n    this.table.customColor()\n  }\n})\n\nFE.DefineIcon('tableColorRemove', { NAME: 'eraser', SVG_KEY: 'remove' })\n"],"names":["Object","assign","FE","POPUP_TEMPLATES","DEFAULTS","tableInsertMaxSize","tableEditButtons","tableInsertButtons","tableResizer","tableDefaultWidth","tableResizerOffset","tableResizingLimit","tableColorsButtons","tableColors","tableColorsStep","tableCellStyles","tableStyles","tableCellMultipleStyles","tableMultipleStyles","tableInsertHelper","tableInsertHelperOffset","PLUGINS","table","editor","$","$resizer","$insert_helper","mouseDownCellFlag","mouseDownFlag","mouseDownCell","mouseMoveTimer","resizingFlag","_showInsertPopup","$btn","$tb","find","$popup","popups","get","_initInsertPopup","hasClass","refresh","setContainer","button","getPosition","left","top","show","outerHeight","_showEditPopup","map","_tableMap","_initEditPopup","$sc","offset","_selectionOffset","right","bottom","edit","isDisabled","selectedCells","length","toolbar","disable","$el","removeClass","on","bulkRefresh","selection","setAtEnd","last","restore","_showColorsPopup","_initColorsPopup","_refreshColor","_hideEditPopup","enable","delayed","onHide","trigger","table_buttons","opts","buildList","template","buttons","rows_columns","_insertTableHtml","create","events","$on","e","_hoverCell","currentTarget","_addAccessibility","$table_cell","row","data","parseInt","col","$select_size","parent","siblings","html","i","j","$cell","addClass","helpers","isMobile","css","display","cls","$focused_el","$focused_item","isVisible","is","key_code","which","status","KEYCODE","ARROW_UP","ARROW_DOWN","ARROW_LEFT","ARROW_RIGHT","$cells","index","columns","column","line","Math","floor","max","min","nextIndex","disableBlur","focus","ENTER","exec","preventDefault","stopPropagation","$wp","custom_color","colorsHEXInput","id","language","translate","colors","_colorsHTML","_addColorsAccessibility","colors_html","icon","customColor","$input","setBackground","val","TAB","accessibility","focusToolbar","shiftKey","$colors","colorsStep","lines","dimension","first","color","RGBToHex","insert","rows","cols","cell_width","toFixed","MARKERS","$table","remove","$current_table","selectedTable","setBefore","setAfter","hide","addHeader","thead","each","$td","attr","prepend","removeHeader","$table_header","td","insertRow","position","ref_row","$ref_row","_currentSelection","min_i","max_i","tr","not","parentNode","insertAdjacentHTML","before","deleteRow","$row","rowspan","removeAttr","insertAdjacentElement","$row_parent","_updateCellSpan","insertColumn","ref_col","min_j","max_j","old_width","new_width","outerWidth","col_no","td_no","ref_td","$ref_td","colspan","removeData","append","deleteColumn","_columnWidth","prev","next","_updateColspan","k","first_span","span","decrease","getAttribute","_decreaseCellSpan","_updateRowspan","span_type","setAttribute","removeAttribute","mergeCells","_removeKeyboardSelectionHandlers","cells","$first_cell","$first_row","first_row_cells","closest","content","width","empty_trs","splitCellHorizontally","$selected_cell","$current_row","current_rowspan","cell_origin","_cellOrigin","$new_td","clone","new_rowspan","ceil","document","createElement","_removeSelection","splitCellVertically","current_colspan","parent_width","new_colspan","_columnsWidth","$selected_cells","HEXtoRGB","verticalAlign","horizontalAlign","applyStyle","obj","multiple_styles","styles","classes","keys","splice","indexOf","join","toggleClass","findVisible","$tr","c_index","cspan","rspan","_cellEnds","origin_i","origin_j","el","querySelector","classList","_clearSelection","clear","blur","enableBlur","cellOrigin","cellEnd","_selectionLimits","first_i","last_i","first_j","last_j","$tl","$bl","selectCells","firstCell","lastCell","off","firstCellOrigin","lastCellOrigin","limits","add","_getCellUnder","cell","$target","target","tagName","toString","search","_stopEdit","_mouseDown","parents","isMac","ctrlKey","tag_name","toLowerCase","element","_mouseUp","areVisible","isCollapsed","parseFloat","iframe","$iframe","_resize","_hideResizer","_mouseEnter","_moveInNestedTable","direction","new_map","_moveUp","_moveDown","_moveWithArrows","origin","up","sibling","previousElementSibling","nextElementSibling","setAtStart","_navigateWithArrows","sel","blocks","browser","webkit","node","ranges","startContainer","nodeType","Node","TEXT_NODE","previousSibling","nextSibling","_initResizer","shared","$table_resizer","core","sameInstance","save","pageX","_mouseMove","_hideInsertHelper","_placeResizer","tag_under","$tag_under","$table_parent","tag_left","tag_right","abs","tag_origin","tag_end","second","resizer_top","resizer_height","resizer_left","max_left","max_right","win","pageXOffset","scrollTop","iframePaddingTop","getPX","iframePaddingLeft","_showInsertColHelper","$box","_initInsertHelper","mouseX","scrollLeft","btn_width","_showInsertRowHelper","mouseY","pageY","_insertHelper","tag_below","isElement","doc","elementFromPoint","pageYOffset","_tagUnder","_repositionResizer","initial_positon","release_position","table_width","undo","canDo","saveStep","first_widths","first_percentages","second_widths","second_percentages","$second_cell","first_cell_percentage","table_percentage","left_margin","right_margin","round","col1","col2","clearTimeout","setTimeout","pos","left_limit","right_limit","_addMarkersInCell","isEmpty","START_MARKER","END_MARKER","_useTab","parentsUntil","$ti_helper","bindClick","inst","o_win","tooltip","bind","_destroy","back","showInline","querySelectorAll","_selectCellWithKeyboard","altKey","SPACE","selectCellsWithKeyboard","fixedCell","handlerCell","handlerOrigin","_init","onShow","$win","selected_cells","A","ESC","stopImmediatePropagation","BACKSPACE","DELETE","F10","isBrowserAction","c_selected_cells","className","replace","trim","showInsertPopup","showEditPopup","showColorsPopup","DefineIcon","NAME","SVG_KEY","RegisterCommand","title","refreshOnCallback","popup","callback","plugin","cmd","FA5NAME","toggle","type","options","above","below","c","COMMANDS","tableRows","hasOwnProperty","after","tableColumns","merge","tableCells","refreshOnShow","$dropdown","active","toolbarInline","Top","Middle","Bottom","tableCellVerticalAlign","center","justify","tableCellHorizontalAlign","replaceWith","getAlignment"],"mappings":"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"}