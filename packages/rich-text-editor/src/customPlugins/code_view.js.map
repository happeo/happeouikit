{"version":3,"file":"code_view.js","sources":["../../../src/js/plugins/code_view.js"],"sourcesContent":["import FE from '../index.js'\n\n// Extend defaults.\nObject.assign(FE.DEFAULTS, {\n  codeMirror: window.CodeMirror,\n  codeMirrorOptions: {\n    lineNumbers: true,\n    tabMode: 'indent',\n    indentWithTabs: true,\n    lineWrapping: true,\n    mode: 'text/html',\n    tabSize: 2\n  },\n  codeBeautifierOptions: {\n    end_with_newline: true,\n    indent_inner_html: true,\n    extra_liners: ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'ul', 'ol', 'table', 'dl'],\n    brace_style: 'expand',\n    indent_char: '\\t',\n    indent_size: 1,\n    wrap_line_length: 0\n  },\n  codeViewKeepActiveButtons: ['fullscreen']\n})\n\nFE.PLUGINS.codeView = function (editor) {\n  const $ = editor.$\n  let $html_area\n  let code_mirror\n\n  /**\n   * Check if code view is enabled.\n   */\n  function isActive() {\n    return editor.$box.hasClass('fr-code-view')\n  }\n\n  function get() {\n    if (code_mirror) {\n      return code_mirror.getValue()\n    }\n    else {\n      return $html_area.val()\n    }\n  }\n\n  function refresh() {\n    if (isActive()) {\n      if (code_mirror) {\n        code_mirror.setSize(null, editor.opts.height ? editor.opts.height : 'auto')\n      }\n\n      if (editor.opts.heightMin || editor.opts.height) {\n        editor.$box.find('.CodeMirror-scroll, .CodeMirror-gutters').css('min-height', editor.opts.heightMin || editor.opts.height)\n      }\n      else {\n        editor.$box.find('.CodeMirror-scroll, .CodeMirror-gutters').css('min-height', '')\n      }\n    }\n  }\n\n  /**\n   * Get back to edit mode.\n   */\n  function _showText($btn) {\n    const html = get()\n\n    // Code mirror enabled.\n    editor.html.set(html)\n\n    // Blur the element.\n    editor.$el.blur()\n\n    // Toolbar no longer disabled.\n    editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command, .fr-btn-grp > .fr-btn-wrap > .fr-command, .fr-more-toolbar > .fr-btn-wrap > .fr-command').not($btn).removeClass('fr-disabled').attr('aria-disabled', false)\n    \n    $btn.removeClass('fr-active').attr('aria-pressed', false)\n\n    editor.selection.setAtStart(editor.el)\n    editor.selection.restore()\n    editor.placeholder.refresh()\n\n    editor.undo.saveStep()\n  }\n\n  let _can_focus = false\n\n  function _blur() {\n    if (isActive()) {\n      editor.events.trigger('blur')\n    }\n  }\n\n  function _focus() {\n    if (isActive() && _can_focus) {\n      editor.events.trigger('focus')\n    }\n  }\n\n  /**\n   * Get to code mode.\n   */\n  function _showHTML($btn) {\n    if (!$html_area) {\n      _initArea()\n\n      // Enable code mirror.\n      if (!code_mirror && editor.opts.codeMirror) {\n        code_mirror = editor.opts.codeMirror.fromTextArea($html_area.get(0), editor.opts.codeMirrorOptions)\n\n        code_mirror.on('blur', _blur)\n        code_mirror.on('focus', _focus)\n      }\n      else {\n        editor.events.$on($html_area, 'keydown keyup change input', function () {\n          if (!editor.opts.height) {\n            this.rows = 1\n\n            // Textarea has no content anymore.\n            if (this.value.length === 0) {\n              this.style.height = 'auto'\n            }\n\n            else {\n              this.style.height = this.scrollHeight + 'px'\n            }\n          }\n          else {\n            this.removeAttribute('rows')\n          }\n        })\n\n        editor.events.$on($html_area, 'blur', _blur)\n        editor.events.$on($html_area, 'focus', _focus)\n      }\n    }\n\n    editor.undo.saveStep()\n\n    // Clean white tags but ignore selection.\n    editor.html.cleanEmptyTags()\n    editor.html.cleanWhiteTags(true)\n\n    // Blur the element.\n    if (editor.core.hasFocus()) {\n      if (!editor.core.isEmpty()) {\n        editor.selection.save()\n        editor.$el.find('.fr-marker[data-type=\"true\"]').first().replaceWith('<span class=\"fr-tmp fr-sm\">F</span>')\n        editor.$el.find('.fr-marker[data-type=\"false\"]').last().replaceWith('<span class=\"fr-tmp fr-em\">F</span>')\n      }\n    }\n\n    // Get HTML.\n    let html = editor.html.get(false, true)\n    editor.$el.find('span.fr-tmp').remove()\n\n    editor.$box.toggleClass('fr-code-view', true)\n\n    let was_focused = false\n\n    if (editor.core.hasFocus()) {\n      was_focused = true\n      editor.events.disableBlur()\n      editor.$el.blur()\n    }\n\n    html = html.replace(/<span class=\"fr-tmp fr-sm\">F<\\/span>/, 'FROALA-SM')\n    html = html.replace(/<span class=\"fr-tmp fr-em\">F<\\/span>/, 'FROALA-EM')\n\n    // Beautify HTML.\n    if (editor.codeBeautifier) {\n      html = editor.codeBeautifier.run(html, editor.opts.codeBeautifierOptions)\n    }\n\n    let s_index\n    let e_index\n\n    // Code mirror is enabled.\n    if (code_mirror) {\n      s_index = html.indexOf('FROALA-SM')\n      e_index = html.indexOf('FROALA-EM')\n\n      if (s_index > e_index) {\n        s_index = e_index\n      }\n      else {\n        e_index = e_index - 9\n      }\n\n      html = html.replace(/FROALA-SM/g, '').replace(/FROALA-EM/g, '')\n      const s_line = html.substring(0, s_index).length - html.substring(0, s_index).replace(/\\n/g, '').length\n      const e_line = html.substring(0, e_index).length - html.substring(0, e_index).replace(/\\n/g, '').length\n\n      s_index = html.substring(0, s_index).length - html.substring(0, html.substring(0, s_index).lastIndexOf('\\n') + 1).length\n      e_index = html.substring(0, e_index).length - html.substring(0, html.substring(0, e_index).lastIndexOf('\\n') + 1).length\n\n      code_mirror.setSize(null, editor.opts.height ? editor.opts.height : 'auto')\n\n      if (editor.opts.heightMin) editor.$box.find('.CodeMirror-scroll').css('min-height', editor.opts.heightMin)\n      code_mirror.setValue(html)\n      _can_focus = !was_focused\n      code_mirror.focus()\n      _can_focus = true\n      code_mirror.setSelection({ line: s_line, ch: s_index }, { line: e_line, ch: e_index })\n      code_mirror.refresh()\n      code_mirror.clearHistory()\n    }\n\n    // No code mirror.\n    else {\n      s_index = html.indexOf('FROALA-SM')\n      e_index = html.indexOf('FROALA-EM') - 9\n\n      if (editor.opts.heightMin) {\n        $html_area.css('min-height', editor.opts.heightMin)\n      }\n\n      if (editor.opts.height) {\n        $html_area.css('height', editor.opts.height)\n      }\n\n      if (editor.opts.heightMax) {\n        $html_area.css('max-height', editor.opts.height || editor.opts.heightMax)\n      }\n\n      $html_area.val(html.replace(/FROALA-SM/g, '').replace(/FROALA-EM/g, '')).trigger('change')\n\n      const scroll_top = $(editor.o_doc).scrollTop()\n      _can_focus = !was_focused\n      $html_area.focus()\n      _can_focus = true\n      $html_area.get(0).setSelectionRange(s_index, e_index)\n      $(editor.o_doc).scrollTop(scroll_top)\n    }\n\n    // Disable buttons.\n    editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command, .fr-btn-grp > .fr-btn-wrap > .fr-command, .fr-more-toolbar > .fr-btn-wrap > .fr-command').not($btn).filter(function () {\n      return editor.opts.codeViewKeepActiveButtons.indexOf($(this).data('cmd')) < 0\n    }).addClass('fr-disabled').attr('aria-disabled', true)\n    $btn.addClass('fr-active').attr('aria-pressed', true)\n\n    if (!editor.helpers.isMobile() && editor.opts.toolbarInline) {\n      editor.toolbar.hide()\n    }\n  }\n\n  /**\n   * Toggle the code view.\n   */\n  function toggle(val) {\n    if (typeof val == 'undefined') val = !isActive()\n\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"html\"]')\n\n    if (!val) {\n      editor.$box.toggleClass('fr-code-view', false)\n      _showText($btn)\n    }\n    else {\n      editor.popups.hideAll()\n      _showHTML($btn)\n    }\n  }\n\n  /**\n   * Destroy.\n   */\n  function _destroy() {\n    if (isActive()) {\n      toggle(false)\n    }\n\n    if (code_mirror) code_mirror.toTextArea()\n    $html_area.val('').removeData().remove()\n    $html_area = null\n\n    if ($back_button) {\n      $back_button.remove()\n      $back_button = null\n    }\n  }\n\n  function _refreshToolbar() {\n\n    const $btn = editor.$tb.find('.fr-command[data-cmd=\"html\"]')\n\n    if (!isActive()) {\n      editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command').not($btn).removeClass('fr-disabled').attr('aria-disabled', false)\n      $btn.removeClass('fr-active').attr('aria-pressed', false)\n    }\n    else {\n      editor.$tb.find('.fr-btn-grp > .fr-command, .fr-more-toolbar > .fr-command').not($btn).filter(function () {\n        return editor.opts.codeViewKeepActiveButtons.indexOf($(this).data('cmd')) < 0\n      }).addClass('fr-disabled').attr('aria-disabled', false)\n      $btn.addClass('fr-active').attr('aria-pressed', false)\n    }\n  }\n\n  function _initArea() {\n\n    // Add the coding textarea to the wrapper.\n    $html_area = $('<textarea class=\"fr-code\" tabIndex=\"-1\">')\n    editor.$wp.append($html_area)\n\n    $html_area.attr('dir', editor.opts.direction)\n\n    // Exit code view button for inline toolbar.\n    if (!editor.$box.hasClass('fr-basic')) {\n      $back_button = $('<a data-cmd=\"html\" title=\"Code View\" class=\"fr-command fr-btn html-switch' + (editor.helpers.isMobile() ? '' : ' fr-desktop') + '\" role=\"button\" tabIndex=\"-1\"><i class=\"fa fa-code\"></i></button>')\n      editor.$box.append($back_button)\n\n      editor.events.bindClick(editor.$box, 'a.html-switch', function () {\n        editor.events.trigger('commands.before', ['html'])\n\n        toggle(false)\n\n        editor.events.trigger('commands.after', ['html'])\n      })\n    }\n\n    const cancel = function () {\n      return !isActive()\n    }\n\n    // Disable refresh of the buttons while enabled.\n    editor.events.on('buttons.refresh', cancel)\n    editor.events.on('copy', cancel, true)\n    editor.events.on('cut', cancel, true)\n    editor.events.on('paste', cancel, true)\n\n    editor.events.on('destroy', _destroy, true)\n\n    editor.events.on('html.set', function () {\n      if (isActive()) toggle(true)\n    })\n\n    editor.events.on('codeView.update', refresh)\n    \n    editor.events.on('codeView.toggle', function () {\n      if (editor.$box.hasClass('fr-code-view')) {\n        toggle()\n      }\n    })\n\n    editor.events.on('form.submit', function () {\n      if (isActive()) {\n\n        // Code mirror enabled.\n        editor.html.set(get())\n\n        editor.events.trigger('contentChanged', [], true)\n      }\n    }, true)\n  }\n\n  /**\n   * Initialize.\n   */\n  let $back_button\n\n  function _init() {\n\n    // https://github.com/froala-labs/froala-editor-js-2/issues/672\n\n    editor.events.on('focus', function () {\n\n      if (editor.opts.toolbarContainer) {\n        _refreshToolbar()\n      }\n    })\n\n    if (!editor.$wp) return false\n  }\n\n  return {\n    _init: _init,\n    toggle: toggle,\n    isActive: isActive,\n    get: get\n  }\n}\n\nFE.RegisterCommand('html', {\n  title: 'Code View',\n  undo: false,\n  focus: false,\n  forcedRefresh: true,\n  toggle: true,\n  callback: function () {\n    this.codeView.toggle()\n  },\n  plugin: 'codeView'\n})\n\nFE.DefineIcon('html', {\n  NAME: 'code',\n  SVG_KEY: 'codeView'\n})\n"],"names":["Object","assign","FE","DEFAULTS","codeMirror","window","CodeMirror","codeMirrorOptions","lineNumbers","tabMode","indentWithTabs","lineWrapping","mode","tabSize","codeBeautifierOptions","end_with_newline","indent_inner_html","extra_liners","brace_style","indent_char","indent_size","wrap_line_length","codeViewKeepActiveButtons","PLUGINS","codeView","editor","$","$html_area","code_mirror","isActive","$box","hasClass","get","getValue","val","refresh","setSize","opts","height","heightMin","find","css","_showText","$btn","html","set","$el","blur","$tb","not","removeClass","attr","selection","setAtStart","el","restore","placeholder","undo","saveStep","_can_focus","_blur","events","trigger","_focus","_showHTML","_initArea","fromTextArea","on","$on","rows","value","length","style","scrollHeight","removeAttribute","cleanEmptyTags","cleanWhiteTags","core","hasFocus","isEmpty","save","first","replaceWith","last","remove","toggleClass","was_focused","disableBlur","replace","codeBeautifier","run","s_index","e_index","indexOf","s_line","substring","e_line","lastIndexOf","setValue","focus","setSelection","line","ch","clearHistory","heightMax","scroll_top","o_doc","scrollTop","setSelectionRange","filter","data","addClass","helpers","isMobile","toolbarInline","toolbar","hide","toggle","popups","hideAll","_destroy","toTextArea","removeData","$back_button","_refreshToolbar","$wp","append","direction","bindClick","cancel","_init","toolbarContainer","RegisterCommand","title","forcedRefresh","callback","plugin","DefineIcon","NAME","SVG_KEY"],"mappings":"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"}